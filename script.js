// === –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü –¢–ê –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===
const rssFeeds=['https://www.ukrinform.ua/rss','https://www.pravda.com.ua/rss/','https://interfax.com.ua/news/general.rss'],CACHE_DURATION=36e5;
// [–§–†–ê–ì–ú–ï–ù–¢ A: –ù–û–í–Ü –ó–ú–Ü–ù–ù–Ü –î–õ–Ø –ö–Ü–ù–¶–Ø]
let score=0,clickPower=1,autoRate=0,isPlaying=0,currentTrack=0,displayedTrackIndex=0,sessionStart=Date.now(),totalUpgradesBought=0,maxPerClick=1,prestigeMultiplier=1,totalReverbs=0,maxAutoRate=0,maxCombo=0,clickCloudTotal=0,lastClickTime=0,currentCombo=0,maxComboEver=0,comboTimeout=null,MAX_CLICK_INTERVAL=350,COMBO_THRESHOLD=5,isReverbActive=0,reverbHoldTimeout=null,clickMultiplier=1,buttons=[],prestigeThreshold=3600,currentPrestigeProgress=0,reverseClockHands=false,animationsEnabled=true,keepMusicOnPrestige=false,ownedTracks=[0],ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]},current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};
let availableGames=[],isPracticeMode=false,bossScore={player:0,clock:0,round:1},secretRestoreCode="",isTimeBroken=false,realTimeFrozenValue="";
let gameState={v:'2.7',s:0,p:1,a:0,u:0,m:1,pm:1,tr:0,ma:0,mc:0,cct:0,pt:3600,cpp:0,cm:1,vol:45,rev:false,anim:true,lang:'uk',tutorialDone:false,ul:[],mb:[],ot:[0],ending:0,hasKey1:false,hasKey2:false};
let firstAchievementsCheck=true,cachedNews=[],lastFetchTime=0,newsTickerVisible=false,userGroqApiKey='',currentDiscordChannel='general',discordOverlay=null,discordChannelMessages={},unreadCounts={ai:1},discordActivityInterval=null,visitedChannels={},shownNewsUrls=new Set();
let constellation={center:{unlocked:false,level:0,maxLevel:1,bonusPerLevel:1000,cost:1,name:"–Ø–¥—Ä–æ —á–∞—Å—É"},hourHand:{stars:[{id:'h1',distance:100,angle:0,unlocked:false,bonus:{type:'prestige',value:0.1},cost:1},{id:'h2',distance:200,angle:0,unlocked:false,bonus:{type:'clickMultiplier',value:2},cost:2}],angle:0},minuteHand:{stars:[{id:'m1',distance:80,angle:90,unlocked:false,bonus:{type:'autoRate',value:50},cost:1},{id:'m2',distance:160,angle:90,unlocked:false,bonus:{type:'clickPower',value:5},cost:1},{id:'m3',distance:240,angle:90,unlocked:false,bonus:{type:'combo',value:10},cost:2},{id:'m4',distance:320,angle:90,unlocked:false,bonus:{type:'prestige',value:0.15},cost:3}],angle:90},secondHand:{stars:[{id:'s1',distance:70,angle:240,unlocked:false,bonus:{type:'clickPower',value:2},cost:1},{id:'s2',distance:140,angle:240,unlocked:false,bonus:{type:'autoRate',value:20},cost:1},{id:'s3',distance:210,angle:240,unlocked:false,bonus:{type:'skinDiscount',value:0.3},cost:2},{id:'s4',distance:280,angle:240,unlocked:false,bonus:{type:'prestige',value:0.05},cost:2},{id:'s5',distance:350,angle:240,unlocked:false,bonus:{type:'all',value:1.5},cost:5}],angle:240}},skillPoints=0,isConstellationVisible=false;
const languages=[{code:'uk',name:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞',native:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'},{code:'en',name:'English',native:'English'},{code:'pl',name:'Polish',native:'Polski'},{code:'de',name:'German',native:'Deutsch'},{code:'fr',name:'French',native:'Fran√ßais'},{code:'es',name:'Spanish',native:'Espa√±ol'},{code:'it',name:'Italian',native:'Italiano'}];
let isTutorialActive=false,currentTutorialStep=0, typewriterTimeout=null,fullTextString='',isTextTyping=false;
const d=document,q=s=>d.querySelector(s),qa=s=>d.querySelectorAll(s),id=s=>d.getElementById(s);
// === –°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–ö–õ–ê–î–£ ===
function t(str){if(gameState.lang==='uk')return str;if(typeof TRANSLATIONS!=='undefined'){return TRANSLATIONS[gameState.lang]?.[str]||TRANSLATIONS['en']?.[str]||str;}return str;}
function changeLanguage(lang){gameState.lang=lang;qa('[data-lang-key]').forEach(el=>{const original=el.getAttribute('data-original-text')||el.textContent;if(!el.getAttribute('data-original-text'))el.setAttribute('data-original-text',original);const originalPh=el.getAttribute('data-original-placeholder')||el.getAttribute('placeholder');if(originalPh&&!el.getAttribute('data-original-placeholder'))el.setAttribute('data-original-placeholder',originalPh);const key=el.getAttribute('data-lang-key');let res=original;if(lang!=='uk'){const trKey=key?t(key):null;if(trKey&&trKey!==key)res=trKey;else res=t(original);}if(el.hasAttribute('placeholder')||el.tagName==='TEXTAREA'||el.tagName==='INPUT'){let phRes=originalPh;if(lang!=='uk'){const trKeyPh=key?t(key):null;if(trKeyPh&&trKeyPh!==key&&trKeyPh!==res)phRes=trKeyPh;else phRes=t(originalPh);}if(phRes)el.setAttribute('placeholder',phRes);}else{el.innerHTML=res;}});if(id('upgrades'))id('upgrades').innerHTML='';buttons=[];initUpgrades();revealPurchasedUpgrades();if(id('multipliers'))id('multipliers').innerHTML='';initMultipliers();refreshAllSkinGrids();updateAchievements();updateMusicUI();updateScore();updateStats();if(id('constellationExitBtn'))id('constellationExitBtn').textContent=t("–ü–æ–∫–∏–Ω—É—Ç–∏ —Å—É–∑—ñ—Ä'—è");if(id('constellationBuyBtn'))id('constellationBuyBtn').textContent=t("–ö—É–ø–∏—Ç–∏ –≤–º—ñ–Ω–Ω—è");const cb=d.querySelector('#constellationUpgradePanel button[onclick="hideUpgradePanel()"]');if(cb)cb.textContent=t("–ó–∞–∫—Ä–∏—Ç–∏");updateConstellationDisplay();saveGame();}
function openLanguageModal(){const m=id('languageSelectionOverlay'),l=id('langList'),b=id('langConfirmBtn');if(!m)return;m.style.display='flex';b.style.display='none';const render=(f)=>{l.innerHTML='';languages.filter(x=>x.name.toLowerCase().includes(f)||x.native.toLowerCase().includes(f)).forEach(lang=>{const btn=d.createElement('button');btn.className='choose-btn';btn.style.cssText='min-width:auto;padding:15px;font-size:16px;text-align:left;';btn.innerHTML=`<span style="font-size:1.2em">${lang.native}</span><br><span style="font-size:0.8em;opacity:0.7">${lang.name}</span>`;btn.onclick=()=>{changeLanguage(lang.code);qa('#langList .choose-btn').forEach(b=>b.style.border='none');btn.style.border='2px solid white';b.style.display='block';};l.appendChild(btn);});};render('');id('langSearch').oninput=(e)=>render(e.target.value.toLowerCase());b.onclick=()=>{m.style.display='none';if(!gameState.tutorialDone && score<10) showTutorialChoice();};}
// === –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –ì–†–ò ===
window.startGame=function(v){id('chooser').style.display='none';id('game').classList.remove('game-hidden');if(v==='mobile')d.body.classList.add('mobile-version');else d.body.classList.remove('mobile-version');initGame();}
function initGame(){initializeDOMElements();initializeSystems();let loaded=loadGame();qa('[data-lang-key]').forEach(el=>el.setAttribute('data-original-text',el.textContent));if(!loaded){refreshAllSkinGrids();applyAllSkins();saveGame();checkFirstRun();}else{changeLanguage(gameState.lang);if(!gameState.tutorialDone&&score<10)checkFirstRun();}startIntervals();setTimeout(()=>{updateScore();updateStats();updateReverbText();refreshAllSkinGrids();applyAllSkins();updateAchievements();firstAchievementsCheck=false;updateDevLinks();},100);}
function initializeDOMElements(){window.clock=id("clickableClock");window.clockWrapper=id("clockWrapper");window.comboBubble=id("comboBubble");window.comboCount=id("comboCount");window.clickCloudEl=id("clickCloud");window.musicBtn=id("musicBtn");window.prevTrack=id("prevTrack");window.nextTrack=id("nextTrack");window.player=id("player");window.scoreText=id("score");window.upgradesContainer=id("upgrades");window.multipliersContainer=id("multipliers");window.clickGainEl=id("clickGain");window.cloudTotalEl=id("cloudTotal");window.nowPlaying=id("nowPlaying");window.realTimePlayedEl=id("realTimePlayed");window.virtualTimeEl=id("virtualTime");window.totalUpgradesEl=id("totalUpgrades");window.maxPerClickEl=id("maxPerClick");window.prestigeMultEl=id("prestigeMult");window.reverbBtn=id("reverbBtn");window.timeTunnel=id("timeTunnel");window.worldTitle=id("worldTitle");window.toastContainer=id("toastContainer");window.reverbOverlay=id("reverbOverlay");window.reverbClock=id("reverbClock");window.reverbHint=id("reverbHint");window.reverbDesc=id("reverbDesc");window.nextMultiplierEl=id("nextMultiplier");if(window.clock)window.clock.style.borderWidth='10px';if(window.reverbClock)window.reverbClock.style.borderWidth='10px';}
function initializeSystems(){initSettings();initDate();initMusic();initUpgrades();initMultipliers();initAchievements();initSkins();initReverbSystem();initTabs();initSecretSystem();initClickHandler();initConstellationSystem();initTheRitual();initRestoreLogic();updateDevLinks();}
// === –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–ê –Ü–ù–¢–ï–†–§–ï–ô–° ===
function initSettings(){const volumeSlider=id('volumeSlider'),volumeValue=id('volumeValue'),reverseHands=id('reverseHands'),disableAnimations=id('disableAnimations');if(!volumeSlider)return;volumeSlider.value=gameState.vol||45;volumeValue.textContent=(gameState.vol||45)+'%';if(player)player.volume=(gameState.vol||45)/100;reverseHands.checked=gameState.rev||false;reverseClockHands=gameState.rev||false;disableAnimations.checked=!(gameState.anim!==false);animationsEnabled=gameState.anim!==false;d.body.classList.toggle('no-animations',!animationsEnabled);volumeSlider.addEventListener('input',function(){let v=this.value;volumeValue.textContent=v+'%';if(player)player.volume=v/100;gameState.vol=v;saveGame();});reverseHands.addEventListener('change',function(){reverseClockHands=this.checked;gameState.rev=reverseClockHands;saveGame();});disableAnimations.addEventListener('change',function(){animationsEnabled=!this.checked;d.body.classList.toggle('no-animations',!animationsEnabled);gameState.anim=animationsEnabled;saveGame();});}
function initDate(){function updateDate(){id("currentDate").textContent=new Date().toLocaleDateString(gameState.lang==='uk'?'uk-UA':(gameState.lang==='en'?'en-US':'uk-UA'));}updateDate();setInterval(updateDate,6e4);}
function initTabs(){qa(".top-tabs .tab").forEach(b=>{b.addEventListener("click",()=>{qa(".top-tabs .tab").forEach(x=>x.classList.remove("active"));qa(".tab-page").forEach(x=>x.classList.remove("active"));b.classList.add("active");id(b.dataset.tab).classList.add("active");if(isTutorialActive&&tutorialSteps[currentTutorialStep].tab===b.dataset.tab)onStepTextComplete();});});}
function updateDevLinks(){const l=id('devLinkTelegram'),i=id('devLinkInstagram');if(l)l.href="https://t.me/brainmathx_bot";if(i)i.href="#";}
// === –†–ï–í–ï–†–ë (–ù–û–í–Ü –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê) ===
function closeReverbModal(){const m=id('reverbConfirmModal');if(m)m.style.display='none';}
function closeMusicModal(){const m=id('musicKeepModal');if(m)m.style.display='none';}
function initReverbSystem(){restartEffect.init();const btn=id('reverbBtn');if(btn)btn.addEventListener("click",()=>id('reverbConfirmModal').style.display='flex');const yesBtn=id('reverbConfirmYes');if(yesBtn)yesBtn.onclick=()=>{closeReverbModal();if(isPlaying){id('musicKeepModal').style.display='flex';}else{keepMusicOnPrestige=false;startReverbMode();}};const mYes=id('musicKeepYes');if(mYes)mYes.onclick=()=>{keepMusicOnPrestige=true;closeMusicModal();startReverbMode();};const mNo=id('musicKeepNo');if(mNo)mNo.onclick=()=>{keepMusicOnPrestige=false;isPlaying=0;player.pause();musicBtn.textContent=t("–í–∫–ª—é—á–∏—Ç–∏ –º—É–∑–∏–∫—É");closeMusicModal();startReverbMode();};}
// === –¢–£–¢–û–†–Ü–ê–õ ===
function checkFirstRun(){setTimeout(()=>openLanguageModal(),500);}
function showTutorialChoice(){const d=id('tutorialDialogue'),c=id('tutorialChoiceBtns'),back=id('tutorialBackBtn'),next=id('tutorialNextBtn');id('tutorialOverlay').style.display='block';d.style.display='block';back.style.display='none';next.style.display='none';c.style.display='flex';typeText(t("–ö–æ–ª–∏ –º–∏ —Ä–æ–∑—ñ–±—Ä–∞–ª–∏—Å—è –Ω–∞ —è–∫—ñ–π —Ç–∏ –º–æ–≤—ñ —Ö–æ—á–µ—à—å –≥—Ä–∞—Ç–∏, –∑–∞–ª–∏—à–∏–≤—Å—è –æ—Å—Ç–∞–Ω—ñ–π –∫—Ä–æ–∫. –ß–∏ —Ç–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–π—Ç–∏ —Ç—É—Ç–æ—Ä—ñ–∞–ª, —â–æ–± –±—É–ª–æ –ª–µ–≥—à–µ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è –≤ –º–µ—Ö–∞–Ω—ñ—Ü—ñ –≥—Ä–∏?"));id('skipTutorialChoice').onclick=()=>{endTutorial(true);};id('startTutorialChoice').onclick=()=>{startTutorial();};id('skipTutorialChoice').textContent=t("–ü—Ñ—Ñ—Ñ —Ç—É—Ç–æ—Ä—ñ–∞–ª –¥–ª—è –¥–∏—Ç–∏–Ω–∏");id('startTutorialChoice').textContent=t("–ß–æ–º—É –Ω—ñ, –º–æ–∂–µ –¥—ñ–∑–Ω–∞—é—Å—å —â–æ—Å—å –Ω–æ–≤–µ");}
const tutorialSteps=[{text:"–¢–∞–∫ —è–∫—â–æ —Ç–∏ –ø–æ–≥–æ–¥–∏–≤—Å—è –Ω–∞ —Ç—É—Ç–æ—Ä—ñ–∞–ª, —Ç–æ –Ω–µ–≥–∞–µ–º–æ —á–∞—Å—É —ñ —Ä–æ–∑–ø–æ—á–Ω–µ–º–æ –π–æ–≥–æ",el:null,action:"next"},{text:"–¶–µ —Ç–≤—ñ–π —á–∞—Å, —ñ –≤—ñ–Ω –Ω–µ–≤—Ç–æ–º–Ω–æ —É—Ö–æ–¥–µ. –Ü –π–æ–≥–æ –Ω—ñ—è–∫ –Ω–µ –∑—É–ø–∏–Ω–∏—Ç–∏. –ù–∞–∂–º–∏ –Ω–∞ –≥–æ–¥–∏–Ω–Ω–∏–∫, —â–æ–± –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ —á–∞—Å",el:"#clockWrapper",action:"click_clock"},{text:"–¢—É—Ç —Ç–∏ –º–æ–∂–µ—à—å –ø–æ–±–∞—á–∏—Ç–∏ —Å–∫—ñ–ª—å–∫–∏ —á–∞—Å—É —Ç–∏ –≤–∂–µ –≤—Ç—Ä–∞—Ç–∏–≤, –∑–≤—É—á–∏—Ç—å —Å—É–º–Ω–æ, –∞–ª–µ —Ü–µ –ø—Ä–∞–≤–¥–∏–≤–æ, –∑–∞—Ä–∞–∑ —è –ø–æ–∫–∞–∂—É –¥–ª—è —á–æ–≥–æ —Ç–æ–±—ñ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —ñ —â–æ —Ä–æ–±–∏—Ç–∏ –∑ –≤–∏—Ç—Ä–∞—á–µ–Ω–∏–º —á–∞—Å–æ–º",el:"#score",action:"next"},{text:"–©–æ–± –Ω–µ –±—É–ª–æ —Ç–∞–∫ —Å—É–º–Ω–æ —ñ –Ω—É–¥–Ω–æ —Ç–∏ –º–æ–∂–µ—à—å –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞—Ç–∏ –º—É–∑–∏–∫—É(–∞–ª–µ –Ω–∞–≤—ñ—Ç—å –Ω–∞ –ø–æ—à—É–∫ –º—É–∑–∏–∫–∏ —Ç—Ä–µ–±–∞ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å)",el:".music-player",action:"next",pos:"top"},{text:"–í–∏—Ç—Ä–∞—á–µ–Ω–∏–π —á–∞—Å —Ç–∏ –º–æ–∂–µ—à—å –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∏. –î–ª—è —á–æ–≥–æ? –ù—É –∑–≤—ñ—Å–Ω–æ –∂–µ –¥–ª—è —Ç–æ–≥–æ —â–æ–± –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –±—ñ–ª—å—à–µ —á–∞—Å, –¥–ª—è —á–æ–≥–æ —â–µ",el:".left-panel",tab:"tab-upgrades",action:"next"},{text:"–¶–µ –Ω–µ —î–¥–∏–Ω–µ –Ω–∞ —â–æ –º–æ–∂–Ω–∞ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å, —Ö–æ–¥—ñ–º–æ",el:"button[data-tab='tab-skins']",action:"next"},{text:"–©–µ —á–∞—Å —Ç–∏ –º–æ–∂–µ—à—å –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –Ω–∞ —Å–∫—ñ–Ω–∏ –¥–ª—è —Å–≤–æ–≥–æ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞",el:".left-panel",tab:"tab-skins",action:"next"},{text:"–î–∞–≤–∞–π –ø—Ä–æ–π–¥–µ–º–æ—Å—è –ø–æ –Ω–∏—Ö",el:".left-panel",action:"next"},{text:"–¶—è –≥—Ä—É–ø–∞ —Å–∫—ñ–Ω—ñ–≤ –º—ñ–Ω—è—î —Ñ–æ—Ä–º—É —Ç–≤–æ–≥–æ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞",el:".left-panel",action:"next"},{text:"–¶—è –≥—Ä—É–ø–∞ —Å–∫—ñ–Ω—ñ–≤ –º—ñ–Ω—è—î –∫–æ–ª—ñ—Ä –æ–±—ñ–¥–∫–∞ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞, —Ç–µ–∂ –Ω—ñ—á–æ–≥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ",el:".left-panel",action:"next"},{text:"–î–∞–ª—ñ –≥—Ä—É–ø–∞ —Å–∫—ñ–Ω—ñ–≤ —è–∫–∞ –∑–º—ñ–Ω—é—î –∫–æ–ª—ñ—Ä —Ç–≤–æ—ó—Ö —Å—Ç—Ä—ñ–ª–æ–∫, –≤—Å—ñ –æ–∫—Ä—ñ–º —Å–µ–∫—É–Ω–¥–Ω–æ—ó). –©–æ–± —Ç–∏ –Ω–µ –∑–∞–±—É–≤–∞–≤, —â–æ —á–∞—Å –≤—Å–µ —â–µ –ø–ª–∏–Ω–µ",el:".left-panel",action:"next"},{text:"–¶—è –≥—Ä—É–ø–∞ —Å–∫—ñ–Ω—ñ–≤ –º—ñ–Ω—è—î –∞–Ω—ñ–º–∞—Ü—ñ—é –∫–ª—ñ–∫—É –ø–æ –≥–æ–¥–∏–Ω–Ω–∏–∫—É",el:".left-panel",action:"next"},{text:"–ó—ñ —Å–∫—ñ–Ω–∞–º–∏ —Ä–æ–∑—ñ–±—Ä–∞–ª–∏—Å—è, –Ω—ñ—á–æ–≥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–∞–ª—ñ",el:"button[data-tab='tab-stats']",action:"next"},{text:"–¢—É—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å—ñ–π —Ç–≤–æ—ó–π –≥—Ä—ñ, —è–∫—â–æ —Ö–æ—á–µ—à—å –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ —Ç–∏–º —â–æ —Ç—É—Ç –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É—î—Ç—å—Å—è, –º–æ–∂–µ—à—å —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ –ø—ñ—Å–ª—è —Ç—É—Ç–æ—Ä—ñ–∞–ª—É",el:".left-panel",tab:"tab-stats",action:"next"},{text:"–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–∞–ª—ñ",el:"button[data-tab='tab-achievements']",action:"next"},{text:"–°–∞–º–µ —Ç—É—Ç —Ç–∏ –º–æ–∂–µ—à—å –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —è–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —á–∏ —è–∫—ñ –≤ —Ç–µ–±–µ –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ. –ê —Ç–∞–∫–æ–∂ –≤—ñ—Ç–∞—é —Ç–µ–±–µ –∑ –ø–µ—Ä—à–∏–º —Ç–≤–æ—ó–º –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è–º. –£–ø–µ–≤–Ω–µ–Ω–∏–π —Ç–∏ –∑—É–º—ñ—î—à –∑—ñ–±—Ä–∞—Ç–∏ —ó—Ö —É—Å—ñ—Ö",el:".left-panel",tab:"tab-achievements",action:"next"},{text:"–ù—É–º–æ —Ö–æ–¥—ñ–º–æ –¥–∞–ª—ñ",el:"button[data-tab='tab-reverb']",action:"next"},{text:"–¢—É—Ç —Ç–∏ –º–æ–∂–µ—à—å –∑—Ä–æ–±–∏—Ç–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫. –î–ª—è —á–æ–≥–æ? –î–ª—è —Ç–æ–≥–æ —â–æ–± –∑–±—ñ–ª—å—à–∏—Ç–∏ –º–Ω–æ–∂–Ω–∏–∫ —ñ –±–∏—Å—Ç—Ä—ñ—à–µ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å. –ê–ª–µ –±—É–¥—å —É–≤–∞–∂–Ω–∏–π, —â–æ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –≤ —Ç–µ–±–µ –ø—Ä–æ–≥—Ä–µ—Å –∑—ñ—Ç—Ä–µ—Ç—å—Å—è —ñ –ø—Ä–∏–π–¥–µ—Ç—å—Å—è –ø–æ—á–∏–Ω–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É, –∞–ª–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Ç–æ–≥–æ —Å—Ç–∞–Ω—É –≤ —è–∫–æ–º—É —Ç–∏ –±—É–≤ –≤–∂–µ –±–∏—Å—Ç—Ä—ñ—à–µ —ñ–∑ –∑–∞ —Ç–æ–≥–æ —â–æ –≤ —Ç–µ–±–µ –º–Ω–æ–∂–Ω–∏–∫ –∑'—è–≤–∏—Ç—å—Å—è —ñ –∫—Ä—ñ–º –º–Ω–æ–∂–Ω–∏–∫–∞(—Ç–æ–±—ñ —â–µ –¥–µ—â–æ –¥–æ–ø–æ–º–æ–∂–µ, –∞–ª–µ —Ç–∏ —Ü–µ –≤–∏—è—Å–Ω–∏—à –≤–∂–µ —Å–∞–º)",el:".left-panel",tab:"tab-reverb",action:"next"},{text:"–û—Å—Ç–∞–Ω–Ω—è –≤–∫–ª–∞–¥–∫–∞, —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ —Ç–æ–±—ñ —à–≤–∏–¥—à–µ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å",el:"button[data-tab='tab-multipliers']",action:"next"},{text:"–¢—É—Ç —Ç–∏ –º–æ–∂–µ—à—å –ø—Ä–æ–∫–∞—á—É–≤–∞—Ç–∏ —Å–≤–æ—ó –∫–ª—ñ–∫–∏, —è–∫—ñ –≤ —Å–≤–æ—é —á–µ—Ä–≥—É –±—É–¥—É—Ç—å –∑–±—ñ–ª—å—à—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—Ç—Ä–∞—á–µ–Ω–æ–≥–æ —á–∞—Å—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω—ñ –Ω–∞ –≥–æ–¥–∏–Ω–Ω–∏–∫. –í—Å–µ –ª–µ–≥–∫–æ",el:".left-panel",tab:"tab-multipliers",action:"next"},{text:"–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –≥—Ä–∏",el:"button[data-tab='settings']",action:"next"},{text:"–û—Å—å –≤–∫–ª–∞–¥–∫–∞ –¥–µ —Ç–∏ –º–æ–∂–µ—à—å —ñ –≤–∏–º–∏–∫–∞—Ç–∏ –∞–Ω—ñ–º–∞—Ü—ñ—é —É –≥–æ–¥–∏–Ω–Ω–∏–∫–∞, —ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≥—Ä—É —ñ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å –Ω–∞ —ñ–Ω—à–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π, —Ç–æ–±—Ç–æ –Ω—ñ—á–æ–≥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ, –∞–ª–µ —è–∫—â–æ –±—É–¥–µ –ø–æ—Ç—Ä–µ–±–∞ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è –≤ –∫–æ–∂–Ω—ñ–π –∫–Ω–æ–ø—Ü—ñ —Ç–æ –º–∏ —è–∫ —Ä–∞–∑ –∑–∞—Ä–∞–∑ –ø–µ—Ä–µ–π–¥–µ–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏, —è–∫–∞ –≤—ñ–¥–∫–∏–Ω–∏—Ç—å –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è —è–∫—ñ –∑'—è–≤–∏–ª–∏—Å—å. –Ü –¥–æ—Ä–µ—á—ñ –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è. –ì—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–∂–Ω—ñ –ø—ñ–≤ —Ö–≤–∏–ª–∏–Ω–∏, —Ç–æ–∂ —è–∫—â–æ —Ç–∏ –ø–æ–≥—Ä–∞—î—à —ñ –≤–∏—Ä—ñ—à–∏—à –ø–∏—Ç–∏ –ø–æ—ó—Å—Ç–∏ —á–∏ –≤–∑–∞–≥–∞–ª—ñ —Å–ø–∞—Ç–∏ –ø—ñ—Ç–∏, –º–æ–∂–µ—à—å –≤–∏–º–∏–∫–∞—Ç–∏ –≥—Ä—É —Ç–æ–º—É —â–æ –ø—Ä–æ–≥—Ä–µ—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è",el:".left-panel",tab:"settings",action:"next"},{text:"–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏",el:"button[data-tab='tab-tutorial']",action:"next"},{text:"–¶—è –≤–∫–ª–∞–¥–∫–∞ –¥–ª—è —Ç–∏—Ö –∫—Ç–æ —á–∏ –Ω–µ —Ä–æ–∑—ñ–±—Ä–∞–≤—Å—è –≤ —á–æ–º—É—Å—å, —á–∏ —Ö–æ—á–µ –±—ñ–ª—å—à–µ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è –≤ –º–µ—Ö–∞–Ω—ñ—Ü—ñ, —á–∏ –Ω–∞–≤—ñ—Ç—å –¥–ª—è —Ç–∏—Ö –∫–æ–º—É –ø—Ä–æ—Å—Ç–æ —Ü—ñ–∫–∞–≤–æ. –ö–æ–ª–∏ –≤–∏–Ω–∏–∫–∞—î –ø–æ—Ç—Ä–µ–±–∞ –∑–≥–∞–¥–∞—Ç–∏ —è–∫ —â–æ—Å—å –ø—Ä–∞—Ü—é—î. –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ü—é –≤–∫–ª–∞–¥–∫—É —ñ –ø–æ—à—É–∫–∞—Ç–∏ —á–∏ –æ–∫—Ä–µ–º–æ –ø–æ –≤–∫–ª–∞–¥–∫–∞–º –º–µ—Ö–∞–Ω—ñ–∫–∏ —á–∏ –∑–∞–≥–∞–ª—å–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∫–∏ –≥—Ä–∏. –î—É–∂–µ –∑—Ä—É—á–Ω–æ",el:".left-panel",tab:"tab-tutorial",action:"next"},{text:"–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–∫–ª–∞–¥–∫–∏",el:"button[data-tab='tab-developers']",action:"next"},{text:"–î—è–∫—É—é –∑–∞ —Ç–µ —â–æ –ø—Ä–æ–π—à–ª–∏ –≤–µ—Å—å —Ü–µ–π —Ç—É—Ç–æ—Ä—ñ–∞–ª, —è–∫—â–æ —á–µ—Å—Ç–Ω–æ —è –∑–∞–ø–∞—Ä–∏–≤—Å—è –Ω–∞–¥ –Ω–∏–º, —â–æ–± –í–∞–º –±—É–ª–æ 100% –∑—Ä–æ–∑—É–º—ñ–ª–æ –ø—Ä–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —ñ –º–µ—Ö–∞–Ω—ñ–∫—É –≥—Ä–∏. –Ø —Ä–æ–∑—Ä–æ–±–∏–≤ –≥—Ä—É –≤ –æ–¥–Ω–æ–≥–æ. –í –º–µ–Ω–µ –Ω—ñ –∫–æ–º–∞–Ω–¥–∏, –Ω—ñ–∫–æ–≥–æ. –°–ø–æ–¥—ñ–≤–∞—é—Å—å –í–∞–º —Å–ø–æ–¥–æ–±–∞—î—Ç—å—Å—è –≥—Ä–∞ —ñ —É –í–∞—Å –∑–∞–ª–∏—à–∞—Ç—å—Å—è –≥–∞—Ä–Ω—ñ –ø–æ—á—É—Ç—Ç—è –ø—ñ—Å–ª—è —Ü—ñ—î—ó –≥—Ä–∏. –î–ª—è –ø–æ–¥—è–∫–∏ —á–∏ –ø—Ä–æ–ø–æ–Ω—É–≤–∞–Ω–Ω—è —ñ–¥–µ–π, —á–∏ –ª—ñ–∫–≤—ñ–¥–∞—Ü—ñ—ó –±–∞–≥—ñ–≤ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –º–µ–Ω–µ –≤ –º–æ—ó—Ö —Å–æ—Ü —Å–µ—Ç—è—Ö. –ë—É–¥—É –¥—É–∂–µ —Ä–∞–¥–∏–π –≤—Å—ñ–º –∫—Ç–æ —Ö–æ—á–µ –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä—É —á–∏ —Å–ª–æ–≤–∞–º–∏, —á–∏ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ",el:".left-panel",tab:"tab-developers",action:"next"},{text:"–î—è–∫—É—é –∑–∞ —Ç–µ —â–æ –ø—Ä–æ–π—à–ª–∏ —Ç—É—Ç–æ—Ä—ñ–∞–ª, —Å–ø–æ–¥—ñ–≤–∞—é—Å—å –í–∞–º –±—É–ª–æ –∫–æ—Ä–∏—Å–Ω–æ —ñ –∑—Ä–æ–∑—É–º—ñ–ª–æ. –ì–∞—Ä–Ω–æ—ó –í–∞–º –≥—Ä–∏ —ñ –ø–∏—à—ñ—Ç—å –ø–æ —Ü—é –≥—Ä—É –≤ —Å–≤–æ—ó—Ö —Å–æ—Ü —Å–µ—Ç—è—Ö —è–∫—â–æ —Å–ø–æ–¥–æ–±–∞–ª–æ—Å—å. –ë—É–¥—É –¥—É–∂–µ –≤–¥—è—á–Ω–∏–π —ñ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –º–æ—ó—Ö —Å–æ—Ü. —Å–µ—Ç–µ–π –¥–ª—è –ø—Ä–æ–ø–æ–Ω—É–≤–∞–Ω–Ω—è —á–æ–≥–æ—Å—å —Å–≤–æ–≥–æ",action:"finish"}];
function startTutorial(){isTutorialActive=true;currentTutorialStep=0;id('tutorialChoiceBtns').style.display='none';id('skipTutorialTopBtn').style.display='block';id('skipTutorialTopBtn').onclick=()=>endTutorial(true);id('tutorialOverlay').style.display='block';id('tutorialDialogue').style.display='block';showTutorialStep(0);}
function typeText(txt,cb){const t=id('tutorialText');t.innerHTML='';fullTextString=txt;isTextTyping=true;let i=0;clearTimeout(typewriterTimeout);const cursor=d.createElement('span');cursor.className='typing-cursor';cursor.textContent='|';t.appendChild(cursor);function type(){if(i<txt.length){t.innerHTML=txt.substring(0,i+1)+'<span class="typing-cursor">|</span>';i++;typewriterTimeout=setTimeout(type,20);id('tutorialDialogue').onclick=()=>finishTyping();}else{isTextTyping=false;if(cb)cb();id('tutorialDialogue').onclick=null;}}type();}
function finishTyping(){if(!isTextTyping)return;clearTimeout(typewriterTimeout);const t=id('tutorialText');t.innerHTML=fullTextString;isTextTyping=false;onStepTextComplete();}
function showTutorialStep(idx){if(idx>=tutorialSteps.length){endTutorial();return;}const step=tutorialSteps[idx];qa('.highlighted-step').forEach(e=>{e.classList.remove('highlighted-step');e.style.zIndex='';e.style.position='';});if(step.tab){const b=document.querySelector(`button[data-tab='${step.tab}']`);if(b)b.click();}const dia=id('tutorialDialogue');if(step.pos==='top')dia.classList.add('dialogue-top');else dia.classList.remove('dialogue-top');if(step.el){const el=d.querySelector(step.el);if(el){el.classList.add('highlighted-step');el.style.position='relative';el.style.zIndex='15001';el.scrollIntoView({behavior:'smooth',block:'center'});}}id('tutorialBackBtn').style.display=idx>0?'inline-block':'none';id('tutorialNextBtn').style.display='none';id('tutorialNextBtn').textContent=step.action==='finish'?t("–ó–∞–∫—ñ–Ω—á–∏—Ç–∏ —Ç—É—Ç–æ—Ä—ñ–∞–ª"):t("–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏");id('tutorialBackBtn').textContent=t("–ù–∞–∑–∞–¥");id('tutorialBackBtn').onclick=prevTutorialStep;id('skipTutorialTopBtn').textContent=t("–°–∫—ñ–ø–Ω—É—Ç–∏ —Ç—É—Ç–æ—Ä—ñ–∞–ª");typeText(t(step.text),()=>onStepTextComplete());}
function onStepTextComplete(){const step=tutorialSteps[currentTutorialStep];id('tutorialNextBtn').style.display='inline-block';if(step.action==='click_clock'){id('tutorialNextBtn').style.display='none';const c=id('clickableClock');c.classList.add('click-effect-neon');c.onclick=()=>{c.onclick=null;c.classList.remove('click-effect-neon');nextTutorialStep();};}else if(step.action==='finish'){id('tutorialNextBtn').onclick=()=>endTutorial();}else{id('tutorialNextBtn').onclick=nextTutorialStep;}}
function nextTutorialStep(){currentTutorialStep++;showTutorialStep(currentTutorialStep);}
function prevTutorialStep(){if(currentTutorialStep>0){currentTutorialStep--;showTutorialStep(currentTutorialStep);}}
function endTutorial(skip=false){isTutorialActive=false;gameState.tutorialDone=true;id('tutorialOverlay').style.display='none';id('tutorialDialogue').style.display='none';id('skipTutorialTopBtn').style.display='none';qa('.highlighted-step').forEach(e=>{e.classList.remove('highlighted-step');e.style.zIndex='';e.style.position='';});if(!skip)showToast(t("–î—è–∫—É—é –∑–∞ —Ç–µ —â–æ –ø—Ä–æ–π—à–ª–∏ —Ç—É—Ç–æ—Ä—ñ–∞–ª, —Å–ø–æ–¥—ñ–≤–∞—é—Å—å –í–∞–º –±—É–ª–æ –∫–æ—Ä–∏—Å–Ω–æ —ñ –∑—Ä–æ–∑—É–º—ñ–ª–æ. –ì–∞—Ä–Ω–æ—ó –í–∞–º –≥—Ä–∏ —ñ –ø–∏—à—ñ—Ç—å –ø–æ —Ü—é –≥—Ä—É –≤ —Å–≤–æ—ó—Ö —Å–æ—Ü —Å–µ—Ç—è—Ö —è–∫—â–æ —Å–ø–æ–¥–æ–±–∞–ª–æ—Å—å. –ë—É–¥—É –¥—É–∂–µ –≤–¥—è—á–Ω–∏–π —ñ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –º–æ—ó—Ö —Å–æ—Ü. —Å–µ—Ç–µ–π –¥–ª—è –ø—Ä–æ–ø–æ–Ω—É–≤–∞–Ω–Ω—è —á–æ–≥–æ—Å—å —Å–≤–æ–≥–æ"));saveGame();}
// === –ú–£–ó–ò–ö–ê ===
function updateMusicUI(){const isOwned=ownedTracks.includes(displayedTrackIndex),cost=displayedTrackIndex*3600;nowPlaying.textContent=isOwned?(currentTrack===displayedTrackIndex&&isPlaying?`${t("–ó–∞—Ä–∞–∑:")} ${trackNames[displayedTrackIndex]}`:`${t("–û–±—Ä–∞–Ω–æ:")} ${trackNames[displayedTrackIndex]}`):`${t("–ú–∞–≥–∞–∑–∏–Ω:")} ${trackNames[displayedTrackIndex]}`;if(!isOwned){musicBtn.innerHTML=`üí∞ ${t("–ö—É–ø–∏—Ç–∏ –∑–∞")} ${formatTime(cost)}`;musicBtn.style.background="linear-gradient(45deg, #f1c40f, #f39c12)";}else{musicBtn.style.background="";if(currentTrack===displayedTrackIndex&&isPlaying)musicBtn.textContent=t("–ó—É–ø–∏–Ω–∏—Ç–∏ –º—É–∑–∏–∫—É");else musicBtn.textContent=t("–í–∫–ª—é—á–∏—Ç–∏ –º—É–∑–∏–∫—É");}}
const trackNames=["Phonk #1","Phonk #2","Phonk #3","Phonk #4","Phonk #5","Phonk #6","Phonk #7"];
function initMusic(){const tracks=["asphalt-menace.mp3","digital-overdrive.mp3","drift-phonk-phonk-music-2-434611.mp3","drift-phonk-phonk-music-432222.mp3","phonk-music-409064 (2).mp3","phonk-music-phonk-2025-432208.mp3","pixel-drift.mp3"].map(x=>`musicList/${x}`);displayedTrackIndex=currentTrack;function loadTrack(i){player.src=tracks[i];}loadTrack(currentTrack);player.addEventListener("ended",()=>{if(ownedTracks.length>1){let next;do{next=(currentTrack+1)%tracks.length;}while(!ownedTracks.includes(next));currentTrack=next;displayedTrackIndex=next;loadTrack(currentTrack);player.play();updateMusicUI();}else{player.currentTime=0;player.play();}});musicBtn.addEventListener("click",()=>{if(ownedTracks.includes(displayedTrackIndex)){if(currentTrack!==displayedTrackIndex){currentTrack=displayedTrackIndex;loadTrack(currentTrack);isPlaying=1;player.volume=(gameState.vol||45)/100;player.play().catch(()=>{});}else{if(!isPlaying){isPlaying=1;player.volume=(gameState.vol||45)/100;player.play().catch(()=>{});}else{isPlaying=0;player.pause();}}}else{const cost=displayedTrackIndex*3600;if(score>=cost){score-=cost;ownedTracks.push(displayedTrackIndex);showToast(t("–ö—É–ø–ª–µ–Ω–æ:")+" üéµ");updateScore();saveGame();}else{showToast(t("–ù–µ –≤–∏—Å—Ç–∞—á–∞—î —á–∞—Å—É!"));}}updateMusicUI();});prevTrack.onclick=()=>{displayedTrackIndex=(displayedTrackIndex-1+tracks.length)%tracks.length;updateMusicUI();};nextTrack.onclick=()=>{displayedTrackIndex=(displayedTrackIndex+1)%tracks.length;updateMusicUI();};updateMusicUI();}
// === –Ü–ì–†–û–í–Ü –ú–ï–•–ê–ù–Ü–ö–ò ===
function initClickHandler(){let lastClick=0;clockWrapper.addEventListener("click",evt=>{const now=Date.now();if(now-lastClick<50)return;lastClick=now;if(evt.target.closest("#clickableClock")||evt.target===clockWrapper)addTime();});}
function addTime(){const g=Math.round(clickPower*clickMultiplier*prestigeMultiplier);score+=g;clickCloudTotal+=g;if(g>maxPerClick)maxPerClick=g;clickGainEl.innerHTML=`+${formatTime(g)}`;showFloating(`+${formatTime(g)}`);triggerClickEffect();handleClickCombo();updateScore();updatePrestigeProgress();}
function handleClickCombo(){const n=Date.now();if(n-lastClickTime<MAX_CLICK_INTERVAL)currentCombo++;else currentCombo=1;lastClickTime=n;if(currentCombo>maxComboEver)maxComboEver=currentCombo;if(currentCombo>=COMBO_THRESHOLD){comboCount.textContent=currentCombo;comboBubble.classList.add("show");}clearTimeout(comboTimeout);comboTimeout=setTimeout(()=>{if(currentCombo>=COMBO_THRESHOLD){comboBubble.classList.add("burst");showToast(`${t("–ö–æ–º–±–æ")} √ó${currentCombo}! üî•`);setTimeout(()=>comboBubble.classList.remove("show","burst"),700);}currentCombo=0;},300);}
function triggerClickEffect(){if(!animationsEnabled)return;clock.classList.remove("click-effect-red","click-effect-blue","click-effect-glitch","click-effect-blackhole","click-effect-ripple");void clock.offsetWidth;clock.classList.add("click-effect-"+current.effect);}
function showToast(t){const toastEl=d.createElement("div");toastEl.className="toast";toastEl.textContent=t;toastEl.style.cssText="font-size:18px;padding:22px 48px";toastContainer.appendChild(toastEl);setTimeout(()=>toastEl.remove(),1e4);}
function showFloating(t){if(!animationsEnabled)return;const floatEl=d.createElement("div");floatEl.textContent=t;floatEl.style.cssText="position:absolute;right:20px;top:50px;color:#ffccd1;font-weight:700;opacity:1;transition:all 0.9s ease-out";clockWrapper.appendChild(floatEl);requestAnimationFrame(()=>{floatEl.style.transform="translateX(60px) translateY(-80px)";floatEl.style.opacity="0";});setTimeout(()=>floatEl.remove(),920);}
// === –ê–ü–ì–†–ï–ô–î–ò (FIXED LOGIC) ===
const upgrades=[{n:"–ö–ª—ñ–ø–∞—Ç–∏ –æ—á–∏–º–∞",c:1,l:0},{n:"–£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω",c:8,l:0},{n:"–ì–æ—Ä—Ç–∞—Ç–∏ —Å—Ç—Ä—ñ—á–∫—É",c:40,l:0},{n:"–ú–µ–º-—Ç—É—Ä",c:200,l:0},{n:"–ê–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥",c:1100,l:0},{n:"–ü—ñ–¥–ø–∏—Å–∫–∞",c:6500,l:0},{n:"–°–µ—Ä—ñ–∞–ª-–º–∞—Ä–∞—Ñ–æ–Ω",c:40000,l:0},{n:"–†–æ–±–æ—Ç–∞ –∑ –¥–µ–¥–ª–∞–π–Ω–æ–º",c:250000,l:0},{n:"–ñ–∏—Ç—Ç—î–≤–∏–π –∫—Ä—ñ–Ω–∂",c:1600000,l:0},{n:"Discord-–º–∞—Ä–∞—Ñ–æ–Ω",c:10000000,l:0},{n:"Reels –¥–æ —Ä–∞–Ω–∫—É",c:65000000,l:0},{n:"–§—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ —Ä–æ–∑–¥—É–º–∏",c:400000000,l:0},{n:"–ö—ñ–Ω–µ—Ü—å —á–∞—Å—É",c:315360000000,l:0,isEnding:true,hidden:true,requiresKey:true}];
function fib(n){if(n<=1)return n;let a=0,b=1;for(let i=2;i<=n;i++)[a,b]=[b,a+b];return b;}
function initUpgrades(){upgrades.forEach((u,i)=>{const b=d.createElement("button");b.className="upgrade-btn";if(i>0)b.classList.add("hidden");if(u.requiresKey&&!gameState.hasKey1)b.classList.add("hidden");b.addEventListener("click",()=>buyUpgrade(i));upgradesContainer.appendChild(b);buttons.push(b);u.getC=function(){return u.isEnding?u.c:Math.floor(u.c*fib(u.l+6)*(i+1))};u.up=function(){const c=u.getC();b.innerHTML=`${t(u.n)} ${u.isEnding?'':'(Lv.'+u.l+')'}<span>${formatTime(c)}</span>`;b.disabled=score<c;};u.up();});}
function revealNext(){const c=upgrades.filter(u=>u.l>0).length;if(buttons[c]&&!upgrades[c].isEnding)buttons[c].classList.remove("hidden");if(buttons[12]){if(gameState.hasKey1 && upgrades[11].l > 0) buttons[12].classList.remove("hidden"); else buttons[12].classList.add("hidden");}}
function revealPurchasedUpgrades(){upgrades.forEach((u,i)=>{if(u.l>0&&buttons[i])buttons[i].classList.remove("hidden");});revealNext();}
function buyUpgrade(i){const u=upgrades[i];if(u.requiresKey&&!gameState.hasKey1)return;const c=u.getC();if(score<c)return;score-=c;u.l++;totalUpgradesBought++;autoRate=0;upgrades.forEach((upg,idx)=>{if(upg.l>0){let fibSum=0;for(let lvl=1;lvl<=upg.l;lvl++)fibSum+=fib(lvl+2);autoRate+=fibSum*(idx+1)}});showToast(`${t("–ö—É–ø–ª–µ–Ω–æ:")} ${t(u.n)} ‚úÖ`);if(i===1)setTimeout(()=>showPhoneLockScreen(),500);if(i===2)setTimeout(()=>handleNewsFeedUpgrade(),300);if(i===3)setTimeout(()=>showMeme(),300);if(i===4)setTimeout(()=>showAutoplay(),300);if(i===5)setTimeout(()=>showSubscription(),300);if(i===6)setTimeout(()=>showSeriesMarathon(),300);if(i===7)setTimeout(()=>showDeadlineWork(),300);if(i===8)setTimeout(()=>showCringe(),300);if(i===9)setTimeout(()=>showDiscord(),300);if(i===10)setTimeout(()=>showReels(),300);if(i===11){setTimeout(()=>showPhilosophy(),300);}if(i===12){startEndingSequence();return}requestAnimationFrame(()=>{if(i!==11)revealNext();u.up();updateAllButtons();updateScore();updateStats();updateAchievements();updatePrestigeProgress();});if(i===0){d.body.classList.remove("eye-blink");void d.body.offsetWidth;d.body.classList.add("eye-blink");setTimeout(()=>d.body.classList.remove("eye-blink"),1000);}saveGame();}
function updateAllButtons(){upgrades.forEach(u=>u.up());multipliers.forEach(m=>m.up&&m.up());}
// === –ú–ù–û–ñ–ù–ò–ö–ò ===
const multipliers=[{n:"–ü–æ–¥–≤—ñ–π–Ω–∏–π –∫–ª—ñ–∫",c:5000,m:2,b:0},{n:"–ü–æ—Ç—Ä—ñ–π–Ω–∏–π –∫–ª—ñ–∫",c:50000,m:3,b:0},{n:"x10 –∑–∞ –∫–ª—ñ–∫",c:1000000,m:10,b:0},{n:"x50 –∑–∞ –∫–ª—ñ–∫",c:20000000,m:50,b:0},{n:"x100 –∑–∞ –∫–ª—ñ–∫",c:100000000,m:100,b:0}];
function initMultipliers(){multipliers.forEach((m,idx)=>{const b=d.createElement("button");b.className="upgrade-btn multiplier-btn";function upB(){if(m.b){b.remove();return;}const a=score>=m.c;b.innerHTML=`${t(m.n)}<span>${formatTime(m.c)}</span>`;b.disabled=!a;b.style.background=a?"":"#334155";b.style.opacity=a?"1":"0.5";}b.addEventListener("click",()=>{if(score<m.c||m.b)return;requestAnimationFrame(()=>{score-=m.c;m.b=1;clickMultiplier=m.m;showToast(`${t("–ö—É–ø–ª–µ–Ω–æ:")} ${t(m.n)}!`);upB();updateScore();updateStats();saveGame();});},{passive:true});multipliersContainer.appendChild(b);m.up=upB;upB();});}
// === –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===
function updateScore(){scoreText.innerHTML=`${t("–ß–∞—Å—É –≤–∏—Ç—Ä–∞—á–µ–Ω–æ:")} ${formatTime(score)}`;cloudTotalEl.innerHTML=`${formatTime(clickCloudTotal)}`;updateAllButtons();if(window.musicBtn)musicBtn.dispatchEvent(new Event('check'));}
function updateStats(){realTimePlayedEl.textContent=formatTime((Date.now()-sessionStart)/1000);virtualTimeEl.textContent=formatTime(score);totalUpgradesEl.textContent=totalUpgradesBought;maxPerClickEl.textContent=formatTime(maxPerClick);prestigeMultEl.textContent=prestigeMultiplier.toFixed(2);id("maxAutoRate").textContent=formatTime(autoRate);id("maxCombo").textContent=maxComboEver;id("totalReverbs").textContent=totalReverbs;const a=achievementsList.filter(x=>x.done).length;id("achievedCount").textContent=a;id("totalAchievements").textContent=achievementsList.length;id("shapeSkinsCount").textContent=ownedSkins.shapes.length;id("clockSkinsCount").textContent=ownedSkins.clockSkins.length;id("handSkinsCount").textContent=ownedSkins.handSkins.length;id("effectSkinsCount").textContent=ownedSkins.effects.length;id("totalSkins").textContent=ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length;updateReverbText();updatePrestigeProgress();}
function formatTime(s){s=Math.floor(s);const u=gameState.lang==='uk'?[{n:" —Ç–∏—Å",v:31536e6},{n:" —Å—Ç",v:31536e5},{n:" –¥–µ—Å",v:31536e4},{n:" —Ä",v:31536e3},{n:" –º—ñ—Å",v:2592e3},{n:" –¥–Ω",v:86400},{n:" –≥–æ–¥",v:3600},{n:" —Ö–≤",v:60},{n:" —Å–µ–∫",v:1}]:[{n:" mil",v:31536e6},{n:" cen",v:31536e5},{n:" dec",v:31536e4},{n:" y",v:31536e3},{n:" mo",v:2592e3},{n:" d",v:86400},{n:" h",v:3600},{n:" m",v:60},{n:" s",v:1}];let r=s,p=[];for(const x of u){const a=Math.floor(r/x.v);if(a>0){p.push(`${a}${x.n}`);r%=x.v;}}return p.length?p.join(" "):`${s}${u[8].n}`;}
// === –î–û–°–Ø–ì–ù–ï–ù–ù–Ø ===
let achievementsList=[];
function initAchievements(){achievementsList=[{t:"–ü–µ—Ä—à–∏–π –∫–ª—ñ–∫",tg:1,g:()=>clickCloudTotal,done:false},{t:"100 —Å–µ–∫",tg:100,g:()=>score,done:false},{t:"–ü–µ—Ä—à–∞ –ø–æ–∫—É–ø–∫–∞",tg:1,g:()=>totalUpgradesBought,done:false},{t:"–ê–≤—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ",tg:1,g:()=>autoRate>0?1:0,done:false},{t:"–ö–æ–º–±–æ-–º–∞–π—Å—Ç–µ—Ä",tg:50,g:()=>maxComboEver,done:false},{t:"–ú–∞–π—Å—Ç–µ—Ä —Ñ–æ—Ä–º",tg:3,g:()=>ownedSkins.shapes.length,done:false},{t:"–ì–æ—Å–ø–æ–¥–∞—Ä —Ä–∞–º–æ–∫",tg:3,g:()=>ownedSkins.clockSkins.length,done:false},{t:"–ö–æ–ª–µ–∫—Ü—ñ–æ–Ω–µ—Ä —Å—Ç—Ä—ñ–ª–æ–∫",tg:3,g:()=>ownedSkins.handSkins.length,done:false},{t:"–ú–∞–≥ –µ—Ñ–µ–∫—Ç—ñ–≤",tg:3,g:()=>ownedSkins.effects.length,done:false},{t:"–°—Ç–∏–ª—å–Ω–∏–π",tg:1,g:()=>(current.shape!=="round"||current.clock!=="neon-blue")?1:0,done:false}];const achRoot=id("achievements");achRoot.innerHTML='';achievementsList.forEach(a=>{const achEl=d.createElement("div");achEl.className="achievement";achEl.innerHTML=`<strong>${t(a.t)}</strong><div class="ach-progress"></div><div class="ach-state">0%</div>`;achRoot.appendChild(achEl);a.p=achEl.querySelector(".ach-progress");a.s=achEl.querySelector(".ach-state");});}
function updateAchievements(){achievementsList.forEach(a=>{if(a.p&&a.p.parentNode){const el=a.p.parentNode.querySelector('strong');if(el)el.textContent=t(a.t);}const v=a.g(),p=Math.min(100,(v/a.tg)*100);a.p&&(a.p.style.width=p+"%");if(p>=100&&!a.done){a.done=true;if(a.s){a.s.textContent="‚úÖ";a.s.style.color="#8df299"}if(!firstAchievementsCheck)showToast(t("–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è:")+" "+t(a.t)+" ‚úÖ");}else if(p<100&&a.s)a.s.textContent=Math.floor(p)+"%";});if(firstAchievementsCheck)firstAchievementsCheck=false;}
// === –°–ö–Ü–ù–ò (–í–ò–ü–†–ê–í–õ–ï–ù–û) ===
const clockSkins=[{id:"neon-blue",n:"–ù–µ–æ–Ω —Å–∏–Ω—ñ–π",p:0},{id:"purple",n:"–ü—É—Ä–ø—É—Ä–Ω–∏–π",p:64800},{id:"pink",n:"–†–æ–∂–µ–≤–∏–π",p:129600},{id:"black",n:"–ß–æ—Ä–Ω–∏–π",p:259200}],shapes=[{id:"round",n:"–ö—Ä—É–≥",p:0},{id:"square",n:"–ö–≤–∞–¥—Ä–∞—Ç",p:28800},{id:"diamond",n:"–†–æ–º–±",p:86400},{id:"oval",n:"–û–≤–∞–ª",p:172800}],handSkins=[{id:"darkblue",n:"–¢–µ–º–Ω–æ-—Å–∏–Ω—ñ",p:0},{id:"pixel",n:"–ü—ñ–∫—Å–µ–ª—å–Ω—ñ",p:900},{id:"neon",n:"–ù–µ–æ–Ω–æ–≤—ñ",p:9000},{id:"chrome",n:"–•—Ä–æ–º",p:43200}],effects=[{id:"red",n:"–ß–µ—Ä–≤–æ–Ω–∏–π —Å–ø–∞–ª–∞—Ö",p:0},{id:"blue",n:"–°–∏–Ω—ñ–π –≤–∏–±—É—Ö",p:21600},{id:"glitch",n:"–ì–ª—ñ—Ç—á",p:108000},{id:"blackhole",n:"–ß–æ—Ä–Ω–∞ –¥—ñ—Ä–∞",p:360000},{id:"ripple",n:"–•–≤–∏–ª—è —á–∞—Å—É",p:720000}];
function buySkin(type,i,p,n){if(ownedSkins[type].includes(i)){current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]=i;applyAllSkins();refreshAllSkinGrids();return showToast(t("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!"))}if(score<p)return showToast(t("–ù–µ –≤–∏—Å—Ç–∞—á–∞—î —á–∞—Å—É!"));score-=p;ownedSkins[type].push(i);current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]=i;applyAllSkins();updateScore();updateStats();updateAchievements();updatePrestigeProgress();showToast(`${t("–ö—É–ø–ª–µ–Ω–æ:")} ${t(n)} ‚úÖ`);refreshAllSkinGrids();saveGame();}
function applyAllSkins(){qa('.clock').forEach(c=>c.className="clock "+current.shape);const c=current.clock,cl=c==="neon-blue"?"#0ea5e9":c==="purple"?"#8b5cf6":c==="pink"?"#ec4899":"#111";qa('.clock').forEach(el=>{el.style.borderColor=cl;el.style.boxShadow=`0 0 50px ${cl}, 0 0 100px ${cl}`});const h=current.hand;qa('.hand:not(.second)').forEach(e=>{e.style.background=h==="pixel"?"linear-gradient(#fff,#aaa)":h==="neon"?"#0ea5e9":h==="chrome"?"linear-gradient(90deg,#ddd,#888,#ddd)":"#1e3a8a";e.style.boxShadow=h==="neon"?"0 0 25px #0ea5e9, 0 0 60px #0ea5e9":h==="chrome"?"0 0 15px #fff":"";e.style.animation=h==="neon"?"neonPulse 2s infinite alternate":"";});}
function createSkinGrid(ct,ls,type){const r=id(ct);r.innerHTML="";ls.forEach(s=>{const skinEl=d.createElement("div");skinEl.className="skin";skinEl.textContent=t(s.n);const o=ownedSkins[type].includes(s.id);const a=current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]===s.id;if(o){skinEl.classList.add("owned");if(a)skinEl.classList.add("active");skinEl.onclick=()=>{current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]=s.id;applyAllSkins();refreshAllSkinGrids();showToast(t("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!"));}}else{skinEl.style.opacity="0.4";if(score>=s.p){skinEl.style.opacity="1";skinEl.style.boxShadow="0 0 15px #0ff"}skinEl.innerHTML+=`<br><small style="color:#ff00ff">${formatTime(s.p)}</small>`;skinEl.onclick=()=>buySkin(type,s.id,s.p,s.n)}r.appendChild(skinEl)})}
function refreshAllSkinGrids(){createSkinGrid("shapeSkins",shapes,"shapes");createSkinGrid("clockSkins",clockSkins,"clockSkins");createSkinGrid("handSkins",handSkins,"handSkins");createSkinGrid("effectSkins",effects,"effects")}
function updateSkinHighlights(){[{l:shapes,t:"shapes",c:"shapeSkins"},{l:clockSkins,t:"clockSkins",c:"clockSkins"},{l:handSkins,t:"handSkins",c:"handSkins"},{l:effects,t:"effects",c:"effectSkins"}].forEach(obj=>{const ct=id(obj.c);if(!ct)return;Array.from(ct.children).forEach((el,i)=>{const s=obj.l[i],o=ownedSkins[obj.t].includes(s.id);if(!o){if(score>=s.p){el.style.opacity="1";el.style.boxShadow="0 0 15px #0ff"}else{el.style.opacity="0.4";el.style.boxShadow=""}}})})}
function initSkins(){refreshAllSkinGrids();applyAllSkins();}
// === –ì–û–î–ò–ù–ù–ò–ö –¢–ê –†–ï–í–ï–†–ë ===
function updateClockHands(){if(isTimeBroken)return;const n=new Date();let s=n.getSeconds()+n.getMilliseconds()/1000,m=n.getMinutes()+s/60,h=(n.getHours()%12||12)+m/60;if(reverseClockHands){s=60-s;m=60-m;h=12-h;if(h<=0)h+=12;}qa("#clickableClock .second").forEach(x=>x.style.transform=`translateX(-50%) rotate(${s*6}deg)`);qa("#clickableClock .minute").forEach(x=>x.style.transform=`translateX(-50%) rotate(${m*6}deg)`);qa("#clickableClock .hour").forEach(x=>x.style.transform=`translateX(-50%) rotate(${h*30}deg)`);}
function updatePrestigeProgress(){currentPrestigeProgress=score;const pB=id('prestigeProgressBar'),pT=id('prestigeProgressText'),pP=Math.min(100,(currentPrestigeProgress/prestigeThreshold)*100);if(pB){pB.style.width=pP+'%';pB.style.background=pP>=100?'linear-gradient(90deg, #10b981, #34d399)':pP>=50?'linear-gradient(90deg, #f59e0b, #fbbf24)':'linear-gradient(90deg, #ef4444, #f87171)';}if(pT)pT.innerHTML=`${formatTime(currentPrestigeProgress)} / ${formatTime(prestigeThreshold)}`;updateReverbButtonState();}
function updateReverbButtonState(){const c=currentPrestigeProgress>=prestigeThreshold;reverbBtn.disabled=!c;reverbBtn.style.opacity=c?'1':'0.6';reverbBtn.style.cursor=c?'pointer':'not-allowed';reverbBtn.style.background=c?'linear-gradient(90deg, #10b981, #34d399)':'linear-gradient(90deg, #6b7280, #9ca3af)';}
function updateReverbText(){qa("#nextMultiplier").forEach(el=>el.textContent=(prestigeMultiplier*1.2).toFixed(2));qa('#nextMultiplierFooter').forEach(el=>el.textContent=(prestigeMultiplier*1.2).toFixed(2));}
const restartEffect={active:!1,clocksInt:null,bubblesInt:null,init(){const e=d.createElement("div");e.id="restartEffectOverlay";e.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;display:none;pointer-events:none;background:transparent;";d.body.appendChild(e);this.clocksContainer=d.createElement("div");this.clocksContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";this.bubblesContainer=d.createElement("div");this.bubblesContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";e.appendChild(this.clocksContainer);e.appendChild(this.bubblesContainer);this.completionScreen=d.createElement("div");this.completionScreen.id="reverbCompletionScreen";this.completionScreen.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:10002;display:none;align-items:center;justify-content:center;flex-direction:column;color:white;font-family:Poppins;text-align:center;";this.completionScreen.innerHTML='<div id="reverbMsg" style="font-size:32px;margin-bottom:20px;text-shadow:0 0 20px #0ea5e9"></div><div id="reverbMultVal" style="font-size:24px;margin-bottom:20px"></div><div id="reverbContBtn" style="font-size:18px;color:#cfeaff;cursor:pointer;"></div>';d.body.appendChild(this.completionScreen)},start(){this.active=!0;id("restartEffectOverlay").style.display="block";this.clocksContainer.innerHTML="";this.bubblesContainer.innerHTML="";this.clocksInt=setInterval(()=>this.createFlyingClock(),300);this.bubblesInt=setInterval(()=>this.createStatBubble(),1200)},stop(){this.active=!1;clearInterval(this.clocksInt);clearInterval(this.bubblesInt);id("restartEffectOverlay").style.display="none"},showCompletionScreen(){id("reverbOverlay").classList.add("hidden");id("restartEffectOverlay").style.display="none";id("timeTunnel").classList.remove("active","intense");id("reverbMsg").textContent=t("–í–∏ —É—Å–ø—ñ—à–Ω–æ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è —É —á–∞—Å—ñ! –í–∞—à –º–Ω–æ–∂–Ω–∏–∫ —Ç–µ–ø–µ—Ä:");id("reverbMultVal").textContent=t("–ù–æ–≤–∏–π –º–Ω–æ–∂–Ω–∏–∫:")+" "+prestigeMultiplier.toFixed(2)+"√ó";id("reverbContBtn").textContent=t("–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏");this.completionScreen.style.display="flex"},hideCompletionScreen(){this.completionScreen.style.display="none"},createFlyingClock(){if(!animationsEnabled)return;const e=d.createElement("div");e.className="flying-clock";const t=80+100*Math.random();e.style.width=e.style.height=t+"px";e.style.left=Math.random()*100+"%";e.style.top=Math.random()*100+"%";e.style.animationDuration=4+6*Math.random()+"s";e.style.animationDelay=.5*Math.random()+"s";Math.random()>.5&&(e.style.transform="scaleX(-1)");this.clocksContainer.appendChild(e);setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1e4)},createStatBubble(){if(!animationsEnabled)return;const e=d.createElement("div");e.className="stat-bubble";const n=[t("–ù–∞–π–¥–æ–≤—à–µ –∫–æ–º–±–æ:")+" "+(maxComboEver||0),t("–ß–∞—Å—É –≤–∏—Ç—Ä–∞—á–µ–Ω–æ:")+" "+formatTime(clickCloudTotal),t("–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫—ñ–≤ –∑—Ä–æ–±–ª–µ–Ω–æ:")+" "+totalReverbs,t("–ó—ñ–±—Ä–∞–Ω–æ —Å–∫—ñ–Ω—ñ–≤:")+" "+((ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length)||0)];e.textContent=n[Math.floor(Math.random()*n.length)];e.style.left=10+80*Math.random()+"%";e.style.top=20+60*Math.random()+"%";this.bubblesContainer.appendChild(e);setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},4e3)}};
function startReverbMode(){const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='none';reverbOverlay.classList.remove("hidden");timeTunnel.classList.add("active");reverbHint.style.opacity="1";isReverbActive=1;reverbClock.className=`clock ${current.shape}`;clockSkins.find(s=>s.id===current.clock);handSkins.find(s=>s.id===current.hand);updateReverbClockHands();setTimeout(()=>reverbHint.style.opacity="0",3000);}
function updateReverbClockHands(){if(!isReverbActive)return;const hands=qa("#reverbClock .hand");if(hands.length===0)return;if(reverbClock.classList.contains("reverb-chaos")){requestAnimationFrame(updateReverbClockHands);return;}const now=new Date(),sec=now.getSeconds()+now.getMilliseconds()/1000,min=now.getMinutes()+sec/60,hr=(now.getHours()%12||12)+min/60;qa("#reverbClock .second").forEach(h=>h.style.transform=`translateX(-50%) rotate(${sec*6}deg)`);qa("#reverbClock .minute").forEach(h=>h.style.transform=`translateX(-50%) rotate(${min*6}deg)`);qa("#reverbClock .hour").forEach(h=>h.style.transform=`translateX(-50%) rotate(${hr*30}deg)`);requestAnimationFrame(updateReverbClockHands);}
function startReverbHold(evt){if(evt.type.includes('touch'))evt.preventDefault();if(!isReverbActive)return;reverbHint.style.opacity="0";reverbClock.classList.add("reverb-mode","reverb-chaos");timeTunnel.classList.add("intense");restartEffect.start();if(animationsEnabled){qa("#reverbClock .hand").forEach((h,i)=>{const o=0.5+2*Math.random(),n=Math.random()>0.5?"normal":"reverse";h.style.setProperty("--duration",`${o}s`);h.style.setProperty("--direction",n);h.style.animation=`chaosSpin ${o}s linear infinite ${n}`;});}reverbHoldTimeout=setTimeout(completeReverb,10000);}
function stopReverbHold(evt){if(evt&&evt.type.includes('touch'))evt.preventDefault();clearTimeout(reverbHoldTimeout);if(isReverbActive){reverbClock.classList.remove("reverb-mode","reverb-chaos");timeTunnel.classList.remove("intense");qa("#reverbClock .hand").forEach(h=>{h.style.animation="none";h.style.removeProperty("--duration");h.style.removeProperty("--direction");});updateReverbClockHands();restartEffect.stop();}}
reverbClock.addEventListener("mousedown",startReverbHold);reverbClock.addEventListener("touchstart",startReverbHold,{passive:false});
reverbClock.addEventListener("mouseup",stopReverbHold);reverbClock.addEventListener("mouseleave",stopReverbHold);
reverbClock.addEventListener("touchend",stopReverbHold);reverbClock.addEventListener("touchcancel",stopReverbHold);
function completeReverb(){if(currentPrestigeProgress<prestigeThreshold){showToast(`${t("–ù–µ –≤–∏—Å—Ç–∞—á–∞—î —á–∞—Å—É!")} ${t("–¢—Ä–µ–±–∞ —â–µ")} ${formatTime(prestigeThreshold - currentPrestigeProgress)}`);return;}stopReverbHold(new Event('manual'));achievementsList.forEach(a=>(a.done=false,a.s&&(a.s.textContent="0%"),a.p&&(a.p.style.width="0%")));ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]};current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};prestigeThreshold+=7200;prestigeMultiplier*=1.2;totalReverbs++;currentPrestigeProgress=score=clickCloudTotal=currentCombo=0;clickPower=maxPerClick=1;autoRate=totalUpgradesBought=0;upgrades.forEach((u,idx)=>(u.l=0,buttons[idx]&&buttons[idx].classList[idx?"add":"remove"]("hidden"),u.up()));multipliers.forEach(m=>m.b=0);clickMultiplier=1;multipliersContainer.innerHTML='';initMultipliers();const flashEl=d.createElement("div");flashEl.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10001;pointer-events:none;animation:flashFade 1s ease-out forwards;";d.body.appendChild(flashEl);setTimeout(()=>{flashEl.remove();restartEffect.showCompletionScreen();restartEffect.completionScreen.querySelector("div:nth-child(2)").textContent=`Multiplier: ${prestigeMultiplier.toFixed(2)}√ó`;updateReverbText();const continueHandler=()=>{restartEffect.hideCompletionScreen();isReverbActive=0;if(keepMusicOnPrestige&&!isPlaying){isPlaying=1;player.play().catch(()=>{});musicBtn.textContent="‚è∏ Stop";}updateScore();updateStats();updateAchievements();refreshAllSkinGrids();applyAllSkins();saveConstellation();const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='block';d.removeEventListener('click',continueHandler);d.removeEventListener('touchstart',continueHandler);saveGame();};d.addEventListener('click',continueHandler);d.addEventListener('touchstart',continueHandler);},1000);setTimeout(()=>showConstellationAfterRebirth(),2000);}
// === –°–ò–°–¢–ï–ú–ê –°–£–ó–Ü–†'–Ø (–ó –ü–ï–†–ï–ö–õ–ê–î–û–ú) ===
function initConstellationSystem(){loadConstellation();const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;const size=isMobile?'408px':'800px';id('constellationContainer').innerHTML='<div id="constellationBorder" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:'+size+';height:'+size+';border:2px solid #666;border-radius:50%;pointer-events:none;z-index:5;box-shadow:0 0 20px rgba(100,100,100,0.5),inset 0 0 15px rgba(100,100,100,0.3);"></div><div id="constellationClock" style="position:relative;width:800px;height:800px;margin:auto;"></div><div id="constellationSkillPoints" style="position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.7);color:#fff;padding:10px;border-radius:5px;z-index:1000;display:none;">'+t("–û—á–∫–∏: ")+'0</div><button id="constellationExitBtn" style="position:absolute;bottom:20px;right:20px;padding:10px 20px;background:#f44336;color:white;border:none;border-radius:5px;cursor:pointer;z-index:1000;">'+t("–ü–æ–∫–∏–Ω—É—Ç–∏ —Å—É–∑—ñ—Ä'—è")+'</button><div id="constellationUpgradePanel" style="position:absolute;bottom:60px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.9);border-radius:10px;padding:15px;display:none;z-index:1000;min-width:300px;"><div id="constellationUpgradeContent"></div><div style="text-align:center;margin-top:10px;"><button id="constellationBuyBtn" style="padding:8px 16px;background:#4CAF50;color:white;border:none;border-radius:4px;cursor:pointer;display:none;">'+t("–ö—É–ø–∏—Ç–∏ –≤–º—ñ–Ω–Ω—è")+'</button><button onclick="hideUpgradePanel()" style="padding:8px 16px;background:#f44336;color:white;border:none;border-radius:4px;cursor:pointer;margin-left:10px;">'+t("–ó–∞–∫—Ä–∏—Ç–∏")+'</button></div></div>';id('constellationExitBtn').onclick=hideConstellation;}
const createConstellation=()=>{const e=id("constellationClock");if(!e)return;e.innerHTML='';const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;e.style.transform='translate(-50%,-50%) scale('+(isMobile?0.1:0.1)+')';e.style.position='absolute';e.style.top='50%';e.style.left='50%';addStarsToConstellation();};
const addStarsToConstellation=()=>{const e=id("constellationClock");if(!e)return;[constellation.hourHand,constellation.minuteHand,constellation.secondHand].forEach((t,o)=>{const n=d.createElement("div");n.className='constellation-line';if(o===0)n.classList.add('hour-hand');else if(o===1)n.classList.add('minute-hand');else if(o===2)n.classList.add('second-hand');n.id='handLine'+o;n.style.transform='rotate('+t.angle+'deg)';n.style.left='50%';n.style.top='50%';n.style.transformOrigin='0% 50%';n.style.width='0px';n.style.transition='width 1s ease, opacity 1s ease';e.appendChild(n);});const t=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];t.forEach(t=>{const o=d.createElement("div");o.className='constellation-star';o.id='star_'+t.id;o.dataset.starId=t.id;const n=400+t.distance*Math.cos(t.angle*Math.PI/180),a=400+t.distance*Math.sin(t.angle*Math.PI/180);o.style.left=n+'px';o.style.top=a+'px';o.onclick=()=>showUpgradePanel(t.id);e.appendChild(o);});const o=d.createElement("div");o.className='constellation-center';o.id='constCenter';o.onclick=()=>showUpgradePanel('center');e.appendChild(o);updateConstellationDisplay();};
const showConstellationAfterRebirth=()=>{createConstellation();const e=id('constellationContainer');if(!e)return;e.style.display='flex';isConstellationVisible=true;const t=id('constellationClock');if(!t)return;const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;setTimeout(()=>{t.style.transition='transform 2s cubic-bezier(0.175, 0.885, 0.32, 1.275)';t.style.transform='translate(-50%,-50%) scale('+(isMobile?0.55:1)+')';},500);addSkillPoint();const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='none';};
const hideConstellation=()=>{isConstellationVisible=false;const e=id('constellationContainer');if(e)e.style.display='none';id('constellationSkillPoints').style.display='none';saveConstellation();hideUpgradePanel();const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='block';if(skillPoints>0)showToast(t("–ó–∞–ª–∏—à–∏–ª–æ—Å—å –æ—á–æ–∫: ")+skillPoints+" ‚≠ê");};
const addSkillPoint=()=>{skillPoints++;updateConstellationDisplay();showToast(t("–û—Ç—Ä–∏–º–∞–Ω–æ 1 –æ—á–∫–æ –Ω–∞–≤–∏—á–æ–∫ –¥–ª—è —Å—É–∑—ñ—Ä'—è! ‚≠ê"));};
const updateConstellationDisplay=()=>{const e=id('constCenter');const isCenterUnlocked=constellation.center.unlocked;if(e)if(constellation.center.unlocked){e.classList.add('active');e.title=t('–Ø–¥—Ä–æ —á–∞—Å—É')+' ('+t('–†—ñ–≤–µ–Ω—å ')+constellation.center.level+')\n'+t('–ë–æ–Ω—É—Å: ')+'+'+constellation.center.bonusPerLevel+' '+t('—Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É');}else e.classList.remove('active');const tArr=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];tArr.forEach(star=>{const e=id('star_'+star.id);if(!e)return;if(!isCenterUnlocked){e.style.opacity='0.2';e.style.pointerEvents='none';e.classList.remove('active','can-afford');return;}else{e.style.opacity='1';e.style.pointerEvents='all';}if(star.unlocked){e.classList.add('active');e.classList.remove('can-afford');let o='';switch(star.bonus.type){case'prestige':o=t('–ú–Ω–æ–∂–Ω–∏–∫ –ø—Ä–µ—Å—Ç–∏–∂—É +')+star.bonus.value;break;case'clickMultiplier':o=t('–ú–Ω–æ–∂–Ω–∏–∫ –∫–ª—ñ–∫—É √ó')+star.bonus.value;break;case'autoRate':o='+'+star.bonus.value+t(' –∞–≤—Ç–æ/—Å–µ–∫');break;case'clickPower':o='+'+star.bonus.value+t(' –¥–æ –∫–ª—ñ–∫—É');break;case'combo':o='+'+star.bonus.value+t(' –¥–æ –∫–æ–º–±–æ');break;case'skinDiscount':o=t('–ó–Ω–∏–∂–∫–∞ ')+(star.bonus.value*100)+t('% –Ω–∞ —Å–∫—ñ–Ω–∏');break;case'all':o=t('–ó–∞–≥–∞–ª—å–Ω–∏–π –º–Ω–æ–∂–Ω–∏–∫ √ó')+star.bonus.value;}e.title=t('–†–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ!')+'\n'+o;}else if(canAffordStar(star.id)){e.classList.add('can-afford');e.classList.remove('active');e.title=t('–í–∞—Ä—Ç—ñ—Å—Ç—å: ')+star.cost+' '+t('–æ—á–∫–æ(—ñ–≤) –Ω–∞–≤–∏—á–æ–∫');}else{e.classList.remove('active','can-afford');e.title=t('–ü–æ—Ç—Ä—ñ–±–Ω–æ ')+star.cost+' '+t('–æ—á–∫–æ(—ñ–≤) –Ω–∞–≤–∏—á–æ–∫');}});[constellation.hourHand,constellation.minuteHand,constellation.secondHand].forEach((t,o)=>{const n=id('handLine'+o);if(!n)return;if(!isCenterUnlocked){n.style.opacity='0.1';n.style.width='0px';n.classList.remove('active');}else{let len=30;t.stars.forEach(s=>{if(s.unlocked)len=s.distance;});n.style.width=len+'px';n.style.opacity='1';if(len>30)n.classList.add('active');else n.classList.remove('active');}});const o=id('constellationSkillPoints');if(o){o.textContent=t('–û—á–∫–∏: ')+skillPoints;o.style.display=isConstellationVisible?'block':'none';}};
const canAffordStar=e=>{const t=findStarById(e);return!!t&&skillPoints>=t.cost;};
const findStarById=e=>{const t=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];return t.find(t=>t.id===e);};
const showUpgradePanel=e=>{const tPanel=id('constellationUpgradePanel'),o=id('constellationUpgradeContent'),b=id('constellationBuyBtn');if(!tPanel||!o||!b)return;b.style.display='none';b.onclick=null;if(e==='center'){const c=constellation.center;o.innerHTML='<div><strong>'+t(c.name)+'</strong><div>'+(c.unlocked?t('–†–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ'):t('–í–∞—Ä—Ç—ñ—Å—Ç—å: ')+c.cost+' '+t('–æ—á–∫–æ'))+'</div><small>'+t('–î–∞—î ')+c.bonusPerLevel+t(' —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–∏—Ö –∑—ñ—Ä–æ–∫.')+'</small></div>';if(!c.unlocked&&skillPoints>=c.cost){b.style.display='inline-block';b.onclick=()=>buyConstellationUpgrade('center');}}else{if(!constellation.center.unlocked)return;const n=findStarById(e);if(!n)return;let a='';switch(n.bonus.type){case'prestige':a=t('–ú–Ω–æ–∂–Ω–∏–∫ –ø—Ä–µ—Å—Ç–∏–∂—É +')+n.bonus.value;break;case'clickMultiplier':a=t('–ú–Ω–æ–∂–Ω–∏–∫ –∫–ª—ñ–∫—É √ó')+n.bonus.value;break;case'autoRate':a='+'+n.bonus.value+t(' –∞–≤—Ç–æ/—Å–µ–∫');break;case'clickPower':a='+'+n.bonus.value+t(' –¥–æ –∫–ª—ñ–∫—É');break;case'skinDiscount':a=t('–ó–Ω–∏–∂–∫–∞ ')+(n.bonus.value*100)+t('% –Ω–∞ —Å–∫—ñ–Ω–∏');break;case'all':a=t('–ó–∞–≥–∞–ª—å–Ω–∏–π –º–Ω–æ–∂–Ω–∏–∫ √ó')+n.bonus.value;}o.innerHTML='<div><strong>'+t('–ó—ñ—Ä–∫–∞ ')+e.toUpperCase()+'</strong><div>'+(n.unlocked?t('–†–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ'):t('–í–∞—Ä—Ç—ñ—Å—Ç—å: ')+n.cost+t(' –æ—á–æ–∫'))+'</div><small>'+t('–ë–æ–Ω—É—Å: ')+a+'</small></div>';if(!n.unlocked&&skillPoints>=n.cost){b.style.display='inline-block';b.onclick=()=>buyConstellationUpgrade(e);}}tPanel.style.display='block';};
const buyConstellationUpgrade=e=>{if(e==='center'){if(constellation.center.unlocked||skillPoints<constellation.center.cost)return;skillPoints-=constellation.center.cost;constellation.center.unlocked=true;constellation.center.level=1;showToast(t('–Ø–¥—Ä–æ —á–∞—Å—É –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –¢–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ñ —ñ–Ω—à—ñ –∑—ñ—Ä–∫–∏! ‚≠ê'));}else{if(!constellation.center.unlocked){showToast(t('–°–ø–æ—á–∞—Ç–∫—É –∞–∫—Ç–∏–≤—É–π—Ç–µ –Ø–¥—Ä–æ –ß–∞—Å—É (—Ü–µ–Ω—Ç—Ä)! ‚ö†Ô∏è'));return;}const tStar=findStarById(e);if(!tStar||tStar.unlocked||skillPoints<tStar.cost)return;const o=[constellation.hourHand,constellation.minuteHand,constellation.secondHand].find(o=>o.stars.some(o=>o.id===e));if(o){const n=o.stars.findIndex(o=>o.id===e);if(n>0&&!o.stars[n-1].unlocked){showToast(t('–°–ø–æ—á–∞—Ç–∫—É –∞–∫—Ç–∏–≤—É–π—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –∑—ñ—Ä–∫—É –Ω–∞ —Ü—ñ–π —Å—Ç—Ä—ñ–ª—Ü—ñ!'));return;}}skillPoints-=tStar.cost;tStar.unlocked=true;applyConstellationBonus(tStar);showToast(t('–ó—ñ—Ä–∫–∞ ')+e.toUpperCase()+t(' –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞! ‚≠ê'));}updateConstellationDisplay();saveConstellation();updateStats();hideUpgradePanel();checkFirstKeyCondition();}
// === –û–ù–û–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø checkFirstKeyCondition ===
function checkFirstKeyCondition(){if(gameState.hasKey1)return;const allStars=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];if(allStars.every(s=>s.unlocked)&&constellation.center.unlocked){showConstKeySeq();setTimeout(()=>{if(buttons[12])buttons[12].classList.remove("hidden");showToast("üîë –î–æ—Å—Ç—É–ø –¥–æ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–ø–≥—Ä–µ–π–¥–∞ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ!");},2000);}}
function showConstKeySeq(){const o=id('constKeyOverlay'),t=id('constKeyText'),k=id('constKeyItem'),b=id('constKeyBtn');o.style.display='flex';k.style.display='none';b.style.display='block';t.textContent="–í–∏ –≤—ñ–¥—á—É–≤–∞—î—Ç–µ –¥–∏–≤–Ω—É –≤—ñ–±—Ä–∞—Ü—ñ—é...";b.onclick=()=>{t.textContent="–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –∑'—è–≤–∏–≤—Å—è –ø—Ä–µ–¥–º–µ—Ç...";b.style.display='none';k.style.display='block';k.classList.remove('key-vanish');k.onclick=()=>{k.classList.add('key-vanish');setTimeout(()=>{k.style.display='none';t.textContent="–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –Ω–µ–≤—ñ–¥–æ–º–∏–π –∫–ª—é—á (1/2)";b.style.display='block';b.textContent="–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏";b.onclick=()=>{o.style.display='none';gameState.hasKey1=true;showToast("üîë –ö–õ–Æ–ß –û–¢–†–ò–ú–ê–ù–û");buttons[12].classList.remove("hidden");saveGame()}},600)}};}
const applyConstellationBonus=e=>{switch(e.bonus.type){case'prestige':prestigeMultiplier+=e.bonus.value;break;case'clickMultiplier':clickMultiplier*=e.bonus.value;break;case'autoRate':autoRate+=e.bonus.value;break;case'clickPower':clickPower+=e.bonus.value;break;case'skinDiscount':break;case'all':clickPower*=e.bonus.value;autoRate*=e.bonus.value;}};
const saveConstellation=()=>{const e={constellation:constellation,skillPoints:skillPoints};localStorage.setItem('timeClickerConstellation',JSON.stringify(e));};
const loadConstellation=()=>{const saved=localStorage.getItem('timeClickerConstellation');if(saved){try{const data=JSON.parse(saved);constellation=data.constellation||constellation;skillPoints=data.skillPoints||0;}catch(err){console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—É–∑—ñ—Ä\'—è:',err);}}const allStars=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];allStars.forEach(star=>{if(star.unlocked)applyConstellationBonus(star);});};
const hideUpgradePanel=()=>{const e=id('constellationUpgradePanel');if(e)e.style.display='none';};
// === –°–ï–ö–†–ï–¢–ù–ò–ô –†–ï–ñ–ò–ú (DEV MODE) ===
function initSecretSystem(){if(!worldTitle)return;worldTitle.addEventListener("keydown",e=>{if(e.key==="Enter")e.preventDefault()});const norm=()=>{let t=worldTitle.textContent.trim();if(!t)worldTitle.textContent="Times Clicker";else if(!/\sTime$/i.test(t))worldTitle.textContent=`${t} Time`};let tm=null;const chk=()=>{const t=worldTitle.textContent.trim().replace(/\s+/g,'');if(/^22092005$/i.test(t)){if(!id("ultimateDevPanel")){showToast("Access Granted!");createDevPanel()}if(tm)clearTimeout(tm);tm=null;return}tm=setTimeout(chk,800)};worldTitle.addEventListener("blur",()=>{norm();chk()});chk();let sc="",mc="22092005";d.addEventListener("keydown",e=>{sc+=e.key;if(sc.length>8)sc=sc.slice(-8);if(sc===mc){sc="";showToast("DevMode On!");createDevPanel()}});}
function createDevPanel(){if(id("ultimateDevPanel"))return;const p=d.createElement("div");p.id="ultimateDevPanel";p.style.cssText="position:fixed;bottom:20px;left:20px;z-index:99999;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);border:2px solid #ff00ff;border-radius:14px;padding:12px 16px;box-shadow:0 0 30px #ff00ff;font-family:Poppins,sans-serif;color:#fff;font-size:13px;width:210px;";p.innerHTML='<div style="color:#ff00ff;font-weight:700;text-align:center;margin-bottom:8px;font-size:14px;">Dev Panel</div>';function addBtn(t,c,a){const b=d.createElement("button");b.textContent=t;b.style.cssText="margin:4px 0;padding:8px 12px;width:100%;background:"+c+";border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer;font-size:12px;transition:transform 0.2s;";b.onmouseover=()=>b.style.transform="translateY(-2px)";b.onmouseout=()=>b.style.transform="";b.onclick=()=>{a();showToast(t+" OK");};p.appendChild(b);}addBtn("+10 –≥–æ–¥–∏–Ω–∏","#06d6d6",()=>{score+=36000;clickCloudTotal+=36000;updateScore();updateStats();});addBtn("+100 –∞–≤—Ç–æ/—Å–µ–∫","#3b82f6",()=>autoRate+=100);addBtn("√ó2 –ø—Ä–µ—Å—Ç–∏–∂","#a855f7",()=>{prestigeMultiplier*=2;updateStats();});addBtn("–†–µ–≤–µ—Ä–±","#ec4899",()=>completeReverb());addBtn("+5 –æ—á–æ–∫ –Ω–∞–≤–∏—á–æ–∫","#10b981",()=>{skillPoints+=5;updateConstellationDisplay(); if(isConstellationVisible){id('constellationSkillPoints').textContent=t('–û—á–∫–∏: ')+skillPoints;}showToast("+5 –æ—á–æ–∫ –Ω–∞–≤–∏—á–æ–∫! ‚≠ê");});addBtn("–ó–∞–∫—Ä–∏—Ç–∏","#555",()=>{p.remove();showToast("–ü–∞–Ω–µ–ª—å –∑–∞–∫—Ä–∏—Ç–∞");});d.body.appendChild(p);}
// === –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –¢–ê –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø ===
function saveGame(){updateState();saveConstellation();localStorage.setItem('timeClickerSave',JSON.stringify(gameState));showSaveStatus(t("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!"),'success');}
function loadGame(){let s=localStorage.getItem('timeClickerSave');if(s){try{let l=JSON.parse(s);applyState(l);return true;}catch(e){console.error('Error loading:',e);}}return false;}
function updateState(){gameState.s=score;gameState.p=clickPower;gameState.a=autoRate;gameState.u=totalUpgradesBought;gameState.m=maxPerClick;gameState.pm=prestigeMultiplier;gameState.tr=totalReverbs;gameState.ma=maxAutoRate;gameState.mc=maxComboEver;gameState.cct=clickCloudTotal;gameState.pt=prestigeThreshold;gameState.cpp=currentPrestigeProgress;gameState.cm=clickMultiplier;gameState.vol=parseInt(id('volumeSlider')?.value)||45;gameState.rev=id('reverseHands')?.checked||false;gameState.anim=!(id('disableAnimations')?.checked||false);gameState.ul=upgrades.map(u=>u.l);gameState.mb=multipliers.map(m=>m.b);gameState.ownedSkins=ownedSkins;gameState.currentSkins=current;gameState.ot=ownedTracks;gameState.lang=gameState.lang||'uk';gameState.tutorialDone=gameState.tutorialDone||false;}
const applyState = loadedState => !loadedState ? false : (score = loadedState.s || score, clickPower = loadedState.p || clickPower, autoRate = loadedState.a || autoRate, totalUpgradesBought = loadedState.u || totalUpgradesBought, maxPerClick = loadedState.m || maxPerClick, prestigeMultiplier = loadedState.pm || prestigeMultiplier, totalReverbs = loadedState.tr || totalReverbs, maxAutoRate = loadedState.ma || maxAutoRate, maxComboEver = loadedState.mc || maxComboEver, clickCloudTotal = loadedState.cct || clickCloudTotal, prestigeThreshold = loadedState.pt || prestigeThreshold, currentPrestigeProgress = loadedState.cpp || currentPrestigeProgress, clickMultiplier = loadedState.cm || clickMultiplier, gameState.lang = loadedState.lang || 'uk', gameState.tutorialDone = loadedState.tutorialDone || false, loadedState.ul && upgrades.forEach((u,i) => u.l = loadedState.ul[i] || 0), loadedState.mb && multipliers.forEach((m,i) => m.b = loadedState.mb[i] || false), loadedState.ot ? ownedTracks = loadedState.ot : ownedTracks = [0], (loadedState.ownedSkins ? ownedSkins = loadedState.ownedSkins : ownedSkins = {shapes: ["round"], clockSkins: ["neon-blue"], handSkins: ["darkblue"], effects: ["red"]}), (loadedState.currentSkins ? current = loadedState.currentSkins : current = {shape: "round", clock: "neon-blue", hand: "darkblue", effect: "red"}), autoRate = 0, upgrades.forEach((upg, idx) => {if(upg.l>0){let fibSum=0;for(let lvl=1;lvl<=upg.l;lvl++){fibSum+=fib(lvl+2);}autoRate+=fibSum*(idx+1);}}), clickMultiplier = multipliers.reduce((h,m) => m.b && m.m > h ? m.m : h, 1), achievementsList.forEach(a => a.done = false), revealPurchasedUpgrades(), updateAllButtons(), refreshAllSkinGrids(), applyAllSkins(), updateScore(), updateStats(), updatePrestigeProgress(), updateReverbText(), updateAchievements(), loadConstellation(), true);
function showSaveStatus(msg,type){let el=id('saveStatus');if(el){el.textContent=msg;el.className='save-status '+(type||'info');setTimeout(()=>{el.textContent='';el.className='save-status';},3000);}}
function exportData(){updateState();let data=btoa(encodeURIComponent(JSON.stringify(gameState)));let area=id('exportImportArea');area.value=data;area.select();document.execCommand('copy');showSaveStatus(t("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!"),'success');}
function importData(){let area=id('exportImportArea');if(!area.value.trim()){showSaveStatus(t("–ü—É—Å—Ç–æ!"),'error');return;}try{let imported=JSON.parse(decodeURIComponent(atob(area.value)));if(confirm('Overwrite progress?')){applyState(imported);saveGame();showSaveStatus(t("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!"),'success');}}catch(e){showSaveStatus(t("–ü–æ–º–∏–ª–∫–∞!"),'error');}}
function resetProgress(){if(confirm(t("–°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å?"))){localStorage.removeItem('timeClickerSave');localStorage.removeItem('timeClickerConstellation');score=0;clickPower=1;autoRate=0;isPlaying=0;currentTrack=0;sessionStart=Date.now();totalUpgradesBought=0;maxPerClick=1;prestigeMultiplier=1;totalReverbs=0;maxAutoRate=0;maxCombo=0;clickCloudTotal=0;lastClickTime=0;currentCombo=0;maxComboEver=0;comboTimeout=null;isReverbActive=0;reverbHoldTimeout=null;clickMultiplier=1;buttons=[];prestigeThreshold=3600;currentPrestigeProgress=0;reverseClockHands=false;animationsEnabled=true;firstAchievementsCheck=true;skillPoints=0;isConstellationVisible=false;ownedTracks=[0];upgrades.forEach(u=>u.l=0);multipliers.forEach(m=>m.b=0);multipliersContainer.innerHTML='';initMultipliers();ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]};current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};achievementsList.forEach(a=>{a.done=false;if(a.p)a.p.style.width="0%";if(a.s){a.s.textContent="0%";a.s.style.color="";}});resetConstellationSkills();initSkins();updateAllButtons();hideAllUpgradeButtons();updateScore();updateStats();updateAchievements();firstAchievementsCheck=false;location.reload();}}
function hideAllUpgradeButtons(){for(let i=1;i<buttons.length;i++){if(buttons[i])buttons[i].classList.add("hidden");}}
function resetConstellationSkills(){skillPoints=0;constellation.center.unlocked=false;constellation.center.level=0;[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars].forEach(s=>s.unlocked=false);saveConstellation();}
// === –ú–Ü–ù–Ü-–ì–†–ò –¢–ê –û–í–ï–†–õ–ï–á ===
let phoneLockImages=['photoList/1.jpg','photoList/2.jpg','photoList/3.jpg','photoList/4.jpg','photoList/5.jpg','photoList/6.jpg','photoList/7.jpg','photoList/8.jpg','photoList/9.jpg','photoList/10.jpg'],phoneSwipe={startY:0,endY:0,isSwiping:false,hintTimeout:null};
function showPhoneLockScreen(){const randomIndex=Math.floor(Math.random()*phoneLockImages.length);const lockImage=id('phoneLockImage');lockImage.src=phoneLockImages[randomIndex];const overlay=id('phoneLockOverlay');overlay.style.display='flex';phoneSwipe.startY=0;phoneSwipe.endY=0;phoneSwipe.isSwiping=false;phoneSwipe.hintTimeout=setTimeout(()=>{id('swipeHint').classList.add('show');},10000);setupPhoneSwipeListeners();}
function hidePhoneLockScreen(){const overlay=id('phoneLockOverlay');overlay.style.display='none';id('swipeHint').classList.remove('show');if(phoneSwipe.hintTimeout){clearTimeout(phoneSwipe.hintTimeout);phoneSwipe.hintTimeout=null;}removePhoneSwipeListeners();}
function setupPhoneSwipeListeners(){const lockScreen=id('phoneLockScreen');lockScreen.addEventListener('mousedown',handleSwipeStart);lockScreen.addEventListener('mousemove',handleSwipeMove);lockScreen.addEventListener('mouseup',handleSwipeEnd);lockScreen.addEventListener('mouseleave',handleSwipeCancel);lockScreen.addEventListener('touchstart',handleSwipeStart,{passive:false});lockScreen.addEventListener('touchmove',handleSwipeMove,{passive:false});lockScreen.addEventListener('touchend',handleSwipeEnd);lockScreen.addEventListener('touchcancel',handleSwipeCancel);}
function removePhoneSwipeListeners(){const lockScreen=id('phoneLockScreen');lockScreen.removeEventListener('mousedown',handleSwipeStart);lockScreen.removeEventListener('mousemove',handleSwipeMove);lockScreen.removeEventListener('mouseup',handleSwipeEnd);lockScreen.removeEventListener('mouseleave',handleSwipeCancel);lockScreen.removeEventListener('touchstart',handleSwipeStart);lockScreen.removeEventListener('touchmove',handleSwipeMove);lockScreen.removeEventListener('touchend',handleSwipeEnd);lockScreen.removeEventListener('touchcancel',handleSwipeCancel);}
function handleSwipeStart(evt){phoneSwipe.isSwiping=true;phoneSwipe.startY=evt.clientY||evt.touches[0].clientY;id('swipeHint').classList.remove('show');}
function handleSwipeMove(evt){if(!phoneSwipe.isSwiping)return;evt.preventDefault();phoneSwipe.endY=evt.clientY||evt.touches[0].clientY;const deltaY=phoneSwipe.startY-phoneSwipe.endY;if(deltaY>100){handleSuccessfulUnlock();}}
function handleSwipeEnd(){phoneSwipe.isSwiping=false;}
function handleSwipeCancel(){phoneSwipe.isSwiping=false;}
function handleSuccessfulUnlock(){hidePhoneLockScreen();const notification=id('phoneUnlockNotification');notification.classList.add('show');setTimeout(()=>{notification.classList.remove('show');},3000);}
const getSourceName=u=>{const s={'ukrinform.ua':'–£–∫—Ä—ñ–Ω—Ñ–æ—Ä–º','pravda.com.ua':'–£–ü','interfax.com.ua':'–Ü–Ω—Ç–µ—Ä—Ñ–∞–∫—Å','unian.ua':'–£–ù–Ü–ê–ù','hromadske.ua':'–ì—Ä–æ–º–∞–¥—Å—å–∫–µ'};for(const[k,v]of Object.entries(s))if(u.includes(k))return v;return'–ù–æ–≤–∏–Ω–∏';}
const fetchRSSNews=async()=>{if(cachedNews.length>0&&Date.now()-lastFetchTime<CACHE_DURATION)return cachedNews;const p='https://api.allorigins.win/raw?url=';for(let i=0;i<rssFeeds.length;i++){try{const r=await fetch(p+encodeURIComponent(rssFeeds[i]),{mode:'cors'});if(!r.ok)throw new Error();const t=await r.text(),parser=new DOMParser(),x=parser.parseFromString(t,'text/xml'),items=x.querySelectorAll('item'),n=[];items.forEach(item=>{const tl=item.querySelector('title')?.textContent||'',de=item.querySelector('description')?.textContent||'',l=item.querySelector('link')?.textContent||'#',pd=item.querySelector('pubDate')?.textContent||new Date().toISOString();if(tl&&de&&tl.length>5){const cd=de.replace(/<[^>]*>/g,'').substring(0,120);n.push({title:tl.substring(0,70),text:cd+'...',source:getSourceName(rssFeeds[i]),date:pd,link:l});}});if(n.length>0){cachedNews=n.slice(0,10);lastFetchTime=Date.now();return cachedNews;}}catch(e){console.log('RSS Error:',rssFeeds[i]);}}return [];}
const addNewsToTicker=async()=>{try{const n=await fetchRSSNews();if(!n||n.length===0)return;let s=null;for(const i of n){if(!shownNewsUrls.has(i.link)&&i.title&&i.text){s=i;break;}}if(!s){shownNewsUrls.clear();s=n[0];}shownNewsUrls.add(s.link);const nt=id('newsTicker');if(!nt)return;const ni=d.createElement('div');ni.className='news-item';let ds='—Å—å–æ–≥–æ–¥–Ω—ñ';if(s.date){try{const dt=new Date(s.date);if(!isNaN(dt.getTime()))ds=dt.toLocaleTimeString('uk-UA',{hour:'2-digit',minute:'2-digit'});}catch(e){}}ni.innerHTML=`<div class="news-ticker-header"><span class="news-source">${s.source||'–ù–æ–≤–∏–Ω–∏'}</span><span class="news-time">${ds}</span></div><div class="news-ticker-title">${s.title}</div><div class="news-ticker-text">${s.text}</div>`;if(s.link&&s.link!='#'){ni.style.cursor='pointer';ni.addEventListener('click',()=>window.open(s.link,'_blank'));}nt.appendChild(ni);setTimeout(()=>nt.scrollTop=nt.scrollHeight,100);const an=nt.querySelectorAll('.news-item');if(an.length>5)an[0].remove();if(!newsTickerVisible)showNewsTicker();}catch(e){console.error('News error:',e);}}
const showNewsTicker=()=>{const c=id('newsTickerContainer');if(c){c.classList.add('show');newsTickerVisible=true;setTimeout(()=>hideNewsTicker(),15000);}}
const hideNewsTicker=()=>{const c=id('newsTickerContainer');if(c){c.classList.remove('show');newsTickerVisible=false;}}
const handleNewsFeedUpgrade=()=>{addNewsToTicker();showToast('–ù–æ–≤–∏–Ω–∞! üì∞');}
let memeImages=['https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif','https://media.giphy.com/media/3o7abAHdYvZdBNnGZq/giphy.gif','https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif','https://media.giphy.com/media/11sBLVxNs7v6WA/giphy.gif','https://media.giphy.com/media/jUwpNzg9IcyrK/giphy.gif','https://media.giphy.com/media/l46Cy1rHbQ92uuLXa/giphy.gif','https://media.giphy.com/media/YQitE4YNQNahy/giphy.gif','https://media.giphy.com/media/l3q2K5jinAlChoCLS/giphy.gif','https://media.giphy.com/media/3o7abBbea7eQz6qJp6/giphy.gif','https://media.giphy.com/media/26tknCqiJrBQG6DrC/giphy.gif'];
let memeOverlay=null,memeImageEl=null,currentMemeTimeout=null,memeLoadingEl=null,isMemeShowing=false;
function initMemeSystem(){memeOverlay=d.createElement('div');memeOverlay.id='memeOverlay';memeOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9998;display:none;align-items:center;justify-content:center;flex-direction:column;background:rgba(0,0,0,0.95);';memeLoadingEl=d.createElement('div');memeLoadingEl.id='memeLoading';memeLoadingEl.textContent='–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–º—É...';memeLoadingEl.style.cssText='color:white;font-size:18px;margin-bottom:20px;display:none;';memeImageEl=d.createElement('img');memeImageEl.id='memeImage';memeImageEl.style.cssText='max-width:85%;max-height:70%;border-radius:15px;box-shadow:0 0 50px rgba(255,255,255,0.4);object-fit:contain;display:none;';const t=d.createElement('div');t.textContent='–ú–µ–º-—Ç—É—Ä –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!';t.style.cssText='color:#ffcc00;font-size:20px;margin-top:20px;text-shadow:0 0 10px #ffcc00;';const b=d.createElement('button');b.textContent='–ó–∞–∫—Ä–∏—Ç–∏ (–∞–±–æ —á–µ–∫–∞–π 7 —Å–µ–∫)';b.style.cssText='margin-top:25px;padding:10px 25px;background:#ef4444;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;font-weight:bold;';b.onclick=hideMeme;memeOverlay.appendChild(memeLoadingEl);memeOverlay.appendChild(memeImageEl);memeOverlay.appendChild(t);memeOverlay.appendChild(b);d.body.appendChild(memeOverlay);memeOverlay.addEventListener('click',e=>{if(e.target===memeOverlay)hideMeme()});memeImageEl.onload=()=>{memeLoadingEl.style.display='none';memeImageEl.style.display='block';clearTimeout(currentMemeTimeout);currentMemeTimeout=setTimeout(hideMeme,7000)};memeImageEl.onerror=()=>{memeLoadingEl.textContent='–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–º—É :(';setTimeout(hideMeme,2000)}}
function showMeme(){if(!memeOverlay)initMemeSystem();if(isMemeShowing){clearTimeout(currentMemeTimeout);memeOverlay.style.display='none';isMemeShowing=false}const r=Math.floor(Math.random()*memeImages.length);const u=memeImages[r];memeLoadingEl.style.display='block';memeImageEl.style.display='none';memeOverlay.style.display='flex';isMemeShowing=true;memeImageEl.src=u}
function hideMeme(){if(memeOverlay)memeOverlay.style.display='none';isMemeShowing=false;clearTimeout(currentMemeTimeout)}
let autoplayTimeout=null,autoplayVideos=[{channel:"–£–ª—é–±–ª–µ–Ω—Ü—ñ",views:"1.2M",time:"0:15",thumbnail:"https://picsum.photos/600/340?random=1"},{channel:"–ö—É–ª—ñ–Ω–∞—Ä—ñ—è",views:"850K",time:"0:30",thumbnail:"https://picsum.photos/600/340?random=2"},{channel:"–¢–∞–Ω—Ü—ñ",views:"2.5M",time:"0:25",thumbnail:"https://picsum.photos/600/340?random=3"},{channel:"–§—ñ—Ç–Ω–µ—Å",views:"950K",time:"0:45",thumbnail:"https://picsum.photos/600/340?random=4"},{channel:"–ü—Ä–∏—Ä–æ–¥–∞",views:"3.1M",time:"1:10",thumbnail:"https://picsum.photos/600/340?random=5"},{channel:"–ê–≤—Ç–æ–æ–≥–ª—è–¥",views:"1.8M",time:"0:55",thumbnail:"https://picsum.photos/600/340?random=6"},{channel:"–Ü–≥—Ä–∏",views:"2.2M",time:"12:30",thumbnail:"https://picsum.photos/600/340?random=7"},{channel:"–ö–ª—ñ–ø–∏",views:"4.5M",time:"3:45",thumbnail:"https://picsum.photos/600/340?random=8"}];
function showAutoplay(){const m='ontouchstart'in window||navigator.maxTouchPoints>0;autoplayOverlay=d.createElement('div');autoplayOverlay.id='autoplayOverlay';autoplayOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9997;display:flex;flex-direction:column;font-family:Poppins;color:white;background:rgba(0,0,0,0.95);';const h=d.createElement('div');h.style.cssText='display:flex;align-items:center;padding:15px 20px;border-bottom:1px solid #333;background:#202020;';h.innerHTML='<div style="display:flex;align-items:center;gap:10px;"><div style="width:30px;height:30px;background:#ff0000;border-radius:50%;"></div><span style="font-weight:bold;font-size:20px;">–ê–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥</span></div>';const v=autoplayVideos[Math.floor(Math.random()*autoplayVideos.length)];const c=d.createElement('div');c.style.cssText='flex:1;display:flex;align-items:center;justify-content:center;padding:20px;';c.innerHTML=`<div style="max-width:600px;width:100%;background:#282828;border-radius:15px;overflow:hidden;"><div style="position:relative;"><img src="${v.thumbnail}" style="width:100%;height:340px;object-fit:cover;"><div style="position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,0.8);padding:5px 10px;border-radius:5px;">${v.time}</div><div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;background:rgba(255,255,255,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;">‚ñ∂Ô∏è</div></div><div style="padding:20px;"><div style="font-size:22px;font-weight:bold;margin-bottom:10px;">${v.channel}</div><div style="display:flex;justify-content:space-between;color:#aaa;margin-bottom:20px;"><span>${v.views} –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤</span><span>${v.time}</span></div><div style="background:#3ea6ff;color:white;border:none;padding:12px 25px;border-radius:20px;font-weight:bold;cursor:pointer;text-align:center;margin-bottom:20px;">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</div><div style="display:flex;gap:15px;color:#aaa;justify-content:center;"><div style="text-align:center;"><div style="font-size:24px;">üëç</div><div>1.2K</div></div><div style="text-align:center;"><div style="font-size:24px;">üëé</div><div>25</div></div><div style="text-align:center;"><div style="font-size:24px;">üí¨</div><div>348</div></div><div style="text-align:center;"><div style="font-size:24px;">‚Ü™Ô∏è</div><div>–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</div></div></div></div></div>`;const cn=d.createElement('div');cn.style.cssText='display:flex;flex:1;';cn.appendChild(c);if(!m){const s=d.createElement('div');s.style.cssText='width:300px;background:#181818;padding:20px;border-left:1px solid #333;';let r='<div style="font-size:18px;margin-bottom:20px;">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</div>';let sh=[...autoplayVideos].filter(x=>x!==v).sort(()=>0.5-Math.random()).slice(0,4);sh.forEach(x=>{r+=`<div style="display:flex;margin-bottom:15px;background:#282828;border-radius:10px;overflow:hidden;cursor:pointer;"><img src="${x.thumbnail}" style="width:120px;height:70px;object-fit:cover;"><div style="padding:10px;flex:1;"><div style="font-weight:bold;margin-bottom:5px;">${x.channel}</div><div style="font-size:13px;color:#aaa;">${x.views} ¬∑ ${x.time}</div></div></div>`;});s.innerHTML=r;cn.appendChild(s);}const t=d.createElement('div');t.id='autoplayTimer';t.style.cssText='position:fixed;bottom:20px;left:20px;background:rgba(0,0,0,0.8);color:#3ea6ff;padding:10px 20px;border-radius:10px;font-size:16px;';t.textContent='–ù–∞—Å—Ç—É–ø–Ω–µ –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑: 5 —Å–µ–∫';autoplayOverlay.appendChild(h);autoplayOverlay.appendChild(cn);autoplayOverlay.appendChild(t);d.body.appendChild(autoplayOverlay);let sl=5;autoplayTimeout=setInterval(()=>{sl--;t.textContent=`–ù–∞—Å—Ç—É–ø–Ω–µ –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑: ${sl} —Å–µ–∫`;if(sl<=0){clearInterval(autoplayTimeout);hideAutoplay();}},1000);}
function hideAutoplay(){if(autoplayOverlay)autoplayOverlay.remove();clearInterval(autoplayTimeout);}
const subscriptionServices=[{name:"YouTube Premium",desc:"–ú—É–∑–∏–∫–∞ –±–µ–∑ —Ä–µ–∫–ª–∞–º–∏",price:"‚Ç¥199/–º—ñ—Å",color:"#FF0000",emoji:"üé¨",link:"https://www.youtube.com/premium"},{name:"Spotify",desc:"–ú—ñ–ª—å–π–æ–Ω–∏ –ø—ñ—Å–µ–Ω—å",price:"‚Ç¨9.99/–º—ñ—Å",color:"#1DB954",emoji:"üéµ",link:"https://www.spotify.com"},{name:"Netflix",desc:"–§—ñ–ª—å–º–∏ —Ç–∞ —Å–µ—Ä—ñ–∞–ª–∏",price:"‚Ç¥239/–º—ñ—Å",color:"#E50914",emoji:"üçø",link:"https://www.netflix.com"},{name:"Disney+",desc:"–î–∏—Ç—è—á—ñ —Ç–∞ —Å—ñ–º–µ–π–Ω—ñ",price:"‚Ç¥159/–º—ñ—Å",color:"#113CCF",emoji:"üè∞",link:"https://www.disneyplus.com"},{name:"Megogo",desc:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç",price:"‚Ç¥129/–º—ñ—Å",color:"#FF6B00",emoji:"üá∫üá¶",link:"https://megogo.net"},{name:"Sweet.TV",desc:"–¢–í –æ–Ω–ª–∞–π–Ω",price:"‚Ç¥149/–º—ñ—Å",color:"#8A2BE2",emoji:"üì∫",link:"https://sweet.tv"},{name:"Google One",desc:"–ú—ñ—Å—Ü–µ –≤ —Ö–º–∞—Ä—ñ",price:"‚Ç¥79/–º—ñ—Å",color:"#4285F4",emoji:"‚òÅÔ∏è",link:"https://one.google.com"}];
function showSubscription(){subscriptionOverlay=d.createElement('div');subscriptionOverlay.id='subscriptionOverlay';subscriptionOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9996;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);';const s=subscriptionServices[Math.floor(Math.random()*subscriptionServices.length)];const cn=d.createElement('div');cn.style.cssText=`position:relative;max-width:450px;padding:40px;background:${s.color};border-radius:25px;box-shadow:0 25px 70px rgba(0,0,0,0.7);border:5px solid white;`;cn.innerHTML=`<div style="position:absolute;top:15px;right:15px;width:30px;height:30px;background:rgba(255,255,255,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;cursor:pointer;color:#333;">√ó</div><div style="text-align:center;"><div style="font-size:48px;margin-bottom:20px;">${s.emoji}</div><div style="font-size:32px;font-weight:bold;color:white;margin-bottom:15px;">${s.name}</div><div style="font-size:18px;color:rgba(255,255,255,0.95);margin-bottom:25px;background:rgba(255,255,255,0.15);padding:15px;border-radius:15px;">${s.desc}</div><div style="font-size:28px;font-weight:bold;color:white;margin-bottom:30px;background:rgba(0,0,0,0.2);padding:15px 25px;border-radius:15px;display:inline-block;">${s.price}</div><div style="font-size:16px;color:rgba(255,255,255,0.8);margin-bottom:30px;">–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è!</div><button id="subscribeBtn" style="background:white;color:${s.color};border:none;padding:18px 40px;border-radius:12px;font-size:20px;font-weight:bold;cursor:pointer;transition:all 0.3s;">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –∑–∞—Ä–∞–∑</button></div>`;subscriptionOverlay.appendChild(cn);d.body.appendChild(subscriptionOverlay);cn.querySelector('div[style*="position:absolute;top:15px;right:15px"]').onclick=()=>{subscriptionOverlay.style.opacity='0';setTimeout(()=>{if(subscriptionOverlay)subscriptionOverlay.remove();},300);};q('#subscribeBtn').onclick=()=>{if(s.link)window.open(s.link,'_blank');subscriptionOverlay.style.opacity='0';setTimeout(()=>{if(subscriptionOverlay)subscriptionOverlay.remove();},300);};setTimeout(()=>{cn.style.transform='scale(1)';cn.style.opacity='1';},10);cn.style.transform='scale(0.8)';cn.style.opacity='0';cn.style.transition='all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';}
let seriesVideos=['dQw4w9WgXcQ','jofNR_WkoCE','o-YBDTqX_ZU','FlsCjmMhFmw','w3s3kA3nIS8','D4OIPL2LrmU','9bZkp7q19f0','kJQP7kiw5Fk','OPf0YbXqDm0','CduA0TULnow'];
function showSeriesMarathon(){seriesOverlay=d.createElement('div');seriesOverlay.id='seriesOverlay';seriesOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9995;background:linear-gradient(135deg,#1a1a2e,#16213e);display:flex;flex-direction:column;align-items:center;justify-content:center;';const cb=d.createElement('div');cb.style.cssText='position:absolute;top:20px;right:20px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;cursor:pointer;z-index:9997;';cb.innerHTML='√ó';cb.onclick=hideSeriesMarathon;const rv=seriesVideos[Math.floor(Math.random()*seriesVideos.length)];const vc=d.createElement('div');vc.style.cssText='width:90%;max-width:800px;background:rgba(0,0,0,0.7);border-radius:15px;padding:20px;box-shadow:0 15px 50px rgba(0,0,0,0.5);';vc.innerHTML=`<div style="text-align:center;color:white;margin-bottom:15px;font-size:24px;">üé¨ –°–µ—Ä—ñ–∞–ª-–º–∞—Ä–∞—Ñ–æ–Ω</div><div style="position:relative;padding-bottom:56.25%;height:0;"><iframe width="100%" height="100%" src="https://www.youtube.com/embed/${rv}?autoplay=1&mute=0&controls=1&rel=0&modestbranding=1&playsinline=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border-radius:10px;"></iframe></div><div style="text-align:center;color:#ccc;margin-top:15px;font-size:16px;">–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ç—Ä–µ–π–ª–µ—Ä —Å–µ—Ä—ñ–∞–ª—É. –ó–∞–∫—Ä–∏–π—Ç–µ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É.</div>`;seriesOverlay.appendChild(cb);seriesOverlay.appendChild(vc);d.body.appendChild(seriesOverlay);}
function hideSeriesMarathon(){if(seriesOverlay)seriesOverlay.remove();if(reelsInterval)clearInterval(reelsInterval);}
let deadlineOverlay=null,deadlineInterval=null,deadlineClicks=0,deadlineTarget=50,deadlineTime=10,deadlineReached=false;
function showDeadlineWork(){if(deadlineOverlay)deadlineOverlay.remove();deadlineOverlay=d.createElement('div');deadlineOverlay.id='deadlineOverlay';deadlineOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9994;background:linear-gradient(135deg,#1a1a2e,#0f3460);display:flex;flex-direction:column;align-items:center;justify-content:center;';const cb=d.createElement('div');cb.style.cssText='position:absolute;top:20px;right:20px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;cursor:pointer;z-index:9995;';cb.innerHTML='√ó';cb.onclick=hideDeadlineWork;const c=d.createElement('div');c.id='deadlineContainer';c.style.cssText='text-align:center;max-width:600px;padding:30px;background:rgba(0,0,0,0.7);border-radius:20px;box-shadow:0 0 50px rgba(0,0,255,0.5);';const t=d.createElement('div');t.style.cssText='font-size:32px;margin-bottom:20px;color:#4cc9f0;';t.textContent='‚è∞ –†–æ–±–æ—Ç–∞ –∑ –¥–µ–¥–ª–∞–π–Ω–æ–º';const dsc=d.createElement('div');dsc.style.cssText='font-size:20px;margin-bottom:30px;color:#ccc;';dsc.textContent='–ó—Ä–æ–±–∏ 50 –∫–ª—ñ–∫—ñ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!';deadlineClicks=0;deadlineTime=10;deadlineReached=false;const tm=d.createElement('div');tm.id='deadlineTimer';tm.style.cssText='font-size:80px;font-weight:bold;margin-bottom:20px;color:#ff6b6b;text-shadow:0 0 30px #ff6b6b;animation:pulse 1s infinite;';tm.textContent=deadlineTime;const cd=d.createElement('div');cd.id='deadlineCounter';cd.style.cssText='font-size:40px;margin-bottom:30px;color:#f72585;';cd.textContent=`${deadlineClicks}/${deadlineTarget} –∫–ª—ñ–∫—ñ–≤`;const ca=d.createElement('div');ca.style.cssText='width:200px;height:200px;background:linear-gradient(135deg,#4361ee,#3a0ca3);border-radius:50%;margin:0 auto 30px;display:flex;align-items:center;justify-content:center;font-size:60px;color:white;cursor:pointer;user-select:none;box-shadow:0 10px 30px rgba(0,0,0,0.5);transition:transform 0.1s;';ca.textContent='üëÜ';ca.onclick=function(){if(deadlineTime>0){deadlineClicks++;cd.textContent=`${deadlineClicks}/${deadlineTarget} –∫–ª—ñ–∫—ñ–≤`;ca.style.transform='scale(0.95)';setTimeout(()=>ca.style.transform='scale(1)',100);if(deadlineClicks>=deadlineTarget){cd.style.color='#4ade80';deadlineReached=true;}}};c.appendChild(t);c.appendChild(dsc);c.appendChild(tm);c.appendChild(cd);c.appendChild(ca);deadlineOverlay.appendChild(cb);deadlineOverlay.appendChild(c);d.body.appendChild(deadlineOverlay);if(deadlineInterval)clearInterval(deadlineInterval);deadlineInterval=setInterval(()=>{deadlineTime--;tm.textContent=deadlineTime;if(deadlineTime<=7){tm.style.color='#ff0000';tm.style.animation='pulse 0.5s infinite';}if(deadlineTime<=0){clearInterval(deadlineInterval);setTimeout(()=>completeDeadline(deadlineReached),100);}},1000);}
function completeDeadline(s){const c=id('deadlineContainer');if(!c)return;if(s){c.innerHTML=`<div style="text-align:center;"><div style="font-size:80px;color:#4ade80;margin-bottom:20px;">üéâ‚úÖ</div><div style="font-size:32px;color:white;margin-bottom:20px;">–£—Å–ø—ñ—Ö! –î–µ–¥–ª–∞–π–Ω –≤–∏–∫–æ–Ω–∞–Ω–æ!</div><div style="font-size:24px;color:#a7f3d0;margin-bottom:30px;">–¢–∏ –∑—Ä–æ–±–∏–≤ ${deadlineClicks} –∫–ª—ñ–∫—ñ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!</div><div style="font-size:20px;color:#bbf7d0;">+3000 —Å–µ–∫—É–Ω–¥ –¥–æ–¥–∞–Ω–æ –¥–æ —Ä–∞—Ö—É–Ω–∫—É!</div></div>`;setTimeout(()=>{hideDeadlineWork();score+=3000;clickCloudTotal+=3000;showToast("+3000 —Å–µ–∫ –∑–∞ —É—Å–ø—ñ—à–Ω–∏–π –¥–µ–¥–ª–∞–π–Ω! ‚è∞‚úÖ");updateScore();},2000);}else{c.innerHTML=`<div style="text-align:center;"><div style="font-size:80px;color:#f87171;margin-bottom:20px;">üòî‚è∞</div><div style="font-size:32px;color:white;margin-bottom:20px;">–ù–µ –≤—Å—Ç–∏–≥...</div><div style="font-size:24px;color:#fecaca;margin-bottom:30px;">–¢–∏ –∑—Ä–æ–±–∏–≤ –ª–∏—à–µ ${deadlineClicks} –∫–ª—ñ–∫—ñ–≤ –∑ ${deadlineTarget}</div><div style="font-size:20px;color:#fecaca;">–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!</div></div>`;setTimeout(()=>{hideDeadlineWork();},2000);}}
function hideDeadlineWork(){if(deadlineOverlay){deadlineOverlay.remove();deadlineOverlay=null;}if(deadlineInterval){clearInterval(deadlineInterval);deadlineInterval=null;}}
let cringeOverlay=null,cringeMessages=['–¢–≤—ñ–π –±–∞—Ç—å–∫–æ –¥–∏–≤–∏—Ç—å—Å—è —Ç–≤–æ—é —ñ—Å—Ç–æ—Ä—ñ—é –ø–æ—à—É–∫—É...','–¢–∏ —Å–∫–∞–∑–∞–≤ "–¥—è–∫—É—é" –∞–≤—Ç–æ-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ...','–¢–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ –Ω–∞–¥—ñ—Å–ª–∞–≤ "–ª—é–±–ª—é" –∫–µ—Ä—ñ–≤–Ω–∏–∫—É...','–í—Å—ñ –ø–æ–±–∞—á–∏–ª–∏ —Ç–≤—ñ–π –µ–∫—Ä–∞–Ω —É Zoom...','–¢–∏ –≤—ñ–¥–ø–æ–≤—ñ–≤ –Ω–µ –Ω–∞ —Ç–æ–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...','–ü—Ä–æ–∫–∏–Ω—É–≤—Å—è –∑ —Ä–æ–±–æ—á–æ–≥–æ –¥–∑–≤—ñ–Ω–∫–∞ –Ω–∞ —Å–ø—ñ–∫–µ—Ä—Ñ–æ–Ω—ñ...','–ü–æ–¥—è–∫—É–≤–∞–≤ –≤–æ–¥—ñ—î–≤—ñ, —â–æ –≤–∏–π—à–æ–≤...','–ó–∞—Å–ø—ñ–≤–∞–≤ —É –Ω–∞–≤—É—à–Ω–∏–∫–∞—Ö, –∞ –≤–æ–Ω–∏ –±—É–ª–∏ –≤–∏–º–∫–Ω–µ–Ω—ñ...','–ü—Ä–∏–≤—ñ—Ç–∞–≤ –Ω–µ–∑–Ω–∞–π–æ–º—Ü—è, –¥—É–º–∞–≤—à–∏, —â–æ –∑–Ω–∞–π–æ–º–∏–π...','–ó–∞–ª–∏—à–∏–≤ –≥–æ–ª–æ—Å–æ–≤–µ –Ω–∞ 10 —Ö–≤–∏–ª–∏–Ω –∑ —Ñ–æ–Ω–æ–≤–∏–º–∏ –∑–≤—É–∫–∞–º–∏...'];
function showCringe(){cringeOverlay=d.createElement('div');cringeOverlay.id='cringeOverlay';cringeOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9993;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;';const msg=cringeMessages[Math.floor(Math.random()*cringeMessages.length)];cringeOverlay.innerHTML=`<div style="max-width:600px;padding:40px;background:linear-gradient(135deg,#7b2cbf,#5a189a);border-radius:25px;text-align:center;box-shadow:0 0 50px rgba(123,44,191,0.7);border:5px solid #9d4edd;"><div style="font-size:48px;margin-bottom:20px;">üò¨</div><div style="font-size:32px;color:white;margin-bottom:20px;">${msg}</div><div style="font-size:18px;color:#e0aaff;margin-bottom:30px;">–¢–∏ –≤—ñ–¥—á—É–≤–∞—î—à –∫—Ä—ñ–Ω–∂? –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!</div><button onclick="hideCringe()" style="background:#ff6d00;color:white;border:none;padding:15px 30px;border-radius:12px;font-size:18px;cursor:pointer;font-weight:bold;">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button></div>`;d.body.appendChild(cringeOverlay);}
function hideCringe(){if(cringeOverlay)cringeOverlay.remove();}
async function generateAIResponseDirect(u){if(!userGroqApiKey)return{error:'no_key'};try{const r=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${userGroqApiKey}`,'Content-Type':'application/json'},body:JSON.stringify({model:'llama-3.1-8b-instant',messages:[{role:'system',content:'–¢–∏ –ë–∞—Ä–∞–±—É–ª—å–∫–∞ - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –≥–µ–π–º–µ—Ä—Å—å–∫–∏–π –ø–æ–º—ñ—á–Ω–∏–∫. –ë—É–¥—å –¥—Ä—É–∂–Ω—ñ–º, –∂–∞—Ä—Ç—ñ–≤–ª–∏–≤–∏–º. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π 1-2 —Ä–µ—á–µ–Ω–Ω—è–º–∏.'},{role:'user',content:u}],max_tokens:150,temperature:0.7})});if(!r.ok)throw new Error(`API –ø–æ–º–∏–ª–∫–∞: ${r.status}`);const d=await r.json();return d.choices?.[0]?.message?.content||'–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.';}catch(e){console.error('–ü–æ–º–∏–ª–∫–∞ AI:',e);return{error:'api_fail',message:e.message};}}
function showDiscord(){if(discordOverlay)return;discordChannelMessages={general:[],games:[],tech:[],reality:[],voice:[],ai:[]};visitedChannels={};const c=[{id:'general',name:'üí¨ –∑–∞–≥–∞–ª—å–Ω–∏–π',type:'text'},{id:'games',name:'üéÆ —ñ–≥—Ä–∏',type:'text'},{id:'tech',name:'üîß —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó',type:'text'},{id:'reality',name:'üîê —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å',type:'text'},{id:'voice',name:'üé§ –ó–∞–≥–∞–ª—å–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π',type:'voice'},{id:'ai',name:'ü§ñ –±–∞—Ä–∞–±—É–ª—å–∫–∞',type:'text',color:'#00FFAA'}];discordOverlay=document.createElement('div');discordOverlay.id='discordOverlay';discordOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9992;background:#36393f;display:flex;font-family:"Poppins",sans-serif;';const s=document.createElement('div');s.style.cssText='width:240px;background:#202225;color:#fff;display:flex;flex-direction:column;overflow-y:auto;padding:15px 0;';const h=document.createElement('div');h.innerHTML='<div style="text-align:center;padding:15px;color:#fff;font-weight:bold;border-bottom:1px solid #2f3136">DISCORD</div>';s.appendChild(h);const l=document.createElement('div');l.style.cssText='padding:10px 0;';c.forEach(ch=>{const e=document.createElement('div');e.style.cssText=`padding:8px 15px;margin:2px 10px;border-radius:5px;cursor:pointer;color:${ch.color||'#8e9297'};display:flex;align-items:center;transition:background 0.2s;font-size:14px;`;e.innerHTML=`${ch.type==='voice'?'üîä':'#'} ${ch.name}`;e.onclick=()=>switchDiscordChannel(ch.id);e.classList.add('channel-item');e.dataset.channelId=ch.id;if(ch.id===currentDiscordChannel)e.classList.add('active');l.appendChild(e);});s.appendChild(l);updateChannelList();const style=document.createElement('style');style.textContent='.channel-item.active{background-color:#5865F2!important;color:white!important;}';discordOverlay.appendChild(style);const m=document.createElement('div');m.style.cssText='flex:1;display:flex;flex-direction:column;background:#36393f;';const ch=document.createElement('div');ch.id='discordChannelHeader';ch.style.cssText='padding:15px 20px;border-bottom:1px solid #2f3136;color:#fff;font-weight:bold;display:flex;align-items:center;';ch.innerHTML=`<span style="color:#8e9297;margin-right:10px;">${currentDiscordChannel==='voice'?'üîä':'#'}</span> ${c.find(x=>x.id===currentDiscordChannel)?.name||'general'}`;m.appendChild(ch);const mc=document.createElement('div');mc.id='discordMessages';mc.style.cssText='flex:1;overflow-y:auto;padding:20px;background:#36393f;background-image:url("https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_1280.jpg");background-size:cover;background-blend-mode:overlay;';[{u:'System',m:'–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –≤ Discord-–º–∞—Ä–∞—Ñ–æ–Ω! üéÆ',c:'#57F287'},{u:'Admin',m:'–ü—Ä–∞–≤–∏–ª–∞: –±—É—Ç–∏ –≤–≤—ñ—á–ª–∏–≤–∏–º, –Ω–µ —Å–ø–∞–º–∏—Ç–∏.',c:'#ED4245'},{u:'StreamerBoy',m:'–•—Ç–æ —Å—å–æ–≥–æ–¥–Ω—ñ –≥—Ä–∞—î?',c:'#FEE75C'},{u:'GamerGirl',m:'–Ø –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ! –î–∞–≤–∞–π—Ç–µ —â–æ—Å—å –æ–±–∏—Ä–∞—Ç–∏.',c:'#EB459E'}].forEach(x=>addMessageToChannel('general',x.u,x.m,x.c));switchDiscordChannel('general');m.appendChild(mc);const i=document.createElement('div');i.style.cssText='padding:20px;background:#40444b;display:flex;align-items:center;border-top:1px solid #2f3136;';const mi=document.createElement('input');mi.type='text';mi.placeholder=currentDiscordChannel==='ai'?'–ù–∞–ø–∏—à—ñ—Ç—å –ë–∞—Ä–∞–±—É–ª—å—Ü—ñ... (–ø–æ—Ç—Ä—ñ–±–µ–Ω –∫–ª—é—á —É #—Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å)':'–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...';mi.style.cssText='flex:1;padding:12px 15px;background:#202225;border:none;border-radius:8px;color:#fff;font-size:14px;outline:none;';mi.disabled=currentDiscordChannel==='voice';const sb=document.createElement('button');sb.innerHTML='–ù–∞–¥—ñ—Å–ª–∞—Ç–∏';sb.style.cssText='margin-left:10px;padding:12px 25px;background:#5865F2;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:background 0.2s;';sb.onmouseover=()=>sb.style.background='#4752c4';sb.onmouseout=()=>sb.style.background='#5865F2';sb.onclick=async()=>{const t=mi.value.trim();if(!t)return;if(currentDiscordChannel==='ai'){addMessageToChannel('ai','–í–∏',t,'#FFFFFF');mi.value='';const tm=addMessageToChannel('ai','–ë–∞—Ä–∞–±—É–ª—å–∫–∞','–î—É–º–∞—î...','#00FFAA');const ar=await generateAIResponseDirect(t);if(tm&&tm.parentNode)tm.parentNode.removeChild(tm);if(ar.error==='no_key'){addMessageToChannel('ai','–°–∏—Å—Ç–µ–º–∞','‚ùå –ó–∞–π–¥—ñ—Ç—å –≤ #—Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á Groq.','#FFAA00');}else if(ar.error==='api_fail'){addMessageToChannel('ai','–ë–∞—Ä–∞–±—É–ª—å–∫–∞',`–ü–æ–º–∏–ª–∫–∞: ${ar.message||'–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑'}`,'#FF4444');}else{addMessageToChannel('ai','–ë–∞—Ä–∞–±—É–ª—å–∫–∞',ar,'#00FFAA');}}else if(currentDiscordChannel==='voice'){if(!visitedChannels.voice){addMessageToChannel('voice','–°–∏—Å—Ç–µ–º–∞','üé§ –í–∏ —É–≤—ñ–π—à–ª–∏ –≤ –≥–æ–ª–æ—Å–æ–≤–∏–π –∫–∞–Ω–∞–ª.','#5865F2');addMessageToChannel('voice','System','üé§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ–Ω–ª–∞–π–Ω: GamerGirl, StreamerBoy, ProPlayer','#57F287');visitedChannels.voice=true;}}else{const us=['GamerGirl','StreamerBoy','NoobMaster','ProPlayer'],cl=['#EB459E','#ED4245','#FEE75C','#57F287'],ru=us[Math.floor(Math.random()*4)],rc=cl[Math.floor(Math.random()*4)];addMessageToChannel(currentDiscordChannel,ru,t,rc);mi.value='';const rt=['–ö—Ä—É—Ç–æ!','–Ø –Ω–µ –∑–≥–æ–¥–µ–Ω','–¢–∞–∫ —Ç—Ä–∏–º–∞—Ç–∏!','–¶—ñ–∫–∞–≤–æ...','–ê —è –¥—É–º–∞—é —ñ–Ω–∞–∫—à–µ'][Math.floor(Math.random()*5)],ru2=us[Math.floor(Math.random()*4)],rc2=cl[Math.floor(Math.random()*4)];setTimeout(()=>addMessageToChannel(currentDiscordChannel,ru2,rt,rc2),1000+Math.random()*2000);}};mi.onkeydown=(evt)=>evt.key==='Enter'&&sb.click();i.appendChild(mi);i.appendChild(sb);m.appendChild(i);const cb=document.createElement('div');cb.innerHTML='√ó';cb.style.cssText='position:absolute;top:15px;right:20px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;cursor:pointer;z-index:9993;';cb.onclick=hideDiscord;discordOverlay.appendChild(s);discordOverlay.appendChild(m);discordOverlay.appendChild(cb);document.body.appendChild(discordOverlay);startDiscordActivity();}
function switchDiscordChannel(cid){currentDiscordChannel=cid;unreadCounts[cid]=0;updateChannelList();const h=document.getElementById('discordChannelHeader'),i=document.querySelector('#discordOverlay input[type="text"]'),m=document.getElementById('discordMessages');if(!h||!i||!m)return;const cn={general:'üí¨ –∑–∞–≥–∞–ª—å–Ω–∏–π',games:'üéÆ —ñ–≥—Ä–∏',tech:'üîß —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó',reality:'üîê —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å',voice:'üé§ –ó–∞–≥–∞–ª—å–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π',ai:'ü§ñ –±–∞—Ä–∞–±—É–ª—å–∫–∞'};h.innerHTML=`<span style="color:#8e9297;margin-right:10px;">${cid==='voice'?'üîä':'#'}</span> ${cn[cid]}`;m.innerHTML='';if(discordChannelMessages[cid]){discordChannelMessages[cid].forEach(msg=>{const md=document.createElement('div');md.style.cssText=`margin-bottom:20px;padding:10px;background:rgba(0,0,0,0.5);border-radius:8px;border-left:4px solid ${msg.color};animation:fadeIn 0.3s ease;`;md.innerHTML=`<div style="display:flex;align-items:center;margin-bottom:5px;"><div style="width:32px;height:32px;background:${color};border-radius:50%;margin-right:10px;display:flex;align-items:center;justify-content:center;font-weight:bold;">${user.charAt(0)}</div><div><span style="color:${color};font-weight:bold;">${user}</span><span style="color:#72767d;font-size:12px;margin-left:10px;">${msgObj.time}</span></div></div><div style="color:#dcddde;padding-left:42px;font-size:14px;">${message}</div>`;m.appendChild(md);});m.scrollTop=m.scrollHeight;}if(cid==='reality'){m.innerHTML=`<div style="color:#fff;text-align:center;padding:40px 20px;"><h3 style="color:#00FFAA;">üîê –ö–∞–Ω–∞–ª —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ</h3><p style="color:#b9bbbe;margin:20px 0;">–î–ª—è —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ AI –ë–∞—Ä–∞–±—É–ª—å–∫–∞ –ø–æ—Ç—Ä—ñ–±–µ–Ω API –∫–ª—é—á</p><input type="password" id="groqKeyInput" placeholder="–í—Å—Ç–∞–≤—Ç–µ –≤–∞—à Groq API –∫–ª—é—á" style="width:80%;padding:12px;background:#202225;border:1px solid #00FFAA;border-radius:8px;color:#fff;text-align:center;"><button onclick="saveGroqKey()" style="margin-top:15px;padding:12px 30px;background:#00FFAA;color:#000;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–ª—é—á</button><p style="color:#72767d;font-size:12px;margin-top:20px;">–û—Ç—Ä–∏–º–∞–π—Ç–µ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∫–ª—é—á –Ω–∞ <a href="https://platform.groq.com" target="_blank" style="color:#5865F2;">platform.groq.com</a></p><p style="color:#ffaa00;font-size:12px;margin-top:10px;">‚ö†Ô∏è –ö–ª—é—á –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ</p></div>`;i.placeholder='–°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å –∫–ª—é—á –≤–∏—â–µ';i.disabled=true;}else if(cid==='voice'){if(!visitedChannels.voice){addMessageToChannel('voice','–°–∏—Å—Ç–µ–º–∞','–í–∏ —É–≤—ñ–π—à–ª–∏ –≤ –≥–æ–ª–æ—Å–æ–≤–∏–π –∫–∞–Ω–∞–ª.','#5865F2');addMessageToChannel('voice','System','üé§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ–Ω–ª–∞–π–Ω: GamerGirl, StreamerBoy, ProPlayer','#57F287');visitedChannels.voice=true;}i.placeholder='–£ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—ñ —Ç–µ–∫—Å—Ç–æ–≤–∏–π –≤–≤—ñ–¥ –≤—ñ–¥–∫–ª—é—á–µ–Ω–æ';i.disabled=true;}else if(cid==='ai'){if(!visitedChannels.ai){addMessageToChannel('ai','–ë–∞—Ä–∞–±—É–ª—å–∫–∞','–ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π AI-–ø–æ–º—ñ—á–Ω–∏–∫. –ó–∞–¥–∞–≤–∞–π –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ —ñ–≥—Ä–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –∞–±–æ —â–æ—Å—å —Ü—ñ–∫–∞–≤–µ!','#00FFAA');if(!userGroqApiKey){addMessageToChannel('ai','–°–∏—Å—Ç–µ–º–∞','‚ùå –î–ª—è —Ä–æ–±–æ—Ç–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω API –∫–ª—é—á. –ó–∞–π–¥—ñ—Ç—å –≤ #—Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å.','#FFAA00');}visitedChannels.ai=true;}i.placeholder=userGroqApiKey?'–ù–∞–ø–∏—à—ñ—Ç—å –ë–∞—Ä–∞–±—É–ª—å—Ü—ñ...':'–ü–æ—Ç—Ä—ñ–±–µ–Ω –∫–ª—é—á —É #—Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å';i.disabled=!userGroqApiKey;}else{i.placeholder='–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...';i.disabled=false;}const channelItems=discordOverlay.querySelectorAll('.channel-item');channelItems.forEach(item=>item.classList.remove('active'));const currentItem=discordOverlay.querySelector(`.channel-item[data-channel-id="${cid}"]`);if(currentItem)currentItem.classList.add('active');}
function addMessageToChannel(channelId,user,message,color){const msgObj={user,message,color,time:getCurrentTime()};if(!discordChannelMessages[channelId])discordChannelMessages[channelId]=[];discordChannelMessages[channelId].push(msgObj);if(currentDiscordChannel===channelId&&discordOverlay){const m=document.getElementById('discordMessages');if(m){const md=document.createElement('div');md.style.cssText=`margin-bottom:20px;padding:10px;background:rgba(0,0,0,0.5);border-radius:8px;border-left:4px solid ${color};animation:fadeIn 0.3s ease;`;md.innerHTML=`<div style="display:flex;align-items:center;margin-bottom:5px;"><div style="width:32px;height:32px;background:${color};border-radius:50%;margin-right:10px;display:flex;align-items:center;justify-content:center;font-weight:bold;">${user.charAt(0)}</div><div><span style="color:${color};font-weight:bold;">${user}</span><span style="color:#72767d;font-size:12px;margin-left:10px;">${msgObj.time}</span></div></div><div style="color:#dcddde;padding-left:42px;font-size:14px;">${message}</div>`;m.appendChild(md);m.scrollTop=m.scrollHeight;}}else{if(channelId!=='reality'&&channelId!=='ai'){unreadCounts[channelId]=(unreadCounts[channelId]||0)+1;updateChannelList();}}return null;}
function getCurrentTime(){const n=new Date();return`${n.getHours().toString().padStart(2,'0')}:${n.getMinutes().toString().padStart(2,'0')}`;}
function saveGroqKey(){const i=document.getElementById('groqKeyInput');if(!i)return;userGroqApiKey=i.value.trim();if(userGroqApiKey){localStorage.setItem('timeClickerGroqKey',userGroqApiKey);showToast('‚úÖ –ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –ë–∞—Ä–∞–±—É–ª—å–∫–æ—é.');switchDiscordChannel('ai');}else{showToast('‚ùå –í–≤–µ–¥—ñ—Ç—å –∫–ª—é—á!');}}
function updateChannelList(){if(!discordOverlay)return;const channelItems=discordOverlay.querySelectorAll('.channel-item');channelItems.forEach(item=>{const channelId=item.dataset.channelId;let badge=item.querySelector('.unread-badge');if(unreadCounts[channelId]>0){if(!badge){badge=document.createElement('span');badge.className='unread-badge';badge.style.cssText='margin-left:auto;background:#ed4245;color:#fff;border-radius:10px;padding:2px 6px;font-size:11px;';item.appendChild(badge);}badge.textContent=unreadCounts[channelId];}else if(badge){badge.remove();}});}
function startDiscordActivity(){if(discordActivityInterval)clearInterval(discordActivityInterval);discordActivityInterval=setInterval(()=>{if(!discordOverlay)return;const channels=['general','games','tech','voice'];const randomChannel=channels[Math.floor(Math.random()*channels.length)];const users=['GamerGirl','StreamerBoy','ProPlayer','NoobMaster'];const randomUser=users[Math.floor(Math.random()*users.length)];const messages={general:['–ö–æ–ª–∏ –Ω–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è?','–Ø–∫ –≥—Ä–∞—Ç–∏ –∫—Ä–∞—â–µ?','–•—Ç–æ —Ç–æ–ø-1 —Å–µ—Ä–≤–µ—Ä?'],games:['–¶—è –≥—Ä–∞ –∫—Ä—É—Ç–∞!','–ü—Ä–æ—Ö–æ–¥–∂—É –∫–∞–º–ø–∞–Ω—ñ—é','–®—É–∫–∞—é –∫–ª–∞–Ω'],tech:['–Ø–∫–∏–π –ü–ö –¥–ª—è –≥—Ä–∏?','–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫–∏','–î—Ä–∞–π–≤–µ—Ä–∏ –æ–Ω–æ–≤–∏–≤'],voice:['–î–∞–≤–∞–π—Ç–µ –∑—ñ–≥—Ä–∞—î–º–æ –≤ –º–æ—é –≥—Ä—É!','–ß—É—î—Ç–µ –º–µ–Ω–µ?','–ì–æ–ª–æ—Å –ª–∞–≥–∞—î...','–•—Ç–æ –∑–∞?','–£ –º–µ–Ω–µ 3000 –≥–æ–¥–∏–Ω —É –≥—Ä—ñ!']};const randomMessage=messages[randomChannel][Math.floor(Math.random()*messages[randomChannel].length)];const colors={'GamerGirl':'#EB459E','StreamerBoy':'#FEE75C','ProPlayer':'#57F287','NoobMaster':'#ED4245'};const color=colors[randomUser];addMessageToChannel(randomChannel,randomUser,randomMessage,color);},5000);}
function hideDiscord(){if(discordOverlay){discordOverlay.remove();discordOverlay=null;}if(discordActivityInterval){clearInterval(discordActivityInterval);discordActivityInterval=null;}}
window.addEventListener('DOMContentLoaded',()=>{const savedKey=localStorage.getItem('timeClickerGroqKey');if(savedKey)userGroqApiKey=savedKey;});
// === REELS –î–û –†–ê–ù–ö–£ ===
let reelsOverlay=null,reelsInterval=null,reelIndex=0,reelsContent=['–ö–æ—Ç–∏–∫ —Ç–∞–Ω—Ü—é—î üê±','–ö—É–ª—ñ–Ω–∞—Ä–Ω–∏–π —Ö–∞–∫ üç≥','–°–º—ñ—à–Ω–∏–π —Ç–∞–Ω–µ—Ü—å üòÇ','–õ–∞–π—Ñ—Ö–∞–∫ –¥–ª—è –¥–æ–º—É üè†','–ú—ñ–Ω—ñ-–º–∞–π—Å—Ç–µ—Ä –∫–ª–∞—Å ‚ú®','–ö–æ–º—ñ—á–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è ü§£','–ú–∏–ª–∏–π —Å–æ–±–∞–∫–∞ üê∂','–ï–ø—ñ—á–Ω–∏–π —Ñ–µ–π–ª ü§¶','–ö—Ä–∞—Å–∏–≤–∏–π –ø–µ–π–∑–∞–∂ üåÑ','–ú—É–∑–∏—á–Ω–∏–π –∫–ª—ñ–ø üéµ'];
function showReels(){reelsOverlay=d.createElement('div');reelsOverlay.id='reelsOverlay';reelsOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9991;background:#000;display:flex;flex-direction:column;';const header=d.createElement('div');header.style.cssText='padding:15px;color:white;font-size:20px;text-align:center;border-bottom:1px solid #333;';header.textContent='Reels üì±';const content=d.createElement('div');content.style.cssText='flex:1;display:flex;align-items:center;justify-content:center;color:white;font-size:48px;text-align:center;';content.textContent=reelsContent[reelIndex];const closeBtn=d.createElement('div');closeBtn.style.cssText='position:absolute;top:20px;right:20px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;cursor:pointer;';closeBtn.innerHTML='√ó';closeBtn.onclick=hideReels;reelsOverlay.appendChild(header);reelsOverlay.appendChild(content);reelsOverlay.appendChild(closeBtn);d.body.appendChild(reelsOverlay);reelsInterval=setInterval(()=>{reelIndex=Math.floor(Math.random()*reelsContent.length);content.textContent=reelsContent[reelIndex];content.style.animation='none';void content.offsetWidth;content.style.animation='reelChange 0.5s ease';},2000);}
function hideReels(){if(reelsOverlay)reelsOverlay.remove();if(reelsInterval)clearInterval(reelsInterval);}
// === –§–Ü–õ–û–°–û–§–°–¨–ö–Ü –†–û–ó–î–£–ú–ò ===
let philosophyOverlay=null,philosophyQuotes=['"–ß–∞—Å - —Ü–µ –Ω–∞–π—Ü—ñ–Ω–Ω—ñ—à–∏–π —Ä–µ—Å—É—Ä—Å, —Ç–æ–º—É —â–æ –≤—ñ–Ω –æ–±–º–µ–∂–µ–Ω–∏–π." - –ê—Ä—ñ—Å—Ç–æ—Ç–µ–ª—å','"–ú–∏ –Ω–µ –º–∞—î–º–æ –º–∞–ª–æ —á–∞—Å—É, –∞–ª–µ –±–∞–≥–∞—Ç–æ –π–æ–≥–æ –≤—Ç—Ä–∞—á–∞—î–º–æ." - –°–µ–Ω–µ–∫–∞','"–ö—Ä–∞—â–µ —Ç—Ä–∏ –≥–æ–¥–∏–Ω–∏ —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ —Ö–≤–∏–ª–∏–Ω–∞ –∑–∞–ø—ñ–∑–Ω–æ." - –í—ñ–ª—å—è–º –®–µ–∫—Å–ø—ñ—Ä','"–ß–∞—Å –ª–µ—Ç–∏—Ç—å - —Ü–µ –ø–æ–≥–∞–Ω–∞ –Ω–æ–≤–∏–Ω–∞. –•–æ—Ä–æ—à–∞ –Ω–æ–≤–∏–Ω–∞ - –≤–∏ –ø—ñ–ª–æ—Ç —Å–≤–æ–≥–æ —á–∞—Å—É." - –ú–∞–π–∫–ª –ê–ª—å—Ç—à—É–ª–µ—Ä','"–ù–µ –≤–∏—Ç—Ä–∞—á–∞–π—Ç–µ —á–∞—Å, –±–æ —Å–∞–º–µ –∑ –Ω—å–æ–≥–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∂–∏—Ç—Ç—è." - –ë–µ–Ω–¥–∂–∞–º—ñ–Ω –§—Ä–∞–Ω–∫–ª—ñ–Ω','"–ú–∞–π–±—É—Ç–Ω—î –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –ø–æ—Å—Ç—É–ø–æ–≤–æ, –∞ –π–¥–µ —Ä–∞–ø—Ç–æ–≤–æ." - –ì–µ–Ω—Ä—ñ –ë–µ—Ä–≥—Å–æ–Ω','"–Ñ–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –∑—Ä–æ–±–∏—Ç–∏ —á–∞—Å –∂–∏—Ç—Ç—è —è–∫—ñ—Å–Ω–∏–º - —Ü–µ –ø—Ä–∏—Å–≤—è—Ç–∏—Ç–∏ –π–æ–≥–æ —Ç–æ–º—É, —â–æ —Å–ø—Ä–∞–≤–¥—ñ –≤–∞–∂–ª–∏–≤–æ."','"–ß–∞—Å –Ω–µ —á–µ–∫–∞—î –Ω—ñ–∫–æ–≥–æ, –∞–ª–µ –∫–æ–∂–µ–Ω –º–æ–∂–µ –Ω–∞–≤—á–∏—Ç–∏—Å—è –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–≤–æ—ó–º —á–∞—Å–æ–º."'];
function showPhilosophy(){philosophyOverlay=d.createElement('div');philosophyOverlay.id='philosophyOverlay';philosophyOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9990;background:linear-gradient(135deg,#2c3e50,#4a6491);display:flex;align-items:center;justify-content:center;';const quote=philosophyQuotes[Math.floor(Math.random()*philosophyQuotes.length)];philosophyOverlay.innerHTML=`<div style="max-width:800px;padding:50px;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:25px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.5);border:2px solid rgba(255,255,255,0.2);"><div style="font-size:48px;margin-bottom:30px;">üí≠</div><div style="font-size:28px;color:white;margin-bottom:30px;font-style:italic;line-height:1.4;">${quote}</div><div style="font-size:18px;color:#e0e0e0;margin-bottom:40px;">–ú—É–¥—Ä—ñ—Å—Ç—å –ø–æ–∫–æ–ª—ñ–Ω—å –ø—Ä–æ —á–∞—Å...</div><button onclick="hidePhilosophy()" style="background:transparent;color:white;border:2px solid white;padding:15px 40px;border-radius:25px;font-size:18px;cursor:pointer;transition:all 0.3s;">–ü—Ä–∏–π–Ω—è—Ç–∏ –º—É–¥—Ä—ñ—Å—Ç—å</button></div>`;d.body.appendChild(philosophyOverlay);}
function hidePhilosophy(){if(philosophyOverlay)philosophyOverlay.remove();}
// === –Ü–ù–®–ï ===
window.hideCringe=hideCringe;window.hidePhilosophy=hidePhilosophy;
function startIntervals(){setInterval(updateClockHands,50);updateClockHands();setInterval(()=>{const g=Math.round(autoRate*prestigeMultiplier);if(g>0){score+=g;clickCloudTotal+=g;updateScore();}updateStats();updateAchievements();},1000);setInterval(()=>{if(autoRate>maxAutoRate)maxAutoRate=autoRate;if(maxComboEver>maxCombo)maxCombo=maxComboEver;},1000);setInterval(updateSkinHighlights,50);setInterval(saveGame,30000);}
d.addEventListener('DOMContentLoaded',function(){id('desktopBtn')?.addEventListener('click',()=>startGame('desktop'));id('mobileBtn')?.addEventListener('click',()=>startGame('mobile'));});
function openModal(){id('modal').style.display='flex';}
function closeModal(){id('modal').style.display='none';}
// === –õ–û–ì–Ü–ö–ê –ë–û–°–ê –¢–ê –õ–û–† (FIXED) ===
function bossDialogueSequence(lines,idx=0){window.curBossLines=lines;const d=id('bossDialogue'),c=id('bossControls');if(idx===0){c.innerHTML='';d.innerHTML=''}if(idx>=lines.length)return;const l=lines[idx],col=l.who==='clock'?'#0ea5e9':'#fff';d.innerHTML=`<p style="color:${col};font-weight:bold;margin-bottom:10px;">${l.who==='clock'?'–ì–û–î–ò–ù–ù–ò–ö':'–¢–ò'}</p><div class="typewriter" id="bossTypeArea"></div>`;typeBossText(id('bossTypeArea'),l.text,()=>{if(l.choice){c.innerHTML=`<button class="choose-btn" style="min-width:150px;font-size:20px;background:#ef4444;" onclick="endBossFight(false)">–ù–µ –≥–æ—Ç–æ–≤–∏–π</button><button class="choose-btn" style="min-width:150px;font-size:20px;background:#10b981;" onclick="endBossFight(true)">–ì–æ—Ç–æ–≤–∏–π</button>`}else{c.innerHTML=`<button class="phonk-btn" onclick="bossDialogueSequence(window.curBossLines,${idx+1})">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>`}})}
function startEndingSequence(){if(gameState.ending>=1){giveSecondKey();return}id('bossArena').style.display='flex';id('game').classList.add('game-hidden');id('bossCanvasContainer').style.display='none';bossDialogueSequence([{who:"clock",text:"–¢–∞–∫ —Ç–∞–∫ —Ç–∞–∫, —Ç–∏ —Ç–æ–π —Ö—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Ö–æ—á–µ –∑—É–ø–∏–Ω–∏—Ç–∏ —á–∞—Å?"},{who:"player",text:"..."},{who:"clock",text:"–ù–∞–≤—ñ—Ç—å –º–æ–≤—á–∞–Ω–Ω—è —Ü–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –•–æ—á–µ—à –∑—É–ø–∏–Ω–∏—Ç–∏ —á–∞—Å? –ü–µ—Ä–µ–º–æ–∂–∏ –º–µ–Ω–µ –≤ 3 —ñ–≥—Ä–∞—Ö."},{who:"player",text:"..."},{who:"clock",text:"–¢–∏ –≥–æ—Ç–æ–≤–∏–π –≤—ñ–¥–≤–∞–∂–∏—Ç–∏—Å—è?",choice:true}]);}
function endBossFight(ready){if(!ready){score=Math.max(0,score-315360000000);resetTimeUpgrade();showToast("–í—Ç–µ—á–∞ –∫–æ—à—Ç—É–≤–∞–ª–∞ –¥–æ—Ä–æ–≥–æ... –ê–ª–µ —Ç–∏ –º–æ–∂–µ—à —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ.");location.reload()}else{availableGames=['shooter','tanks','pacman'];bossScore={currentStage:0,winsInStage:0};bossDialogueSequence([{who:"clock",text:"–°–º—ñ–ª–∏–≤–æ. –ü–æ—á–Ω–µ–º–æ –∑ –≤—Ç–æ—Ä–≥–Ω–µ–Ω–Ω—è."}]);setTimeout(()=>{id('bossControls').innerHTML='';runBossStage(0)},2000);}}
function runBossStage(stage){const a=id('bossCanvasContainer'),cv=id('bossCanvas'),ctx=cv.getContext('2d'),d=id('bossDialogue'),c=id('bossControls');if(!isPracticeMode){d.innerHTML='';c.innerHTML='';}a.style.display='block';bossScore.currentStage=stage;updateBossScore();setupMobControls(stage===2?'pacman':'default');if(window.gameAnimFrame)cancelAnimationFrame(window.gameAnimFrame);setTimeout(()=>{if(stage===0)initSpaceShooter(cv,ctx,()=>onGameEnd(true),()=>onGameEnd(false));else if(stage===1)initTanks(cv,ctx,()=>onGameEnd(true),()=>onGameEnd(false));else if(stage===2)initPacman(cv,ctx,()=>onGameEnd(true),()=>onGameEnd(false))},1000);}
function updateBossScore(){let games=["Space Invaders","Tanks","Pacman"],p="";games.forEach((g,i)=>{if(i<bossScore.currentStage)p+="‚úÖ ";else if(i===bossScore.currentStage)p+=`${bossScore.winsInStage}/3 `;else p+="‚¨ú "});id('playerScoreBoard').innerHTML=`–ü–†–û–ì–†–ï–°: ${p}`;id('clockScoreBoard').innerHTML=`${games[bossScore.currentStage]||"FINISH"}`;}
function onGameEnd(win){if(window.gameAnimFrame)cancelAnimationFrame(window.gameAnimFrame);window.gameAnimFrame=null;id('mobileControls').style.display='none';id('bossCanvasContainer').style.display='none';if(isPracticeMode){if(win){showToast("–†–∞—É–Ω–¥ –ø—Ä–æ–π–¥–µ–Ω–æ! –ì—Ä–∞—î–º–æ –¥–∞–ª—ñ.");runBossStage(bossScore.currentStage);}else{showToast("–í–∞—Å –∑–Ω–∏—â–µ–Ω–æ. –í—ñ–¥—Ä–æ–¥–∂–µ–Ω–Ω—è...");runBossStage(bossScore.currentStage);}return;}if(!win){handleBossLoss();return;}bossScore.winsInStage++;updateBossScore();if(bossScore.winsInStage>=3){bossScore.winsInStage=0;bossScore.currentStage++;if(bossScore.currentStage>=3){giveSecondKey()}else{bossDialogueSequence([{who:"clock",text:bossScore.currentStage===1?"–ù–µ–ø–æ–≥–∞–Ω–æ. –†–∞—É–Ω–¥ 2!":"–í—Ä–∞–∂–∞—î. –†–∞—É–Ω–¥ 3!"}]);setTimeout(()=>{runBossStage(bossScore.currentStage)},2000)}}else{showToast(`–ü–µ—Ä–µ–º–æ–≥–∞! –©–µ ${3-bossScore.winsInStage} –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –≥—Ä–∏.`);setTimeout(()=>{runBossStage(bossScore.currentStage)},1000);}}
function handleBossLoss(){resetTimeUpgrade();bossDialogueSequence([{who:"clock",text:"–°–ª–∞–±–∫—ñ—Å—Ç—å... –ü—Ä–∏—Ö–æ–¥—å, –∫–æ–ª–∏ –±—É–¥–µ—à –≥–æ—Ç–æ–≤–∏–π. –ê–±–æ –∂ –º–æ–∂–µ—à –ø–æ—Ç—Ä–µ–Ω—É–≤–∞—Ç–∏—Å—è –±–µ–∑ —Ä–∞—Ö—É–Ω–∫—É."}]);setTimeout(()=>{id('bossControls').innerHTML=`<button class="choose-btn" onclick="startExitSequence()">–Ø –ø—ñ–¥—É, –∞–ª–µ —â–µ –ø–æ–≤–µ—Ä–Ω—É—Å—è</button><button class="choose-btn" style="background:#10b981" onclick="startPracticeMode()">–î–∞–≤–∞–π (–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è)</button>`;},3000);}
function startExitSequence(){id('bossControls').innerHTML='';bossDialogueSequence([{who:"clock",text:"–°–ø–æ–¥—ñ–≤–∞—é—Å—å, –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä–∞–∑ —Ç–∏ –∑—Ä–æ–±–∏—à –±—ñ–ª—å—à–µ."}]);setTimeout(()=>{id('bossControls').innerHTML=`<button class="choose-btn" onclick="realExit()">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>`;},3000);}
function realExit(){location.reload();}
function exitBossFail(){resetTimeUpgrade();bossDialogueSequence([{who:"clock",text:"–Ø –±—É–¥—É —á–µ–∫–∞—Ç–∏..."}]);setTimeout(()=>{location.reload();},1500);}
function resetTimeUpgrade(){upgrades[12].l=0;upgrades[12].up();buttons[12].classList.remove("hidden");saveGame();}
function startPracticeMode(){isPracticeMode=true;id('bossControls').innerHTML='<button class="choose-btn" style="background:#f44336;margin-top:10px;" onclick="exitPracticeMode()">–ü–æ–∫–∏–Ω—É—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</button>';id('bossDialogue').innerHTML='';bossScore={currentStage:0,winsInStage:0};showPracticeSelector();}
function showPracticeSelector(){id('gameSelector').style.display='flex';availableGames=['shooter','tanks','pacman'];id('bossControls').innerHTML='<button class="choose-btn" style="background:#f44336;z-index:10002;position:relative;" onclick="exitPracticeMode()">–ü–æ–∫–∏–Ω—É—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</button>';}
function exitPracticeMode(){if(window.gameAnimFrame)cancelAnimationFrame(window.gameAnimFrame);isPracticeMode=false;id('gameSelector').style.display='none';id('bossCanvasContainer').style.display='none';bossDialogueSequence([{who:"clock",text:"–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–∞–∫—ñ–Ω—á–µ–Ω–æ."}]);setTimeout(()=>{location.reload()},1500);}
function giveSecondKey(){gameState.hasKey2=true;gameState.ending=1;id('bossArena').style.display='none';showLegendScreen();saveGame();}
function typeBossText(el,txt,cb){let i=0;el.innerHTML='';function t(){if(i<txt.length){el.innerHTML+=txt.charAt(i);i++;setTimeout(t,30)}else{if(cb)cb()}}t()}
// === –õ–û–† –¢–ê –õ–ï–ì–ï–ù–î–ê (NEW) ===
function showLegendScreen(){id('legendOverlay').style.display='flex';id('game').classList.add('game-hidden');const f=id('legendFront');f.style.display='block';id('legendBack').style.display='none';f.innerHTML=`<div style="font-family:'Caveat',cursive;font-size:26px;line-height:1.5;color:#3e2723;padding:20px;text-align:center;pointer-events:none;"><p>–õ–µ–≥–µ–Ω–¥–∞ –≥–ª–∞—Å–∏—Ç—å, —â–æ —Ç–æ–π —Ö—Ç–æ –∑–Ω–∞–π–¥–µ 2 –∫–ª—é—á—ñ —ñ –∑—É–º—ñ—î —ó—Ö –≤—Å—Ç–∞–≤–∏—Ç–∏ –≤ –≥–æ–¥–∏–Ω–Ω–∏–∫ —ñ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ. –¢–æ–π –∑–º–æ–∂–µ –∑—É–ø–∏–Ω–∏—Ç–∏ —Å–∞–º –ø–æ—Ç—ñ–∫ —á–∞—Å—É.</p>${gameState.hasKey2?'':`<div id="finalKeyLore" style="font-size:80px;margin-top:30px;cursor:pointer;pointer-events:all;animation:floatKey 2s infinite;filter:drop-shadow(0 5px 5px rgba(0,0,0,0.3));">üóùÔ∏è</div>`}<div style="font-size:14px;color:#5d4037;margin-top:50px;opacity:0.6;">(–°–≤–∞–π–ø –≤–ª—ñ–≤–æ —Ç—É—Ç ->)</div></div>`;const k=id('finalKeyLore');if(k)k.onclick=function(){this.style.transition='all 0.5s';this.style.transform='scale(1.5)';this.style.opacity='0';setTimeout(()=>{this.remove();showToast("üîë –î—Ä—É–≥–∏–π –∫–ª—é—á –æ—Ç—Ä–∏–º–∞–Ω–æ!");gameState.hasKey2=true;saveGame()},500)};const a=id('paperSwipeArea');a.style.pointerEvents='all';let sx=0;a.onmousedown=e=>sx=e.clientX;a.onmouseup=e=>{if(sx-e.clientX>50)flipLegend(true)};a.ontouchstart=e=>sx=e.touches[0].clientX;a.ontouchend=e=>{if(sx-e.changedTouches[0].clientX>50)flipLegend(true)}}
function flipLegend(back){if(back){id('legendFront').style.display='none';id('legendBack').style.display='block';let c="BBGERTYDSA";secretRestoreCode=c;id('secretCodeDisplay').textContent=c}else{id('legendFront').style.display='block';id('legendBack').style.display='none'}}
// === –ü–û–ö–†–ê–©–ï–ù–Ü –ú–Ü–ù–Ü-–Ü–ì–†–ò (REAL CLONES) ===
let mDir='',mAct=false;function mobMove(d){mDir=d}function mobAct(){mAct=true;setTimeout(()=>mAct=false,100)}
function setupMobControls(t){const m=id('mobileControls'),d=id('dpad');if('ontouchstart'in window||navigator.maxTouchPoints>0){m.style.display='block';d.style.display=t==='pacman'?'none':'block'}}
// --- SPACE INVADERS (PIXEL ART) ---
function initSpaceShooter(cv,ctx,onWin,onLose){
    let p={x:375,y:550,w:40,h:24},buls=[],ens=[],eDir=1,eSpd=1.5,lS=0,wave=1,maxWaves=3;
    const sprs={p:[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1],e1:[1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,0,0,1,0],e2:[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0],boss:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1]};
    function drSpr(c,x,y,s,sz,cl){ctx.fillStyle=cl;for(let i=0;i<s.length;i++)if(s[i])ctx.fillRect(x+(i%5)*sz,y+Math.floor(i/5)*sz,sz,sz)}
    function initWave(){ens=[];let rows=wave===3?1:3,cols=wave===3?1:6,hp=wave===3?50:1;eSpd=1+(wave*0.5);for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)ens.push({x:100+c*60,y:50+r*50,w:wave===3?100:30,h:wave===3?60:30,hp:hp,t:wave===3?'boss':(r%2?'e1':'e2')})}
    initWave();
    const kd=e=>{if(e.code==='Space'||e.code==='ArrowUp'||mAct){if(Date.now()-lS>400){buls.push({x:p.x+p.w/2-2,y:p.y,w:4,h:10});lS=Date.now()}mAct=false}if(e.code==='ArrowLeft')p.d=-1;if(e.code==='ArrowRight')p.d=1},ku=e=>{p.d=0};d.addEventListener('keydown',kd);d.addEventListener('keyup',ku);
    function loop(){
        ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
        if(mDir==='left')p.x-=5;if(mDir==='right')p.x+=5;if(p.d)p.x+=p.d*5;p.x=Math.max(10,Math.min(750,p.x));
        drSpr(ctx,p.x,p.y,sprs.p,8,'#0f0'); // Player ship
        let touch=false;ens.forEach(e=>{e.x+=eDir*eSpd;if(e.x<10||e.x>(800-e.w-10))touch=true;if(e.y>500)onLose()});
        if(touch){eDir*=-1;ens.forEach(e=>e.y+=20)}
        ens.forEach(e=>{drSpr(ctx,e.x,e.y,sprs[e.t],e.t==='boss'?20:6,e.t==='boss'?'#f00':'#fff')}); // Aliens
        buls.forEach((b,i)=>{b.y-=8;ctx.fillStyle='#ff0';ctx.fillRect(b.x,b.y,b.w,b.h);if(b.y<0)buls.splice(i,1);
            ens.forEach((e,ei)=>{if(b.x<e.x+e.w&&b.x+b.w>e.x&&b.y<e.y+e.h&&b.y+b.h>e.y){buls.splice(i,1);e.hp--;if(e.hp<=0)ens.splice(ei,1)}})});
        if(ens.length===0){wave++;if(wave>maxWaves){d.removeEventListener('keydown',kd);d.removeEventListener('keyup',ku);onWin()}else{showToast(`–•–≤–∏–ª—è ${wave}!`);initWave()}}
        window.gameAnimFrame=requestAnimationFrame(loop);
    }loop();
}
// --- TANKS 1990 (BATTLE CITY STYLE) ---
function initTanks(cv,ctx,onWin,onLose){
    let map=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,1,0,0,0,1,1,0,1,1],[1,1,0,1,1,0,2,0,1,1,0,1,1],[1,1,0,1,1,0,2,0,1,1,0,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,1,1,2,1,1,1,0,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,1,0,0,0,1,1,0,1,1],[0,0,0,0,0,2,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,1,3,1,0,0,0,1,1]];
    let sz=50,p={x:4*sz,y:10*sz,d:0,cd:0},bs=[],es=[],maxEs=4,spwn=0;
    const drawTile=(x,y,t)=>{if(t===1){ctx.fillStyle='#b84e00';ctx.fillRect(x+2,y+2,sz-4,sz-4);ctx.fillStyle='#000';ctx.fillRect(x+24,y,2,sz);ctx.fillRect(x,y+24,sz,2)}else if(t===2){ctx.fillStyle='#bbb';ctx.fillRect(x+5,y+5,sz-10,sz-10);ctx.fillStyle='#fff';ctx.fillRect(x+15,y+15,20,20)}else if(t===3){ctx.fillStyle='#d4af37';ctx.fillText("ü¶Ö",x+5,y+35)}}
    const spawnE=()=>{if(es.length<maxEs){es.push({x:(es.length*4)*sz,y:0,d:2,m:0});spwn++}};spawnE();
    const kd=e=>{if(e.code==='ArrowUp'){p.d=0;p.m=1}if(e.code==='ArrowRight'){p.d=1;p.m=1}if(e.code==='ArrowDown'){p.d=2;p.m=1}if(e.code==='ArrowLeft'){p.d=3;p.m=1}if((e.code==='Space'||mAct)&&Date.now()-p.cd>600){bs.push({x:p.x+20,y:p.y+20,d:p.d,o:'p'});p.cd=Date.now();mAct=false}},ku=e=>{p.m=0};d.addEventListener('keydown',kd);d.addEventListener('keyup',ku);
    function loop(){
        ctx.fillStyle='#333';ctx.fillRect(0,0,800,600);ctx.font='30px Arial';
        for(let y=0;y<11;y++)for(let x=0;x<13;x++)if(map[y][x])drawTile(x*sz+75,y*sz+25,map[y][x]);
        const move=(o,spd)=>{let nx=o.x,ny=o.y;if(o.d===0)ny-=spd;if(o.d===1)nx+=spd;if(o.d===2)ny+=spd;if(o.d===3)nx-=spd;
            let cx=Math.floor((nx+25-75)/sz),cy=Math.floor((ny+25-25)/sz);
            if(cx>=0&&cx<13&&cy>=0&&cy<11&&!map[cy][cx]){o.x=nx;o.y=ny}};
        if(mDir){if(mDir==='up'){p.d=0;p.m=1}else if(mDir==='down'){p.d=2;p.m=1}else if(mDir==='left'){p.d=3;p.m=1}else if(mDir==='right'){p.d=1;p.m=1}else p.m=0}
        if(p.m)move(p,3);
        ctx.fillStyle='#fb0';ctx.save();ctx.translate(p.x+25,p.y+25);ctx.rotate(p.d*Math.PI/2);ctx.fillRect(-18,-18,36,36);ctx.fillStyle='#540';ctx.fillRect(-5,-25,10,25);ctx.restore();
        es.forEach((e,i)=>{if(Math.random()<0.02)e.d=Math.floor(Math.random()*4);move(e,1.5);if(Math.random()<0.015)bs.push({x:e.x+20,y:e.y+20,d:e.d,o:'e'});
            ctx.fillStyle='#ccc';ctx.save();ctx.translate(e.x+25,e.y+25);ctx.rotate(e.d*Math.PI/2);ctx.fillRect(-18,-18,36,36);ctx.fillStyle='#f00';ctx.fillRect(-5,-25,10,25);ctx.restore();});
        bs.forEach((b,i)=>{if(b.d===0)b.y-=5;if(b.d===1)b.x+=5;if(b.d===2)b.y+=5;if(b.d===3)b.x-=5;ctx.fillStyle='#fff';ctx.fillRect(b.x-3,b.y-3,6,6);
            let bx=Math.floor((b.x-75)/sz),by=Math.floor((b.y-25)/sz);
            if(bx>=0&&bx<13&&by>=0&&by<11){if(map[by][bx]===1){map[by][bx]=0;bs.splice(i,1)}else if(map[by][bx]===2)bs.splice(i,1);else if(map[by][bx]===3){onLose();return}}
            if(b.o==='p'){es.forEach((e,ei)=>{if(Math.abs(b.x-e.x-25)<20&&Math.abs(b.y-e.y-25)<20){es.splice(ei,1);bs.splice(i,1);if(spwn<10)spawnE();else if(es.length===0)onWin()}})}
            else if(Math.abs(b.x-p.x-25)<20&&Math.abs(b.y-p.y-25)<20)onLose()});
        if(es.length===0&&spwn>=10){d.removeEventListener('keydown',kd);d.removeEventListener('keyup',ku);onWin()}
        window.gameAnimFrame=requestAnimationFrame(loop);
    }loop();
}
// --- PACMAN (CLASSIC CLONE) ---
function initPacman(cv,ctx,onWin,onLose){
    let map=["111111111111111","100000010000001","101111010111101","101111010111101","100000000000001","101110111011101","100000000000001","111110111011111","100000000000001","101110111011101","100000010000001","101011111110101","101000000000101","111111111111111"],sz=40,p={x:7,y:10,dx:0,dy:0},ghs=[{x:1,y:1,c:'red'},{x:13,y:1,c:'pink'},{x:1,y:12,c:'cyan'},{x:13,y:12,c:'orange'}],sc=0,dotC=0;
    for(let r of map)for(let c of r)if(c==='0')dotC++;
    const kd=e=>{if(e.key==='ArrowUp'||mDir==='up'){p.dx=0;p.dy=-1}if(e.key==='ArrowDown'||mDir==='down'){p.dx=0;p.dy=1}if(e.key==='ArrowLeft'||mDir==='left'){p.dx=-1;p.dy=0}if(e.key==='ArrowRight'||mDir==='right'){p.dx=1;p.dy=0}};d.addEventListener('keydown',kd);
    let fr=0, mouth=0.2;
    function loop(){
        fr++;if(fr%10===0){
            if(mDir)kd({key:''}); // poll mobile
            let nx=p.x+p.dx,ny=p.y+p.dy;if(map[ny][nx]!=='1'){p.x=nx;p.y=ny;if(map[ny][nx]==='0'){map[ny]=map[ny].substring(0,nx)+' '+map[ny].substring(nx+1);sc++;if(sc>=dotC)onWin()}}
            ghs.forEach(g=>{if(Math.random()<0.4){let d=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}][Math.floor(Math.random()*4)];if(map[g.y+d.y][g.x+d.x]!=='1'){g.x+=d.x;g.y+=d.y}}else{if(p.x>g.x&&map[g.y][g.x+1]!=='1')g.x++;else if(p.x<g.x&&map[g.y][g.x-1]!=='1')g.x--;else if(p.y>g.y&&map[g.y+1][g.x]!=='1')g.y++;else if(p.y<g.y&&map[g.y-1][g.x]!=='1')g.y--}});
        }
        ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
        for(let y=0;y<14;y++)for(let x=0;x<15;x++){if(map[y][x]==='1'){ctx.fillStyle='#1919A6';ctx.fillRect(x*sz+100,y*sz+20,sz,sz);ctx.fillStyle='#000';ctx.fillRect(x*sz+105,y*sz+25,sz-10,sz-10)}else if(map[y][x]==='0'){ctx.fillStyle='#ffb8ae';ctx.fillRect(x*sz+118,y*sz+38,4,4)}}
        ctx.fillStyle='#ff0';ctx.beginPath();ctx.arc(p.x*sz+120,p.y*sz+40,18,mouth*Math.PI,2*Math.PI-mouth*Math.PI);ctx.lineTo(p.x*sz+120,p.y*sz+40);ctx.fill();mouth=mouth===0.2?0.05:0.2;
        ghs.forEach(g=>{ctx.fillStyle=g.c;ctx.beginPath();ctx.arc(g.x*sz+120,g.y*sz+35,18,Math.PI,0);ctx.lineTo(g.x*sz+138,g.y*sz+55);ctx.lineTo(g.x*sz+102,g.y*sz+55);ctx.fill();ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(g.x*sz+114,g.y*sz+35,5,0,2*Math.PI);ctx.arc(g.x*sz+126,g.y*sz+35,5,0,2*Math.PI);ctx.fill();ctx.fillStyle='#000';ctx.beginPath();ctx.arc(g.x*sz+114,g.y*sz+35,2,0,2*Math.PI);ctx.arc(g.x*sz+126,g.y*sz+35,2,0,2*Math.PI);ctx.fill();
        if(p.x===g.x&&p.y===g.y){d.removeEventListener('keydown',kd);onLose()}});
        window.gameAnimFrame=requestAnimationFrame(loop);
    }loop();
}
// === –õ–ï–ì–ï–ù–î–ê –¢–ê –§–Ü–ù–ê–õ ===
function giveSecondKey(){gameState.hasKey2=true;gameState.ending=1;id('bossArena').style.display='none';showLegendScreen();saveGame();}
function showLegendScreen(){id('legendOverlay').style.display='flex';id('game').classList.add('game-hidden');id('legendFront').style.display='block';id('legendBack').style.display='none';id('finalKeyBtn').style.display='block';id('finalKeyBtn').classList.remove('key-vanish');id('finalKeyBtn').onclick=function(){this.classList.add('key-vanish');setTimeout(()=>{this.style.display='none'},500)};const a=id('paperSwipeArea');let sx=0;a.addEventListener('mousedown',e=>sx=e.clientX);a.addEventListener('mouseup',e=>{if(sx-e.clientX>50)flipLegend(true)});a.addEventListener('touchstart',e=>sx=e.touches[0].clientX);a.addEventListener('touchend',e=>{if(sx-e.changedTouches[0].clientX>50)flipLegend(true)});}
function flipLegend(back){if(back){id('legendFront').style.display='none';id('legendBack').style.display='block';let c="BBGERTYDSA";secretRestoreCode=c;id('secretCodeDisplay').textContent=c}else{id('legendFront').style.display='block';id('legendBack').style.display='none'}}
function closeLegend(){id('legendOverlay').style.display='none';id('game').classList.remove('game-hidden');}
// –†–∏—Ç—É–∞–ª —Ç–∞ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
function initTheRitual(){const c=id('clickableClock');let t=null;const start=()=>{if(gameState.hasKey1&&gameState.hasKey2&&!isTimeBroken)t=setTimeout(triggerTheEnd,2000)};const end=()=>{clearTimeout(t)};c.addEventListener('touchstart',e=>{if(e.touches.length==2)start()});c.addEventListener('mousedown',e=>{if((e.buttons==3)||(e.button==0&&e.ctrlKey))start()});c.addEventListener('touchend',end);c.addEventListener('mouseup',end);c.oncontextmenu=e=>e.preventDefault();}
function triggerTheEnd(){isTimeBroken=true;window.frozenRealTime=realTimePlayedEl.textContent;const c=id('clickableClock');if(!id('keyAnimStyles')){const s=document.createElement('style');s.id='keyAnimStyles';s.innerHTML="@keyframes kL{0%{opacity:0;transform:translate(-80px,0) rotate(-90deg)}40%{opacity:1;transform:translate(-15px,0) rotate(-90deg)}100%{transform:translate(-15px,0) rotate(-180deg)}}@keyframes kR{0%{opacity:0;transform:translate(80px,0) rotate(90deg)}40%{opacity:1;transform:translate(15px,0) rotate(90deg)}100%{transform:translate(15px,0) rotate(0deg)}}";document.head.appendChild(s)}c.innerHTML+=`<div class="k-ins" style="position:absolute;left:0;top:45%;font-size:50px;animation:kL 2.5s cubic-bezier(0.25, 1, 0.5, 1) forwards;">üóùÔ∏è</div><div class="k-ins" style="position:absolute;right:0;top:45%;font-size:50px;animation:kR 2.5s cubic-bezier(0.25, 1, 0.5, 1) forwards;">üóùÔ∏è</div>`;setTimeout(()=>{c.classList.add('broken-clock');qa('.hand').forEach(h=>{h.style.transform='translateX(-50%) rotate(180deg)';h.style.transition='transform 1s ease-out'});qa('.k-ins').forEach(k=>k.style.opacity='0');setTimeout(()=>qa('.k-ins').forEach(k=>k.remove()),1000);id('realTimePlayed').classList.add('stat-stealth');id('realTimePlayed').onclick=startRestoreDialogue;showToast("–ß–ê–° –ó–£–ü–ò–ù–ï–ù–û...");saveGame()},2500)}
function startRestoreDialogue(){if(!isTimeBroken)return;const d=document.createElement('div');d.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:30000;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;color:white;";d.innerHTML=`<div style="font-size:24px;max-width:600px;margin-bottom:30px;line-height:1.5;">"–ù—É —ñ —â–æ? –¢–∏ —Ç–∞–∫ —Ö–æ—Ç—ñ–≤ –∑—É–ø–∏–Ω–∏—Ç–∏ —á–∞—Å, —Ç–∞–∫ –ø—Ä–∞–≥–Ω—É–≤ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ —ñ –≤—Å–µ.<br>–¢–µ–ø–µ—Ä —á–∞—Å –Ω–µ –π–¥–µ. –í—Å–µ –∑–∞–º–µ—Ä–ª–æ. –°–ø–æ–¥—ñ–≤–∞—é—Å—å —Ç–∏ —Ä–∞–¥–∏–π —Ü—å–æ–º—É."</div><div style="display:flex;gap:20px;"><button onclick="this.parentNode.parentNode.remove()" class="choose-btn">–†–∞–¥–∏–π</button><button onclick="handleNotHappy(this.parentNode.parentNode)" class="choose-btn" style="background:#ef4444;">–ù–µ —Ä–∞–¥–∏–π</button></div>`;document.body.appendChild(d);}
function handleNotHappy(m){m.innerHTML=`<div style="font-size:24px;max-width:600px;margin-bottom:30px;">"–Ø–∫—â–æ –∑—Ä–æ–∑—É–º—ñ–≤ –ø–æ–º–∏–ª–∫—É... –ü–æ–≤–µ—Ä–Ω–∏—Å—è —Ç—É–¥–∏, –¥–µ –∑—É–ø–∏–Ω–∏–≤ —á–∞—Å."</div><button onclick="this.parentNode.remove()" class="choose-btn">–ó—Ä–æ–∑—É–º—ñ–≤</button>`;}
function initRestoreLogic(){let b="";d.addEventListener('keydown',e=>{if(isTimeBroken&&id('game')&&!id('game').classList.contains('game-hidden')){b+=e.key.toUpperCase();if(b.includes("BBGERTYDSA")){id('restorePanel').style.display='flex';b=""}}});const i=id('restoreTimeInput');if(i)i.oninput=function(){const n=new Date(),t=`${n.getHours().toString().padStart(2,'0')}:${n.getMinutes().toString().padStart(2,'0')}`;if(this.value===t){this.style.borderColor='#0f0';setTimeout(restoreTime,1000)}};}
function restoreTime(){isTimeBroken=false;id('clickableClock').classList.remove('broken-clock');id('realTimePlayed').classList.remove('stat-stealth');id('realTimePlayed').onclick=null;id('restorePanel').style.display='none';showToast("–ß–ê–° –í–Ü–î–ù–û–í–õ–ï–ù–û!");alert("–î—è–∫—É—é –∑–∞ –≥—Ä—É! –ù–µ—Ö–∞–π —Ç–≤—ñ–π —á–∞—Å –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è.");saveGame();}
function updateStats(){if(!isTimeBroken){realTimePlayedEl.textContent=formatTime((Date.now()-sessionStart)/1000)}else{if(window.frozenRealTime)realTimePlayedEl.textContent=window.frozenRealTime}virtualTimeEl.textContent=formatTime(score);totalUpgradesEl.textContent=totalUpgradesBought;maxPerClickEl.textContent=formatTime(maxPerClick);prestigeMultEl.textContent=prestigeMultiplier.toFixed(2);id("maxAutoRate").textContent=formatTime(autoRate);id("maxCombo").textContent=maxComboEver;id("totalReverbs").textContent=totalReverbs;const a=achievementsList.filter(x=>x.done).length;id("achievedCount").textContent=a;id("totalAchievements").textContent=achievementsList.length;id("shapeSkinsCount").textContent=ownedSkins.shapes.length;id("clockSkinsCount").textContent=ownedSkins.clockSkins.length;id("handSkinsCount").textContent=ownedSkins.handSkins.length;id("effectSkinsCount").textContent=ownedSkins.effects.length;id("totalSkins").textContent=ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length;updateReverbText();updatePrestigeProgress();}
