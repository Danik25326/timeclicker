// === –û–°–ù–û–í–ù–Ü –§–£–ù–ö–¶–Ü–á ===
function startGame(v){document.getElementById('chooser').style.display='none';document.getElementById('game').classList.remove('game-hidden');if(v==='mobile')document.body.classList.add('mobile-version');else document.body.classList.remove('mobile-version');initGame()}
function initGame(){    
// === –ó–ú–Ü–ù–ù–Ü –°–¢–ê–ù–£ ===
let score=0,clickPower=1,autoRate=0,isPlaying=0,currentTrack=0,sessionStart=Date.now(),totalUpgradesBought=0,maxPerClick=1,prestigeMultiplier=1,totalReverbs=0,maxAutoRate=0,maxCombo=0,clickCloudTotal=0,lastClickTime=0,currentCombo=0,maxComboEver=0,comboTimeout=null,MAX_CLICK_INTERVAL=350,COMBO_THRESHOLD=5,isReverbActive=0,reverbHoldTimeout=null,clickMultiplier=1,buttons=[],prestigeThreshold=3600,currentPrestigeProgress=0; 
// === –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–ò–• (–ù–ï –í–ü–õ–ò–í–ê–Ñ –ù–ê –ü–ö) ===
const m='ontouchstart'in window||navigator.maxTouchPoints>0;
if(m){
// –û–ù–û–í–õ–ï–ù–ù–Ø –°–¢–†–Ü–õ–û–ö - –ó–ú–ï–ù–®–ï–ù–ê –ß–ê–°–¢–û–¢–ê
const oh=updateClockHands;
let rafId, lastUpdate=0;
updateClockHands=()=>{    const now=Date.now();    if(now-lastUpdate>=50){        oh();        lastUpdate=now;    }    rafId=requestAnimationFrame(updateClockHands);};

// –ê–í–¢–û-–ö–õ–Ü–ö–ò - –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–Ü –Ü–ù–¢–ï–†–í–ê–õ–ò
const ai=setInterval(()=>{const g=Math.round(autoRate*prestigeMultiplier);if(g>0){score+=g;clickCloudTotal+=g;if(score%100===0)updateScore();}if(Date.now()%3e3<100){updateStats();updateAchievements();}},1e3);

// –°–ö–Ü–ù–ò - –ó–ú–ï–ù–®–ï–ù–ê –ß–ê–°–¢–û–¢–ê –û–ù–û–í–õ–ï–ù–ù–Ø
let skinUpdateTimeout;
function debouncedUpdateSkins() {    clearTimeout(skinUpdateTimeout);    skinUpdateTimeout = setTimeout(updateSkinHighlights, 150);}
const sui = setInterval(debouncedUpdateSkins, 50);

// –ü–õ–ê–í–ê–Æ–ß–Ü –ß–ò–°–õ–ê - –û–ë–ú–ï–ñ–ï–ù–ù–Ø –ö–Ü–õ–¨–ö–û–°–¢–Ü
let f=[];const osf=showFloating;showFloating=t=>{    if(f.length>=2){        f.forEach((o,i)=>{if(i<f.length-1&&o.parentNode)o.parentNode.removeChild(o);});        f=f.slice(-1); }
const e=d.createElement("div");e.textContent=t;e.style.cssText="position:absolute;right:10px;top:30px;color:#ffccd1;font-weight:700;opacity:1;transition:all 0.7s ease-out;font-size:14px;";clockWrapper.appendChild(e);f.push(e);
requestAnimationFrame(()=>{e.style.transform="translateX(40px) translateY(-50px)";e.style.opacity="0";});setTimeout(()=>{if(e.parentNode)e.parentNode.removeChild(e);f=f.filter(i=>i!==e);},700);};

// –°–ü–û–í–Ü–©–ï–ù–ù–Ø - –û–ë–ú–ï–ñ–ï–ù–ù–Ø –ö–Ü–õ–¨–ö–û–°–¢–Ü
let tc=0;const ot=showToast;showToast=t=>{if(tc>=2)return;tc++;ot(t);setTimeout(()=>{tc=Math.max(0,tc-1);},3e3);};

// –†–ï–í–ï–†–ë –°–ò–°–¢–ï–ú–ê - –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø –û–ù–û–í–õ–ï–ù–ù–Ø
const or=updateReverbClockHands;let lr=0;updateReverbClockHands=()=>{const n=Date.now();if(n-lr<50){requestAnimationFrame(updateReverbClockHands);return;}lr=n;or();};
                                                 
// –°–¢–ê–¢–ò–°–¢–ò–ö–ê - –ó–ú–ï–ù–®–ï–ù–ê –ß–ê–°–¢–û–¢–ê –û–ù–û–í–õ–ï–ù–ù–Ø
const si=setInterval(()=>{if(autoRate>maxAutoRate)maxAutoRate=autoRate;if(maxComboEver>maxCombo)maxCombo=maxComboEver;},2e3);
}
// === –í–ò–ü–†–ê–í–õ–ï–ù–ê –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø - –¢–Ü–õ–¨–ö–ò –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–ò–• ===
const d=document,q=s=>d.querySelector(s),qa=s=>d.querySelectorAll(s),id=s=>d.getElementById(s),clock=id("clickableClock"),clockWrapper=id("clockWrapper"),comboBubble=id("comboBubble"),comboCount=id("comboCount"),clickCloudEl=id("clickCloud"),musicBtn=id("musicBtn"),prevTrack=id("prevTrack"),nextTrack=id("nextTrack"),player=id("player"),scoreText=id("score"),upgradesContainer=id("upgrades"),multipliersContainer=id("multipliers"),clickGainEl=id("clickGain"),cloudTotalEl=id("cloudTotal"),nowPlaying=id("nowPlaying"),realTimePlayedEl=id("realTimePlayed"),virtualTimeEl=id("virtualTime"),totalUpgradesEl=id("totalUpgrades"),maxPerClickEl=id("maxPerClick"),prestigeMultEl=id("prestigeMult"),reverbBtn=id("reverbBtn"),timeTunnel=id("timeTunnel"),worldTitle=id("worldTitle"),toastContainer=id("toastContainer"),reverbOverlay=id("reverbOverlay"),reverbClock=id("reverbClock"),reverbHint=id("reverbHint");

// === –û–ù–û–í–õ–ï–ù–ù–Ø –î–ê–¢–ò ===
function updateDate(){id("currentDate").textContent=new Date().toLocaleDateString('uk-UA')}
updateDate();setInterval(updateDate,60000);

// === –ú–£–ó–ò–ö–ê ===
const trackNames=["–§–æ–Ω–∫ ‚Ññ1","–§–æ–Ω–∫ ‚Ññ2","–§–æ–Ω–∫ ‚Ññ3","–§–æ–Ω–∫ ‚Ññ4","–§–æ–Ω–∫ ‚Ññ5","–§–æ–Ω–∫ ‚Ññ6","–§–æ–Ω–∫ ‚Ññ7"],tracks=["asphalt-menace.mp3","digital-overdrive.mp3","drift-phonk-phonk-music-2-434611.mp3","drift-phonk-phonk-music-432222.mp3","phonk-music-409064 (2).mp3","phonk-music-phonk-2025-432208.mp3","pixel-drift.mp3"].map(x=>`musicList/${x}`);
function loadTrack(i){player.src=tracks[i];nowPlaying.textContent=`–ó–∞—Ä–∞–∑: ${trackNames[i]}`;if(isPlaying)player.play();}
loadTrack(0);
player.addEventListener("ended",()=>{currentTrack=(currentTrack+1)%tracks.length;loadTrack(currentTrack);});
musicBtn.addEventListener("click",()=>{
if(!isPlaying){isPlaying=1;player.volume=0.45;player.play().catch(()=>{});musicBtn.textContent="‚è∏ –ó—É–ø–∏–Ω–∏—Ç–∏ –º—É–∑–∏–∫—É";}
else{isPlaying=0;player.pause();musicBtn.textContent="‚ñ∂Ô∏è –í–∫–ª—é—á–∏—Ç–∏ –º—É–∑–∏–∫—É";}});
prevTrack.onclick=()=>{currentTrack=(currentTrack-1+tracks.length)%tracks.length;loadTrack(currentTrack);};
nextTrack.onclick=()=>{currentTrack=(currentTrack+1)%tracks.length;loadTrack(currentTrack);};

// === –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø –ß–ê–°–£ ===
function formatTime(s){s=Math.floor(s);const u=[{name:"—Å—Ç–æ–ª—ñ—Ç—Ç—è",v:3153600000},{name:"–¥–µ—Å—è—Ç–∏–ª—ñ—Ç—Ç—è",v:315360000},{name:"—Ä—ñ–∫",v:31536000},{name:"–º—ñ—Å",v:2592000},{name:"–¥–Ω",v:86400},{name:"–≥–æ–¥",v:3600},{name:"—Ö–≤",v:60},{name:"—Å–µ–∫",v:1}];let r=s,p=[];for(const x of u){const a=Math.floor(r/x.v);if(a>0){p.push(`${a} ${x.name}`);r%=x.v;}}return p.length?p.join(" "):`${s} —Å–µ–∫`;}
let timeCache = {};
function memoizedFormatTime(s) {    if(timeCache[s]) return timeCache[s];    const result = formatTime(s);    if(Object.keys(timeCache).length > 50) timeCache = {};    return timeCache[s] = result;}

// === –ê–ü–ì–†–ï–ô–î–ò ===
const upgrades=[{n:"–ö–ª—ñ–ø–∞—Ç–∏ –æ—á–∏–º–∞",c:1,l:0},{n:"–£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω",c:8,l:0},{n:"–ì–æ—Ä—Ç–∞—Ç–∏ —Å—Ç—Ä—ñ—á–∫—É",c:40,l:0},{n:"–ú–µ–º-—Ç—É—Ä",c:200,l:0},{n:"–ê–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥",c:1100,l:0},{n:"–ü—ñ–¥–ø–∏—Å–∫–∞",c:6500,l:0},{n:"–°–µ—Ä—ñ–∞–ª-–º–∞—Ä–∞—Ñ–æ–Ω",c:40000,l:0},{n:"–†–æ–±–æ—Ç–∞ –∑ –¥–µ–¥–ª–∞–π–Ω–æ–º",c:250000,l:0},{n:"–ñ–∏—Ç—Ç—î–≤–∏–π –∫—Ä—ñ–Ω–∂",c:1600000,l:0},{n:"Discord-–º–∞—Ä–∞—Ñ–æ–Ω",c:10000000,l:0},{n:"Reels –¥–æ —Ä–∞–Ω–∫—É",c:65000000,l:0},{n:"–§—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ —Ä–æ–∑–¥—É–º–∏",c:400000000,l:0}];
function fib(n){if(n<=1)return n;let a=0,b=1;for(let i=2;i<=n;i++)[a,b]=[b,a+b];return b;}
upgrades.forEach((u,i)=>{const b=d.createElement("button");b.className="upgrade-btn";if(i>0)b.classList.add("hidden");b.addEventListener("click",()=>buyUpgrade(i));upgradesContainer.appendChild(b);buttons.push(b);u.up=function(){const f=fib(u.l+6),c=Math.floor(u.c*f*(i+1));b.innerHTML=`${u.n} (Lv.${u.l})<span>${formatTime(c)}</span>`;b.disabled=score<c;};u.getC=function(){return Math.floor(u.c*fib(u.l+6)*(i+1));};u.up();});
function revealNext(){const c=upgrades.filter(u=>u.l>0).length;if(buttons[c])buttons[c].classList.remove("hidden");}
function buyUpgrade(i){const u=upgrades[i],c=u.getC();if(score<c)return;score-=c;u.l++;totalUpgradesBought++;autoRate+=(i+1)*5*prestigeMultiplier;showToast(`–ö—É–ø–ª–µ–Ω–æ: ${u.n} (Lv.${u.l}) ‚úÖ`);if(u.n==="–£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω"){setTimeout(()=>{showPhoneLockScreen();},500);}if(u.n==="–ì–æ—Ä—Ç–∞—Ç–∏ —Å—Ç—Ä—ñ—á–∫—É"){setTimeout(()=>{handleNewsFeedUpgrade();},300);}if(u.n==="–ú–µ–º-—Ç—É—Ä"){setTimeout(()=>{showMeme();setTimeout(()=>{score+=1000;clickCloudTotal+=1000;showToast("–ü–æ—Å–º—ñ—à–∫–∞ –∑–∞ —Å–º—ñ—à–Ω–∏–π –º–µ–º! üòÇ");updateScore();},1500);},300);}if(u.n==="–ê–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥"){setTimeout(()=>{showAutoplay();},300);}if(u.n==="–ü—ñ–¥–ø–∏—Å–∫–∞"){setTimeout(()=>{showSubscription();},300);}requestAnimationFrame(()=>{revealNext();u.up();updateAllButtons();updateScore();updateStats();updateAchievements();updatePrestigeProgress();});if(u.n==="–ö–ª—ñ–ø–∞—Ç–∏ –æ—á–∏–º–∞"){d.body.classList.remove("eye-blink");void d.body.offsetWidth;d.body.classList.add("eye-blink");setTimeout(()=>d.body.classList.remove("eye-blink"),1000);}}
function updateAllButtons(){upgrades.forEach(u=>u.up());multipliers.forEach(m=>m.up&&m.up());}

// === –ú–ù–û–ñ–ù–ò–ö–ò –ö–õ–Ü–ö–£ ===
const multipliers=[{n:"–ü–æ–¥–≤—ñ–π–Ω–∏–π –∫–ª—ñ–∫",c:5000,m:2,b:0},{n:"–ü–æ—Ç—Ä—ñ–π–Ω–∏–π –∫–ª—ñ–∫",c:50000,m:3,b:0},{n:"x10 –∑–∞ –∫–ª—ñ–∫",c:1000000,m:10,b:0},{n:"x50 –∑–∞ –∫–ª—ñ–∫",c:20000000,m:50,b:0},{n:"x100 –∑–∞ –∫–ª—ñ–∫",c:100000000,m:100,b:0}];
multipliers.forEach(m=>{const b=d.createElement("button");b.className="upgrade-btn multiplier-btn";function upB(){if(m.b){b.remove();return;}const a=score>=m.c;b.innerHTML=`${m.n}<span>${formatTime(m.c)}</span>`;b.disabled=!a;b.style.background=a?"":"#334155";b.style.opacity=a?"1":"0.5";}b.addEventListener("click",()=>{if(score<m.c||m.b)return;    requestAnimationFrame(()=>{        score-=m.c;m.b=1;clickMultiplier=m.m;        showToast(`–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ: ${m.n}!`);upB();updateScore();updateStats();    });},{passive:true});multipliersContainer.appendChild(b);m.up=upB;upB();});

// === –í–ò–ü–†–ê–í–õ–ï–ù–ê –°–ò–°–¢–ï–ú–ê –ö–õ–Ü–ö–Ü–í ===
function addTime(){const g=Math.round(clickPower*clickMultiplier*prestigeMultiplier);score+=g;clickCloudTotal+=g;if(g>maxPerClick)maxPerClick=g;clickGainEl.textContent=`+${formatTime(g)}`;showFloating(`+${formatTime(g)}`);triggerClickEffect();handleClickCombo(); updateScore();updatePrestigeProgress();}
function handleClickCombo(){const n=Date.now();if(n-lastClickTime<MAX_CLICK_INTERVAL)currentCombo++;else currentCombo=1;lastClickTime=n;if(currentCombo>maxComboEver)maxComboEver=currentCombo;if(currentCombo>=COMBO_THRESHOLD){comboCount.textContent=currentCombo;comboBubble.classList.add("show");}clearTimeout(comboTimeout);comboTimeout=setTimeout(()=>{if(currentCombo>=COMBO_THRESHOLD){comboBubble.classList.add("burst");showToast(`–ö–æ–º–±–æ √ó${currentCombo}! üî•`);setTimeout(()=>comboBubble.classList.remove("show","burst"),700);}currentCombo=0;},300);}
function showToast(t){const e=d.createElement("div");e.className="toast";e.textContent=t;e.style.cssText="font-size:18px;padding:22px 48px";toastContainer.appendChild(e);setTimeout(()=>e.remove(),10000);}
function triggerClickEffect(){clock.classList.remove("click-effect-red","click-effect-blue","click-effect-glitch","click-effect-blackhole","click-effect-ripple");void clock.offsetWidth;clock.classList.add("click-effect-"+current.effect);}
// –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –û–ë–†–û–ë–ù–ò–ö –ö–õ–Ü–ö–Ü–í - –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–æ–¥–≤—ñ–π–Ω–∏–º –∫–ª—ñ–∫–∞–º
let lastClick=0;clockWrapper.addEventListener("click",e=>{const now=Date.now();if(now-lastClick<100)return;lastClick=now;if(e.target.closest("#clickableClock")||e.target===clockWrapper)addTime();});
function showFloating(t){const e=d.createElement("div");e.textContent=t;e.style.cssText="position:absolute;right:20px;top:50px;color:#ffccd1;font-weight:700;opacity:1;transition:all 0.9s ease-out";clockWrapper.appendChild(e);requestAnimationFrame(()=>{e.style.transform="translateX(60px) translateY(-80px)";e.style.opacity="0";});setTimeout(()=>e.remove(),920);}

// === –í–ò–ü–†–ê–í–õ–ï–ù–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê - –ë–ï–ó –ó–ê–¢–†–ò–ú–û–ö –î–õ–Ø –ü–ö ===
function updateScore(){scoreText.textContent=`–ß–∞—Å—É –≤–∏—Ç—Ä–∞—á–µ–Ω–æ: ${formatTime(score)}`;cloudTotalEl.textContent=`${formatTime(clickCloudTotal)}`;updateAllButtons();}                    
function updateStats(){realTimePlayedEl.textContent=formatTime((Date.now()-sessionStart)/1000);virtualTimeEl.textContent=formatTime(score);totalUpgradesEl.textContent=totalUpgradesBought;maxPerClickEl.textContent=formatTime(maxPerClick);prestigeMultEl.textContent=prestigeMultiplier.toFixed(2);id("maxAutoRate").textContent=formatTime(autoRate);id("maxCombo").textContent=maxComboEver;id("totalReverbs").textContent=totalReverbs;const a=achievementsList.filter(x=>x.done).length;id("achievedCount").textContent=a;id("totalAchievements").textContent=achievementsList.length;id("shapeSkinsCount").textContent=ownedSkins.shapes.length;id("clockSkinsCount").textContent=ownedSkins.clockSkins.length;id("handSkinsCount").textContent=ownedSkins.handSkins.length;id("effectSkinsCount").textContent=ownedSkins.effects.length;id("totalSkins").textContent=ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length;updateReverbText(); updatePrestigeProgress();}                    
setInterval(()=>{if(autoRate>maxAutoRate)maxAutoRate=autoRate;if(maxComboEver>maxCombo)maxCombo=maxComboEver;},1000);

// === –î–û–°–Ø–ì–ù–ï–ù–ù–Ø ===
const achRoot=id("achievements"),achievementsList=[{t:"–ü–µ—Ä—à–∏–π –∫–ª—ñ–∫",desc:"–ó—Ä–æ–±–∏—Ç–∏ –ø–µ—Ä—à–∏–π –∫–ª—ñ–∫",tg:1,g:()=>clickCloudTotal,done:false},{t:"100 —Å–µ–∫",desc:"–í–∏—Ç—Ä–∞—Ç–∏—Ç–∏ 100 —Å–µ–∫",tg:100,g:()=>score,done:false},{t:"–ü–µ—Ä—à–∞ –ø–æ–∫—É–ø–∫–∞",desc:"–ö—É–ø–∏—Ç–∏ –ø–µ—Ä—à–∏–π –∞–ø–≥—Ä–µ–π–¥",tg:1,g:()=>totalUpgradesBought,done:false},{t:"–ê–≤—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ",desc:"–í–∏—Ç—Ä–∞—á–∞—î—à —á–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ",tg:1,g:()=>autoRate>0?1:0,done:false},{t:"–ö–æ–º–±–æ-–º–∞–π—Å—Ç–µ—Ä",desc:"–î–æ—Å—è–≥—Ç–∏ –∫–æ–º–±–æ 10+",tg:10,g:()=>maxComboEver,done:false},{t:"–ú–∞–π—Å—Ç–µ—Ä —Ñ–æ—Ä–º",desc:"–í–æ–ª–æ–¥—ñ—Ç–∏ 3 —Ñ–æ—Ä–º–∞–º–∏ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞",tg:3,g:()=>ownedSkins.shapes.length,done:false},{t:"–ì–æ—Å–ø–æ–¥–∞—Ä —Ä–∞–º–æ–∫",desc:"–í–æ–ª–æ–¥—ñ—Ç–∏ 3 –∫–æ–ª—å–æ—Ä–∞–º–∏ —Ä–∞–º–∫–∏",tg:3,g:()=>ownedSkins.clockSkins.length,done:false},{t:"–ö–æ–ª–µ–∫—Ü—ñ–æ–Ω–µ—Ä —Å—Ç—Ä—ñ–ª–æ–∫",desc:"–í–æ–ª–æ–¥—ñ—Ç–∏ 3 —Å–∫—ñ–Ω–∞–º–∏ —Å—Ç—Ä—ñ–ª–æ–∫",tg:3,g:()=>ownedSkins.handSkins.length,done:false},{t:"–ú–∞–≥ –µ—Ñ–µ–∫—Ç—ñ–≤",desc:"–í–æ–ª–æ–¥—ñ—Ç–∏ 3 –µ—Ñ–µ–∫—Ç–∞–º–∏ –∫–ª—ñ–∫—É",tg:3,g:()=>ownedSkins.effects.length,done:false},{t:"–°—Ç–∏–ª—å–Ω–∏–π",desc:"–ó–º—ñ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Å–∫—ñ–Ω",tg:1,g:()=>(current.shape!=="round"||current.clock!=="neon-blue"||current.hand!=="darkblue"||current.effect!=="red")?1:0,done:false}];
achievementsList.forEach(a=>{const e=d.createElement("div");e.className="achievement";e.innerHTML=`<strong>${a.t}</strong><div style="font-size:12px;color:#bcd">${a.desc}</div><div class="ach-progress"></div><div class="ach-state">0%</div>`;achRoot.appendChild(e);a.p=e.querySelector(".ach-progress");a.s=e.querySelector(".ach-state");});
function updateAchievements(){achievementsList.forEach(a=>{const v=a.g(),p=Math.min(100,(v/a.tg)*100);a.p.style.width=p+"%";if(p>=100&&!a.done){a.done=true;a.s.textContent="–í–∏–∫–æ–Ω–∞–Ω–æ ‚úÖ";a.s.style.color="#8df299";showToast(`–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è: ${a.t} ‚úÖ`);}else if(p<100)a.s.textContent=Math.floor(p)+"%";});}
// === –°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–ó–ê–ü–£–°–ö–£ –ó –ü–†–û–ì–†–ï–°–û–ú ===
function updatePrestigeProgress() { currentPrestigeProgress = score; const pB = id('prestigeProgressBar'), pT = id('prestigeProgressText'), pP = Math.min(100, (currentPrestigeProgress / prestigeThreshold) * 100);
    if(pB) { pB.style.width = pP + '%'; pB.style.background = pP >= 100 ? 'linear-gradient(90deg, #10b981, #34d399)' : pP >= 50 ? 'linear-gradient(90deg, #f59e0b, #fbbf24)' : 'linear-gradient(90deg, #ef4444, #f87171)'; }
    if(pT) pT.textContent = `${formatTime(currentPrestigeProgress)} / ${formatTime(prestigeThreshold)}`; updateReverbButtonState(); }
function updateReverbButtonState() { const c = currentPrestigeProgress >= prestigeThreshold;
    reverbBtn.disabled = !c; reverbBtn.style.opacity = c ? '1' : '0.6'; reverbBtn.style.cursor = c ? 'pointer' : 'not-allowed'; reverbBtn.style.background = c ? 'linear-gradient(90deg, #10b981, #34d399)' : 'linear-gradient(90deg, #6b7280, #9ca3af)'; }
function updateReverbText() { nextMultiplierEl.textContent = (prestigeMultiplier * 1.2).toFixed(2); const rD = id('reverbDesc'); if(rD) rD.textContent = `–ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É: ${formatTime(prestigeThreshold)}`;}
  
// === –°–ö–Ü–ù–ò ===
const clockSkins=[{id:"neon-blue",n:"–ù–µ–æ–Ω —Å–∏–Ω—ñ–π",p:0,a:()=>qa('.clock').forEach(c=>{c.style.borderColor="#0ea5e9";c.style.boxShadow="0 0 50px #0ea5e9, 0 0 100px #0ea5e9"})},{id:"purple",n:"–ü—É—Ä–ø—É—Ä–Ω–∏–π",p:64800,a:()=>qa('.clock').forEach(c=>{c.style.borderColor="#8b5cf6";c.style.boxShadow="0 0 50px #8b5cf6, 0 0 100px #8b5cf6"})},{id:"pink",n:"–†–æ–∂–µ–≤–∏–π",p:129600,a:()=>qa('.clock').forEach(c=>{c.style.borderColor="#ec4899";c.style.boxShadow="0 0 50px #ec4899, 0 0 100px #ec4899"})},{id:"black",n:"–ß–æ—Ä–Ω–∏–π",p:259200,a:()=>qa('.clock').forEach(c=>{c.style.borderColor="#111";c.style.boxShadow="0 0 10px #000"})}],shapes=[{id:"round",n:"–ö—Ä—É–≥",p:0},{id:"square",n:"–ö–≤–∞–¥—Ä–∞—Ç",p:28800},{id:"diamond",n:"–†–æ–º–±",p:86400},{id:"oval",n:"–û–≤–∞–ª",p:172800}],handSkins=[{id:"darkblue",n:"–¢–µ–º–Ω–æ-—Å–∏–Ω—ñ",p:0,a:()=>qa(".hand:not(.second)").forEach(h=>{h.style.background="#1e3a8a";h.style.boxShadow="";h.style.animation="none"})},{id:"pixel",n:"–ü—ñ–∫—Å–µ–ª—å–Ω—ñ",p:900,a:()=>qa(".hand:not(.second)").forEach(h=>{h.style.background="linear-gradient(#fff,#aaa)";h.style.boxShadow="";h.style.animation="none"})},{id:"neon",n:"–ù–µ–æ–Ω–æ–≤—ñ",p:9000,a:()=>qa(".hand:not(.second)").forEach(h=>{h.style.background="#0ea5e9";h.style.boxShadow="0 0 25px #0ea5e9, 0 0 60px #0ea5e9";h.style.animation="neonPulse 2s ease-in-out infinite alternate"})},{id:"chrome",n:"–•—Ä–æ–º",p:43200,a:()=>qa(".hand:not(.second)").forEach(h=>{h.style.background="linear-gradient(90deg,#ddd,#888,#ddd)";h.style.boxShadow="0 0 15px #fff, 0 0 30px #aaa";h.style.animation="none"})}],effects=[{id:"red",n:"–ß–µ—Ä–≤–æ–Ω–∏–π —Å–ø–∞–ª–∞—Ö",p:0},{id:"blue",n:"–°–∏–Ω—ñ–π –≤–∏–±—É—Ö",p:21600},{id:"glitch",n:"–ì–ª—ñ—Ç—á",p:108000},{id:"blackhole",n:"–ß–æ—Ä–Ω–∞ –¥—ñ—Ä–∞",p:360000},{id:"ripple",n:"–•–≤–∏–ª—è —á–∞—Å—É",p:720000}],ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]},current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};
function buySkin(t,i,p,n){if(ownedSkins[t].includes(i)){current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]=i;applyAllSkins();refreshAllSkinGrids();return showToast("–°–∫—ñ–Ω –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ! ‚úÖ")}if(score<p)return showToast("–ù–µ –≤–∏—Å—Ç–∞—á–∞—î —á–∞—Å—É!");score-=p;ownedSkins[t].push(i);current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]=i;applyAllSkins();updateScore();updateStats();updateAchievements(); updatePrestigeProgress(); showToast(`–ö—É–ø–ª–µ–Ω–æ: ${n} ‚úÖ`);refreshAllSkinGrids()}
function applyAllSkins(){qa('.clock').forEach(c=>c.className="clock "+current.shape);clockSkins.find(s=>s.id===current.clock)?.a();handSkins.find(s=>s.id===current.hand)?.a()}
function createSkinGrid(ct,ls,t){const r=id(ct);r.innerHTML="";ls.forEach(s=>{const e=d.createElement("div");e.className="skin";e.textContent=s.n;const o=ownedSkins[t].includes(s.id);const a=current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]===s.id;if(o){e.classList.add("owned");if(a)e.classList.add("active");e.onclick=()=>{current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]=s.id;applyAllSkins();refreshAllSkinGrids();showToast("–°–∫—ñ–Ω –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ! ‚úÖ")}}else{e.style.opacity="0.4";if(score>=s.p){e.style.opacity="1";e.style.boxShadow="0 0 15px #0ff"}e.innerHTML+=`<br><small style="color:#ff00ff">${formatTime(s.p)}</small>`;e.onclick=()=>buySkin(t,s.id,s.p,s.n)}r.appendChild(e)})}
function refreshAllSkinGrids(){createSkinGrid("shapeSkins",shapes,"shapes");createSkinGrid("clockSkins",clockSkins,"clockSkins");createSkinGrid("handSkins",handSkins,"handSkins");createSkinGrid("effectSkins",effects,"effects")}
function updateSkinHighlights(){[{l:shapes,t:"shapes",c:"shapeSkins"},{l:clockSkins,t:"clockSkins",c:"clockSkins"},{l:handSkins,t:"handSkins",c:"handSkins"},{l:effects,t:"effects",c:"effectSkins"}].forEach(obj=>{const ct=id(obj.c);if(!ct)return;Array.from(ct.children).forEach((el,i)=>{const s=obj.l[i],o=ownedSkins[obj.t].includes(s.id);if(!o){if(score>=s.p){el.style.opacity="1";el.style.boxShadow="0 0 15px #0ff"}else{el.style.opacity="0.4";el.style.boxShadow=""}el.innerHTML=s.n+`<br><small style="color:#ff00ff">${formatTime(s.p)}</small>`}else{el.style.opacity="1";el.style.boxShadow="";el.innerHTML=s.n}})})}
setInterval(updateSkinHighlights,50);refreshAllSkinGrids();applyAllSkins();

// === –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ò–ô –ü–†–ò–ë–£–¢–û–ö ===
setInterval(()=>{const g=Math.round(autoRate*prestigeMultiplier);if(g>0){score+=g;clickCloudTotal+=g;updateScore();}updateStats();updateAchievements();},1000);

// === –ì–û–î–ò–ù–ù–ò–ö ===
function updateClockHands(){
const n=new Date(),s=n.getSeconds()+n.getMilliseconds()/1000,m=n.getMinutes()+s/60,h=(n.getHours()%12||12)+m/60; qa("#clickableClock .second").forEach(x=>x.style.transform=`translateX(-50%) rotate(${s*6}deg)`);qa("#clickableClock .minute").forEach(x=>x.style.transform=`translateX(-50%) rotate(${m*6}deg)`); qa("#clickableClock .hour").forEach(x=>x.style.transform=`translateX(-50%) rotate(${h*30}deg)`);}
setInterval(updateClockHands,50);updateClockHands();

// === –°–ò–°–¢–ï–ú–ê –ï–§–ï–ö–¢–£ –ü–ï–†–ï–ó–ê–ü–£–°–ö–£ ===
const restartEffect={active:!1,clocksInt:null,bubblesInt:null,
init(){const e=document.createElement("div");e.id="restartEffectOverlay";e.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;display:none;pointer-events:none;background:transparent;";document.body.appendChild(e);this.clocksContainer=document.createElement("div");this.clocksContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";this.bubblesContainer=document.createElement("div");this.bubblesContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";e.appendChild(this.clocksContainer);e.appendChild(this.bubblesContainer);
// –û–ö–†–ï–ú–ò–ô –µ–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
this.completionScreen=document.createElement("div");this.completionScreen.id="reverbCompletionScreen";this.completionScreen.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:10002;display:none;align-items:center;justify-content:center;flex-direction:column;color:white;font-family:Poppins;text-align:center;";this.completionScreen.innerHTML=`<div style="font-size:32px;margin-bottom:20px;text-shadow:0 0 20px #0ea5e9">–í–∏ —É—Å–ø—ñ—à–Ω–æ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ —á–∞—Å—ñ!</div><div style="font-size:24px;margin-bottom:20px">–í–∞—à –º–Ω–æ–∂–Ω–∏–∫: ${prestigeMultiplier.toFixed(2)}√ó</div><div style="font-size:18px;color:#cfeaff">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –±—É–¥—å-–¥–µ —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</div>`;document.body.appendChild(this.completionScreen);},
start(){this.active=!0;document.getElementById("restartEffectOverlay").style.display="block";this.clocksContainer.innerHTML="";this.bubblesContainer.innerHTML="";this.clocksInt=setInterval(()=>this.createFlyingClock(),300);this.bubblesInt=setInterval(()=>this.createStatBubble(),1200)},
stop(){this.active=!1;clearInterval(this.clocksInt);clearInterval(this.bubblesInt);document.getElementById("restartEffectOverlay").style.display="none"},
showCompletionScreen(){ reverbOverlay.classList.add("hidden");document.getElementById("restartEffectOverlay").style.display="none";timeTunnel.classList.remove("active","intense");this.completionScreen.style.display="flex";},
hideCompletionScreen(){this.completionScreen.style.display="none"},
createFlyingClock(){const e=document.createElement("div");e.className="flying-clock";const t=80+100*Math.random();e.style.width=e.style.height=t+"px";e.style.left=Math.random()*100+"%";e.style.top=Math.random()*100+"%";e.style.animationDuration=4+6*Math.random()+"s";e.style.animationDelay=0.5*Math.random()+"s";Math.random()>0.5&&(e.style.transform="scaleX(-1)");this.clocksContainer.appendChild(e);setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1e4)},
createStatBubble(){const e=document.createElement("div");e.className="stat-bubble";const t=[`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∫–æ–º–±–æ: ${maxComboEver||0}`,`–í–∏—Ç—Ä–∞—á–µ–Ω–æ —á–∞—Å—É: ${formatTime(clickCloudTotal)}`,`–†–µ–≤–µ—Ä–±—ñ–≤: ${totalReverbs}`,`–í—Å—å–æ–≥–æ —Å–∫—ñ–Ω—ñ–≤: ${(ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length)||0}`,`–ê–≤—Ç–æ—á–∞—Å/—Å–µ–∫: ${formatTime(autoRate)}`,`–ú–∞–∫—Å –∑–∞ –∫–ª—ñ–∫: ${formatTime(maxPerClick)}`,`–î–æ—Å—è–≥–Ω–µ–Ω—å: ${(achievementsList.filter(e=>e.done).length)}/${achievementsList.length}`];e.textContent=t[Math.floor(Math.random()*t.length)];e.style.left=10+80*Math.random()+"%";e.style.top=20+60*Math.random()+"%";this.bubblesContainer.appendChild(e);setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},4e3)}};
restartEffect.init();
  
// === –†–ï–í–ï–†–ë –°–ò–°–¢–ï–ú–ê ===
reverbBtn.addEventListener("click",()=>{if(!confirm("–¢–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–π, —â–æ —Ö–æ—á–µ—à –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —á–∞—Å –Ω–∞–∑–∞–¥? –í—Å—ñ —Ç–≤–æ—ó –∞–ø–≥—Ä–µ–π–¥–∏ –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ, –∞–ª–µ —Ç–∏ –æ—Ç—Ä–∏–º–∞—î—à –º–Ω–æ–∂–Ω–∏–∫!"))return;startReverbMode();});
function startReverbMode(){    reverbOverlay.classList.remove("hidden");timeTunnel.classList.add("active");reverbHint.style.opacity="1";isReverbActive=1;    reverbClock.className=`clock ${current.shape}`;clockSkins.find(s=>s.id===current.clock)?.a();handSkins.find(s=>s.id===current.hand)?.a();    updateReverbClockHands();setTimeout(()=>reverbHint.style.opacity="0",3000);}
function updateReverbClockHands(){    if(!isReverbActive)return;const e=qa("#reverbClock .hand");if(e.length===0)return;    if(reverbClock.classList.contains("reverb-chaos")){requestAnimationFrame(updateReverbClockHands);return;}    const t=new Date(),o=t.getSeconds()+t.getMilliseconds()/1000,n=t.getMinutes()+o/60,a=(t.getHours()%12||12)+n/60;    qa("#reverbClock .second").forEach(e=>e.style.transform=`translateX(-50%) rotate(${o*6}deg)`);    qa("#reverbClock .minute").forEach(e=>e.style.transform=`translateX(-50%) rotate(${n*6}deg)`);    qa("#reverbClock .hour").forEach(e=>e.style.transform=`translateX(-50%) rotate(${a*30}deg)`);    requestAnimationFrame(updateReverbClockHands);}
const startReverbHold=e=>{    if(e.type.includes('touch'))e.preventDefault();if(!isReverbActive)return;    reverbHint.style.opacity="0";reverbClock.classList.add("reverb-mode","reverb-chaos");timeTunnel.classList.add("intense");    restartEffect.start();
    qa("#reverbClock .hand").forEach((e,t)=>{        const o=0.5+2*Math.random(),n=Math.random()>0.5?"normal":"reverse";        e.style.setProperty("--duration",`${o}s`);e.style.setProperty("--direction",n);        e.style.animation=`chaosSpin ${o}s linear infinite ${n}`;    });reverbHoldTimeout=setTimeout(completeReverb,10000);};
const stopReverbHold=e=>{    if(e&&e.type.includes('touch'))e.preventDefault();    clearTimeout(reverbHoldTimeout);    if(isReverbActive){        reverbClock.classList.remove("reverb-mode","reverb-chaos");timeTunnel.classList.remove("intense");        qa("#reverbClock .hand").forEach(e=>{e.style.animation="none";e.style.removeProperty("--duration");e.style.removeProperty("--direction");});        updateReverbClockHands();restartEffect.stop();}};
reverbClock.addEventListener("mousedown",startReverbHold);reverbClock.addEventListener("touchstart",startReverbHold,{passive:false});
reverbClock.addEventListener("mouseup",stopReverbHold);reverbClock.addEventListener("mouseleave",stopReverbHold);
reverbClock.addEventListener("touchend",stopReverbHold);reverbClock.addEventListener("touchcancel",stopReverbHold);
function completeReverb() {
    if (currentPrestigeProgress < prestigeThreshold) { showToast(`–ü–æ—Ç—Ä—ñ–±–Ω–æ —â–µ ${formatTime(prestigeThreshold - currentPrestigeProgress)}!`); return; }
    stopReverbHold(new Event('manual')); prestigeThreshold += 7200; prestigeMultiplier *= 1.2; totalReverbs++;
    currentPrestigeProgress = score = clickCloudTotal = currentCombo = 0; clickPower = maxPerClick = 1; autoRate = totalUpgradesBought = 0;
    upgrades.forEach((e,t) => { e.l = 0; if(buttons[t]) buttons[t].classList[t?"add":"remove"]("hidden"); e.up(); });
    multipliers.forEach(e => { if(e.b) { e.b = 0; clickMultiplier = 1; } e.up?.(); });
    const e = document.createElement("div"); e.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10001;pointer-events:none;animation:flashFade 1s ease-out forwards;"; document.body.appendChild(e);
    setTimeout(() => { e.remove(); restartEffect.showCompletionScreen(); restartEffect.completionScreen.querySelector("div:nth-child(2)").textContent = `–ú–Ω–æ–∂–Ω–∏–∫: ${prestigeMultiplier.toFixed(2)}√ó`; updateReverbText();
        const o = () => { restartEffect.hideCompletionScreen(); isReverbActive = 0; updateScore(); updateStats(); updateAchievements(); updatePrestigeProgress(); document.removeEventListener('click',o); document.removeEventListener('touchstart',o); };
        document.addEventListener('click',o); document.addEventListener('touchstart',o);    }, 1000);}
  
// === –°–ò–°–¢–ï–ú–ê –í–ö–õ–ê–î–û–ö ===
qa(".top-tabs .tab").forEach(b=>{b.addEventListener("click",()=>{qa(".top-tabs .tab").forEach(x=>x.classList.remove("active"));qa(".tab-page").forEach(x=>x.classList.remove("active"));b.classList.add("active");id(b.dataset.tab).classList.add("active");});});

// === –°–ï–ö–†–ï–¢–ù–ê –°–ò–°–¢–ï–ú–ê ===
if(worldTitle){worldTitle.addEventListener("keydown",e=>{if(e.key==="Enter")e.preventDefault();});const normalizeTitle=()=>{let t=worldTitle.textContent.trim();if(!t)worldTitle.textContent="Times Clicker";else if(!/\sTime$/i.test(t))worldTitle.textContent=`${t} Time`;};let titleCheckTimeout=null;const checkTitleForSecret=()=>{const t=worldTitle.textContent.trim().replace(/\s+/g,'');if(/^22092005$/i.test(t)){if(!id("ultimateDevPanel")){showToast("22.09.2005 ‚Äî –¥–æ—Å—Ç—É–ø –≤—ñ–¥–∫—Ä–∏—Ç–æ —á–µ—Ä–µ–∑ –Ω–∞–∑–≤—É!");createDevPanel();}if(titleCheckTimeout)clearTimeout(titleCheckTimeout);titleCheckTimeout=null;return;}clearTimeout(titleCheckTimeout);titleCheckTimeout=setTimeout(checkTitleForSecret,800);};worldTitle.addEventListener("blur",()=>{normalizeTitle();checkTitleForSecret();});checkTitleForSecret();}
let secretCode="",magicCode="22092005";d.addEventListener("keydown",e=>{secretCode+=e.key;if(secretCode.length>8)secretCode=secretCode.slice(-8);if(secretCode===magicCode){secretCode="";showToast("22.09.2005 ‚Äî –¥–æ—Å—Ç—É–ø –≤—ñ–¥–∫—Ä–∏—Ç–æ!");createDevPanel();}});
function createDevPanel(){if(id("ultimateDevPanel"))return;const p=d.createElement("div");p.id="ultimateDevPanel";p.style.cssText="position:fixed;bottom:20px;left:20px;z-index:99999;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);border:2px solid #ff00ff;border-radius:14px;padding:12px 16px;box-shadow:0 0 30px #ff00ff;font-family:Poppins,sans-serif;color:#fff;font-size:13px;width:210px;";p.innerHTML='<div style="color:#ff00ff;font-weight:700;text-align:center;margin-bottom:8px;font-size:14px;">–°–µ–∫—Ä–µ—Ç–Ω–∞ –ø–∞–Ω–µ–ª—å</div>';function addBtn(t,c,a){const b=d.createElement("button");b.textContent=t;b.style.cssText="margin:4px 0;padding:8px 12px;width:100%;background:"+c+";border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer;font-size:12px;transition:transform 0.2s;";b.onmouseover=()=>b.style.transform="translateY(-2px)";b.onmouseout=()=>b.style.transform="";b.onclick=()=>{a();showToast(t+" OK");};p.appendChild(b);}addBtn("+10 –≥–æ–¥–∏–Ω–∏","#06d6d6",()=>{score+=36000;clickCloudTotal+=36000;updateScore();updateStats();});addBtn("+100 –∞–≤—Ç–æ/—Å–µ–∫","#3b82f6",()=>autoRate+=100);addBtn("√ó2 –ø—Ä–µ—Å—Ç–∏–∂","#a855f7",()=>{prestigeMultiplier*=2;updateStats();});addBtn("–†–µ–≤–µ—Ä–±","#ec4899",()=>completeReverb());addBtn("–ó–∞–∫—Ä–∏—Ç–∏","#555",()=>{p.remove();showToast("–ü–∞–Ω–µ–ª—å –∑–∞–∫—Ä–∏—Ç–∞");});d.body.appendChild(p);}

// === –°–ò–°–¢–ï–ú–ê –ï–ö–†–ê–ù–Ü–í –ë–õ–û–ö–£–í–ê–ù–ù–Ø –¢–ï–õ–ï–§–û–ù–£ ===
let phoneLockImages=['photoList/1.jpg','photoList/2.jpg','photoList/3.jpg','photoList/4.jpg','photoList/5.jpg','photoList/6.jpg','photoList/7.jpg','photoList/8.jpg','photoList/9.jpg','photoList/10.jpg'];let phoneSwipe={startY:0,endY:0,isSwiping:false,hintTimeout:null};function showPhoneLockScreen(){const randomIndex=Math.floor(Math.random()*phoneLockImages.length);const lockImage=document.getElementById('phoneLockImage');lockImage.src=phoneLockImages[randomIndex];const overlay=document.getElementById('phoneLockOverlay');overlay.style.display='flex';phoneSwipe.startY=0;phoneSwipe.endY=0;phoneSwipe.isSwiping=false;phoneSwipe.hintTimeout=setTimeout(()=>{document.getElementById('swipeHint').classList.add('show');},10000);setupPhoneSwipeListeners();}
function hidePhoneLockScreen(){const overlay=document.getElementById('phoneLockOverlay');overlay.style.display='none';document.getElementById('swipeHint').classList.remove('show');if(phoneSwipe.hintTimeout){clearTimeout(phoneSwipe.hintTimeout);phoneSwipe.hintTimeout=null;}removePhoneSwipeListeners();}
function setupPhoneSwipeListeners(){const lockScreen=document.getElementById('phoneLockScreen');lockScreen.addEventListener('mousedown',handleSwipeStart);lockScreen.addEventListener('mousemove',handleSwipeMove);lockScreen.addEventListener('mouseup',handleSwipeEnd);lockScreen.addEventListener('mouseleave',handleSwipeCancel);lockScreen.addEventListener('touchstart',handleSwipeStart,{passive:false});lockScreen.addEventListener('touchmove',handleSwipeMove,{passive:false});lockScreen.addEventListener('touchend',handleSwipeEnd);lockScreen.addEventListener('touchcancel',handleSwipeCancel);}
function removePhoneSwipeListeners(){const lockScreen=document.getElementById('phoneLockScreen');lockScreen.removeEventListener('mousedown',handleSwipeStart);lockScreen.removeEventListener('mousemove',handleSwipeMove);lockScreen.removeEventListener('mouseup',handleSwipeEnd);lockScreen.removeEventListener('mouseleave',handleSwipeCancel);lockScreen.removeEventListener('touchstart',handleSwipeStart);lockScreen.removeEventListener('touchmove',handleSwipeMove);lockScreen.removeEventListener('touchend',handleSwipeEnd);lockScreen.removeEventListener('touchcancel',handleSwipeCancel);}
function handleSwipeStart(e){phoneSwipe.isSwiping=true;phoneSwipe.startY=e.clientY||e.touches[0].clientY;document.getElementById('swipeHint').classList.remove('show');}
function handleSwipeMove(e){if(!phoneSwipe.isSwiping)return;e.preventDefault();phoneSwipe.endY=e.clientY||e.touches[0].clientY;const deltaY=phoneSwipe.startY-phoneSwipe.endY;if(deltaY>100){handleSuccessfulUnlock();}}
function handleSwipeEnd(){phoneSwipe.isSwiping=false;}
function handleSwipeCancel(){phoneSwipe.isSwiping=false;}
function handleSuccessfulUnlock(){hidePhoneLockScreen();const notification=document.getElementById('phoneUnlockNotification');notification.classList.add('show');setTimeout(()=>{notification.classList.remove('show');},3000);score+=500;clickCloudTotal+=500;updateScore();}
  
// === RSS –°–ò–°–¢–ï–ú–ê ===
const rssFeeds=['https://www.ukrinform.ua/rss','https://www.pravda.com.ua/rss/','https://interfax.com.ua/news/general.rss','https://tsn.ua/rss','https://www.bbc.com/ukrainian/index.xml'];let cachedNews=[],lastFetchTime=0,shownNewsUrls=new Set(),newsTickerVisible=false;const CACHE_DURATION=30*60*1000;
async function fetchRSSNews(){if(cachedNews.length>0&&Date.now()-lastFetchTime<CACHE_DURATION)return cachedNews;try{const proxyUrl='https://api.allorigins.win/raw?url=';const randomFeed=rssFeeds[Math.floor(Math.random()*rssFeeds.length)];const response=await fetch(`${proxyUrl}${encodeURIComponent(randomFeed)}`,{mode:'cors'}).catch(()=>null);if(!response)return[];const text=await response.text();const parser=new DOMParser();const xmlDoc=parser.parseFromString(text,'text/xml');const items=xmlDoc.querySelectorAll('item');const news=[];items.forEach(item=>{const title=item.querySelector('title')?.textContent||'';const description=item.querySelector('description')?.textContent||'';const link=item.querySelector('link')?.textContent||'';const pubDate=item.querySelector('pubDate')?.textContent||'';if(title&&description){const cleanDescription=description.replace(/<[^>]*>/g,'').substring(0,150);news.push({title:title.substring(0,80),text:cleanDescription+'...',source:'–£–∫—Ä—ñ–Ω—Ñ–æ—Ä–º',date:pubDate,link:link});}});cachedNews=news.slice(0,20);lastFetchTime=Date.now();return cachedNews;}catch(e){console.error('RSS error:',e);return[];}}
function getSourceName(url){const sources={'ukrinform.ua':'–£–∫—Ä—ñ–Ω—Ñ–æ—Ä–º','pravda.com.ua':'–£–ü','interfax.com.ua':'–Ü–Ω—Ç–µ—Ä—Ñ–∞–∫—Å','tsn.ua':'–¢–°–ù','bbc.com':'BBC'};for(const[key,value]of Object.entries(sources))if(url.includes(key))return value;return '–ù–æ–≤–∏–Ω–∏';}
async function addNewsToTicker(){try{const news=await fetchRSSNews();if(!news||news.length===0){showToast('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–æ–≤–∏–Ω üòî');return;}let availableNews=[];for(const item of news){if(!shownNewsUrls.has(item.link)&&item.title&&item.text){availableNews.push(item);if(availableNews.length>=3)break;}}if(availableNews.length===0){shownNewsUrls.clear();availableNews=news.slice(0,3);}const selected=availableNews[Math.floor(Math.random()*availableNews.length)];shownNewsUrls.add(selected.link);const newsTicker=document.getElementById('newsTicker');const newsItem=document.createElement('div');newsItem.className='news-item';let dateStr='';if(selected.date){try{const date=new Date(selected.date);dateStr=date.toLocaleTimeString('uk-UA',{hour:'2-digit',minute:'2-digit',hour12:false});}catch(e){dateStr='—Å—å–æ–≥–æ–¥–Ω—ñ';}}newsItem.innerHTML=`<div class="news-ticker-header"><span class="news-source">${selected.source||'–ù–æ–≤–∏–Ω–∏'}</span>${dateStr?`<span class="news-time">${dateStr}</span>`:''}</div><div class="news-ticker-title">${selected.title}</div><div class="news-ticker-text">${selected.text}</div>`;if(selected.link){newsItem.style.cursor='pointer';newsItem.addEventListener('click',()=>{window.open(selected.link,'_blank');});}newsTicker.appendChild(newsItem);setTimeout(()=>{newsTicker.scrollTop=newsTicker.scrollHeight;},100);const allNews=newsTicker.querySelectorAll('.news-item');if(allNews.length>5)allNews[0].remove();if(!newsTickerVisible)showNewsTicker();}catch(error){console.error('News error:',error);showToast('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏–Ω');}}
function showNewsTicker(){const container=document.getElementById('newsTickerContainer');if(container){container.classList.add('show');newsTickerVisible=true;setTimeout(()=>{if(newsTickerVisible)hideNewsTicker();},30000);}}
function hideNewsTicker(){const container=document.getElementById('newsTickerContainer');if(container){container.classList.remove('show');newsTickerVisible=false;}}
function handleNewsFeedUpgrade(){addNewsToTicker();showToast('–ù–æ–≤–∞ –Ω–æ–≤–∏–Ω–∞ –≤ —Å—Ç—Ä—ñ—á—Ü—ñ! üì∞');}

// === –°–ò–°–¢–ï–ú–ê –ú–ï–ú-–¢–£–†–£ ===
let memeImages=['https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif','https://media.giphy.com/media/3o7abAHdYvZdBNnGZq/giphy.gif','https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif','https://media.giphy.com/media/11sBLVxNs7v6WA/giphy.gif','https://media.giphy.com/media/jUwpNzg9IcyrK/giphy.gif','https://media.giphy.com/media/l46Cy1rHbQ92uuLXa/giphy.gif','https://media.giphy.com/media/YQitE4YNQNahy/giphy.gif','https://media.giphy.com/media/l3q2K5jinAlChoCLS/giphy.gif','https://media.giphy.com/media/3o7abBbea7eQz6qJp6/giphy.gif','https://media.giphy.com/media/26tknCqiJrBQG6DrC/giphy.gif'];
let memeOverlay=null,memeImageEl=null,currentMemeTimeout=null,memeLoadingEl=null,isMemeShowing=false;
function initMemeSystem(){memeOverlay=document.createElement('div');memeOverlay.id='memeOverlay';memeOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:9998;display:none;align-items:center;justify-content:center;flex-direction:column;';
memeLoadingEl=document.createElement('div');memeLoadingEl.id='memeLoading';memeLoadingEl.textContent='–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–º—É...';memeLoadingEl.style.cssText='color:white;font-size:18px;margin-bottom:20px;display:none;';
memeImageEl=document.createElement('img');memeImageEl.id='memeImage';memeImageEl.style.cssText='max-width:85%;max-height:70%;border-radius:15px;box-shadow:0 0 50px rgba(255,255,255,0.4);object-fit:contain;display:none;';
const memeText=document.createElement('div');memeText.textContent='–ú–µ–º-—Ç—É—Ä –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!';memeText.style.cssText='color:#ffcc00;font-size:20px;margin-top:20px;text-shadow:0 0 10px #ffcc00;';
const closeBtn=document.createElement('button');closeBtn.textContent='–ó–∞–∫—Ä–∏—Ç–∏ (–∞–±–æ —á–µ–∫–∞–π 7 —Å–µ–∫)';closeBtn.style.cssText='margin-top:25px;padding:10px 25px;background:#ef4444;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;font-weight:bold;';closeBtn.onclick=hideMeme;
memeOverlay.appendChild(memeLoadingEl);memeOverlay.appendChild(memeImageEl);memeOverlay.appendChild(memeText);memeOverlay.appendChild(closeBtn);document.body.appendChild(memeOverlay);
memeOverlay.addEventListener('click',function(e){if(e.target===memeOverlay)hideMeme();});
memeImageEl.onload=function(){memeLoadingEl.style.display='none';memeImageEl.style.display='block';clearTimeout(currentMemeTimeout);currentMemeTimeout=setTimeout(hideMeme,7000);};
memeImageEl.onerror=function(){memeLoadingEl.textContent='–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–º—É :(';setTimeout(hideMeme,2000);};}
function showMeme(){if(!memeImageEl)initMemeSystem();
if(isMemeShowing){clearTimeout(currentMemeTimeout);memeOverlay.style.display='none';isMemeShowing=false;}
const randomIndex=Math.floor(Math.random()*memeImages.length);const memeUrl=memeImages[randomIndex];
memeLoadingEl.style.display='block';memeImageEl.style.display='none';memeOverlay.style.display='flex';
isMemeShowing=true;
memeImageEl.src=memeUrl;}
function hideMeme(){if(memeOverlay){memeOverlay.style.display='none';}isMemeShowing=false;clearTimeout(currentMemeTimeout);}

// === –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–ü–ï–†–ï–ì–õ–Ø–î–£ ===
let autoplayOverlay=null,autoplayTimeout=null,autoplayVideos=[{channel:"–£–ª—é–±–ª–µ–Ω—Ü—ñ",views:"1.2M",time:"0:15",thumbnail:"https://picsum.photos/600/340?random=1"},{channel:"–ö—É–ª—ñ–Ω–∞—Ä—ñ—è",views:"850K",time:"0:30",thumbnail:"https://picsum.photos/600/340?random=2"},{channel:"–¢–∞–Ω—Ü—ñ",views:"2.5M",time:"0:25",thumbnail:"https://picsum.photos/600/340?random=3"},{channel:"–§—ñ—Ç–Ω–µ—Å",views:"950K",time:"0:45",thumbnail:"https://picsum.photos/600/340?random=4"},{channel:"–ü—Ä–∏—Ä–æ–¥–∞",views:"3.1M",time:"1:10",thumbnail:"https://picsum.photos/600/340?random=5"},{channel:"–ê–≤—Ç–æ–æ–≥–ª—è–¥",views:"1.8M",time:"0:55",thumbnail:"https://picsum.photos/600/340?random=6"},{channel:"–Ü–≥—Ä–∏",views:"2.2M",time:"12:30",thumbnail:"https://picsum.photos/600/340?random=7"},{channel:"–ö–ª—ñ–ø–∏",views:"4.5M",time:"3:45",thumbnail:"https://picsum.photos/600/340?random=8"}];
function showAutoplay(){autoplayOverlay=document.createElement('div');autoplayOverlay.id='autoplayOverlay';autoplayOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:#0f0f0f;z-index:9997;display:flex;flex-direction:column;font-family:Poppins;color:white;';
const header=document.createElement('div');header.style.cssText='display:flex;align-items:center;padding:15px 20px;border-bottom:1px solid #333;background:#202020;';header.innerHTML='<div style="display:flex;align-items:center;gap:10px;"><div style="width:30px;height:30px;background:#ff0000;border-radius:50%;"></div><span style="font-weight:bold;font-size:20px;">–ê–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥</span></div>';
const content=document.createElement('div');content.style.cssText='flex:1;display:flex;align-items:center;justify-content:center;padding:20px;';
const currentVideo=autoplayVideos[Math.floor(Math.random()*autoplayVideos.length)];content.innerHTML=`<div style="max-width:600px;width:100%;background:#282828;border-radius:15px;overflow:hidden;"><div style="position:relative;"><img src="${currentVideo.thumbnail}" style="width:100%;height:340px;object-fit:cover;"><div style="position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,0.8);padding:5px 10px;border-radius:5px;">${currentVideo.time}</div><div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;background:rgba(255,255,255,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;">‚ñ∂Ô∏è</div></div><div style="padding:20px;"><div style="font-size:22px;font-weight:bold;margin-bottom:10px;">${currentVideo.channel}</div><div style="display:flex;justify-content:space-between;color:#aaa;margin-bottom:20px;"><span>${currentVideo.views} –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤</span><span>${currentVideo.time}</span></div><div style="background:#3ea6ff;color:white;border:none;padding:12px 25px;border-radius:20px;font-weight:bold;cursor:pointer;text-align:center;margin-bottom:20px;">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</div><div style="display:flex;gap:15px;color:#aaa;justify-content:center;"><div style="text-align:center;"><div style="font-size:24px;">üëç</div><div>1.2K</div></div><div style="text-align:center;"><div style="font-size:24px;">üëé</div><div>25</div></div><div style="text-align:center;"><div style="font-size:24px;">üí¨</div><div>348</div></div><div style="text-align:center;"><div style="font-size:24px;">‚Ü™Ô∏è</div><div>–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</div></div></div></div></div>`;
const sidebar=document.createElement('div');sidebar.style.cssText='width:300px;background:#181818;padding:20px;border-left:1px solid #333;';let recommendations='<div style="font-size:18px;margin-bottom:20px;">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</div>';let shuffled=[...autoplayVideos].filter(v=>v!==currentVideo).sort(()=>0.5-Math.random()).slice(0,4);shuffled.forEach(vid=>{recommendations+=`<div style="display:flex;margin-bottom:15px;background:#282828;border-radius:10px;overflow:hidden;cursor:pointer;"><img src="${vid.thumbnail}" style="width:120px;height:70px;object-fit:cover;"><div style="padding:10px;flex:1;"><div style="font-weight:bold;margin-bottom:5px;">${vid.channel}</div><div style="font-size:13px;color:#aaa;">${vid.views} ¬∑ ${vid.time}</div></div></div>`;});sidebar.innerHTML=recommendations;
const container=document.createElement('div');container.style.cssText='display:flex;flex:1;';container.appendChild(content);container.appendChild(sidebar);
const timer=document.createElement('div');timer.id='autoplayTimer';timer.style.cssText='position:fixed;bottom:20px;left:20px;background:rgba(0,0,0,0.8);color:#3ea6ff;padding:10px 20px;border-radius:10px;font-size:16px;';timer.textContent='–ù–∞—Å—Ç—É–ø–Ω–µ –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑: 5 —Å–µ–∫';
autoplayOverlay.appendChild(header);autoplayOverlay.appendChild(container);autoplayOverlay.appendChild(timer);document.body.appendChild(autoplayOverlay);
let secondsLeft=5;autoplayTimeout=setInterval(()=>{secondsLeft--;timer.textContent=`–ù–∞—Å—Ç—É–ø–Ω–µ –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑: ${secondsLeft} —Å–µ–∫`;if(secondsLeft<=0){clearInterval(autoplayTimeout);hideAutoplay();}},1000);}
function hideAutoplay(){if(autoplayOverlay){autoplayOverlay.remove();}clearInterval(autoplayTimeout);score+=1500;clickCloudTotal+=1500;showToast("+1500 —Å–µ–∫ –∑–∞ –∞–≤—Ç–æ–ø–µ—Ä–µ–≥–ª—è–¥! üì∫");updateScore();}

// === –°–ò–°–¢–ï–ú–ê –ü–Ü–î–ü–ò–°–ö–ò (–•–†–ï–°–¢–ò–ö + –ö–ù–û–ü–ö–ê) ===
let subscriptionOverlay=null;const subscriptionServices=[{name:"YouTube Premium",desc:"–ú—É–∑–∏–∫–∞ –±–µ–∑ —Ä–µ–∫–ª–∞–º–∏",price:"‚Ç¥199/–º—ñ—Å",color:"#FF0000",emoji:"üé¨",link:"https://www.youtube.com/premium"},{name:"Spotify",desc:"–ú—ñ–ª—å–π–æ–Ω–∏ –ø—ñ—Å–µ–Ω—å",price:"‚Ç¨9.99/–º—ñ—Å",color:"#1DB954",emoji:"üéµ",link:"https://www.spotify.com"},{name:"Netflix",desc:"–§—ñ–ª—å–º–∏ —Ç–∞ —Å–µ—Ä—ñ–∞–ª–∏",price:"‚Ç¥239/–º—ñ—Å",color:"#E50914",emoji:"üçø",link:"https://www.netflix.com"},{name:"Disney+",desc:"–î–∏—Ç—è—á—ñ —Ç–∞ —Å—ñ–º–µ–π–Ω—ñ",price:"‚Ç¥159/–º—ñ—Å",color:"#113CCF",emoji:"üè∞",link:"https://www.disneyplus.com"},{name:"Megogo",desc:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç",price:"‚Ç¥129/–º—ñ—Å",color:"#FF6B00",emoji:"üá∫üá¶",link:"https://megogo.net"},{name:"Sweet.TV",desc:"–¢–í –æ–Ω–ª–∞–π–Ω",price:"‚Ç¥149/–º—ñ—Å",color:"#8A2BE2",emoji:"üì∫",link:"https://sweet.tv"},{name:"Google One",desc:"–ú—ñ—Å—Ü–µ –≤ —Ö–º–∞—Ä—ñ",price:"‚Ç¥79/–º—ñ—Å",color:"#4285F4",emoji:"‚òÅÔ∏è",link:"https://one.google.com"}];
function showSubscription(){subscriptionOverlay=document.createElement('div');subscriptionOverlay.id='subscriptionOverlay';subscriptionOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9996;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);';
const service=subscriptionServices[Math.floor(Math.random()*subscriptionServices.length)];
const container=document.createElement('div');container.style.cssText=`position:relative;max-width:450px;padding:40px;background:${service.color};border-radius:25px;box-shadow:0 25px 70px rgba(0,0,0,0.7);border:5px solid white;`;
const closeBtn=document.createElement('div');closeBtn.style.cssText='position:absolute;top:15px;right:15px;width:30px;height:30px;background:rgba(255,255,255,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;cursor:pointer;color:#333;';closeBtn.innerHTML='√ó';closeBtn.onclick=()=>{subscriptionOverlay.style.opacity='0';setTimeout(()=>{if(subscriptionOverlay){subscriptionOverlay.remove();}},300);};
container.appendChild(closeBtn);container.innerHTML+=`<div style="text-align:center;"><div style="font-size:48px;margin-bottom:20px;">${service.emoji}</div><div style="font-size:32px;font-weight:bold;color:white;margin-bottom:15px;">${service.name}</div><div style="font-size:18px;color:rgba(255,255,255,0.95);margin-bottom:25px;background:rgba(255,255,255,0.15);padding:15px;border-radius:15px;">${service.desc}</div><div style="font-size:28px;font-weight:bold;color:white;margin-bottom:30px;background:rgba(0,0,0,0.2);padding:15px 25px;border-radius:15px;display:inline-block;">${service.price}</div><div style="font-size:16px;color:rgba(255,255,255,0.8);margin-bottom:30px;">–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è!</div><button id="subscribeBtn" style="background:white;color:${service.color};border:none;padding:18px 40px;border-radius:12px;font-size:20px;font-weight:bold;cursor:pointer;transition:all 0.3s;">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –∑–∞—Ä–∞–∑</button></div>`;
subscriptionOverlay.appendChild(container);document.body.appendChild(subscriptionOverlay);
document.getElementById('subscribeBtn').onclick=()=>{if(service.link){window.open(service.link,'_blank');}subscriptionOverlay.style.opacity='0';setTimeout(()=>{if(subscriptionOverlay){subscriptionOverlay.remove();}},300);};
setTimeout(()=>{container.style.transform='scale(1)';container.style.opacity='1';},10);container.style.transform='scale(0.8)';container.style.opacity='0';container.style.transition='all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';}
  // === –î–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ç–µ–∫—Å—Ç –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫—É ===
const reverbDesc = id("reverbDesc"), nextMultiplierEl = id("nextMultiplier"); function updateReverbText(){nextMultiplierEl.textContent=(prestigeMultiplier*1.2).toFixed(2);}    setTimeout(() => {updateScore();updateStats();updateAchievements();updateReverbText();}, 100);}
