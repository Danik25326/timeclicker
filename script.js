// === –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ===
const rssFeeds=['https://www.ukrinform.ua/rss','https://www.pravda.com.ua/rss/','https://interfax.com.ua/news/general.rss'],CACHE_DURATION=36e5;
let score=0,clickPower=1,autoRate=0,isPlaying=0,currentTrack=0,displayedTrackIndex=0,sessionStart=Date.now(),totalUpgradesBought=0,maxPerClick=1,prestigeMultiplier=1,totalReverbs=0,maxAutoRate=0,maxCombo=0,clickCloudTotal=0,lastClickTime=0,currentCombo=0,maxComboEver=0,comboTimeout=null,MAX_CLICK_INTERVAL=350,COMBO_THRESHOLD=5,isReverbActive=0,reverbHoldTimeout=null,clickMultiplier=1,buttons=[],prestigeThreshold=3600,currentPrestigeProgress=0,reverseClockHands=false,animationsEnabled=true,keepMusicOnPrestige=false,ownedTracks=[0],
gameState={v:'1.8',s:0,p:1,a:0,u:0,m:1,pm:1,tr:0,ma:0,mc:0,cct:0,pt:3600,cpp:0,cm:1,vol:45,rev:false,anim:true,lang:'uk',tutorialDone:false,ul:[],mb:[],ot:[0],ownedSkins:{shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]},currentSkins:{shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"}},
firstAchievementsCheck=true,cachedNews=[],lastFetchTime=0,newsTickerVisible=false,userGroqApiKey='',currentDiscordChannel='general',discordOverlay=null,discordChannelMessages={},unreadCounts={ai:1},discordActivityInterval=null,visitedChannels={},
constellation={center:{unlocked:false,level:0,maxLevel:1,bonusPerLevel:1000,cost:1,name:"–Ø–¥—Ä–æ —á–∞—Å—É"},hourHand:{stars:[{id:'h1',distance:100,angle:0,unlocked:false,bonus:{type:'prestige',value:0.1},cost:1},{id:'h2',distance:200,angle:0,unlocked:false,bonus:{type:'clickMultiplier',value:2},cost:2}],angle:0},minuteHand:{stars:[{id:'m1',distance:80,angle:90,unlocked:false,bonus:{type:'autoRate',value:50},cost:1},{id:'m2',distance:160,angle:90,unlocked:false,bonus:{type:'clickPower',value:5},cost:1},{id:'m3',distance:240,angle:90,unlocked:false,bonus:{type:'combo',value:10},cost:2},{id:'m4',distance:320,angle:90,unlocked:false,bonus:{type:'prestige',value:0.15},cost:3}],angle:90},secondHand:{stars:[{id:'s1',distance:70,angle:240,unlocked:false,bonus:{type:'clickPower',value:2},cost:1},{id:'s2',distance:140,angle:240,unlocked:false,bonus:{type:'autoRate',value:20},cost:1},{id:'s3',distance:210,angle:240,unlocked:false,bonus:{type:'skinDiscount',value:0.3},cost:2},{id:'s4',distance:280,angle:240,unlocked:false,bonus:{type:'prestige',value:0.05},cost:2},{id:'s5',distance:350,angle:240,unlocked:false,bonus:{type:'all',value:1.5},cost:5}],angle:240}},skillPoints=0,isConstellationVisible=false,
languages=[{code:'uk',name:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞',native:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'},{code:'en',name:'English',native:'English'},{code:'pl',name:'Polish',native:'Polski'},{code:'de',name:'German',native:'Deutsch'},{code:'fr',name:'French',native:'Fran√ßais'},{code:'es',name:'Spanish',native:'Espa√±ol'},{code:'it',name:'Italian',native:'Italiano'}],
isTutorialActive=false,currentTutorialStep=0,typewriterTimeout=null,fullTextString='',isTextTyping=false;
const d=document,q=s=>d.querySelector(s),qa=s=>d.querySelectorAll(s),id=s=>d.getElementById(s);
// === –§–£–ù–ö–¶–Ü–Ø –ü–ï–†–ï–ö–õ–ê–î–£ ===
function L(lang){return GameLocales[lang]||GameLocales.uk;}
function t(path){const l=gameState.lang;const p=path.split('.');let o=L(l);for(let k of p)o=o?o[k]:null;if(!o){o=L('uk');for(let k of p)o=o?o[k]:null;}return o||path;}
function changeLanguage(lang){gameState.lang=lang;const D=L(lang);
 // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
 const map={
  "h2":"title","[data-lang-key='pc_version']":"pc","[data-lang-key='mobile_version']":"mob",
  "[data-lang-key='tab_upgrades_title']":"sect.0","[data-lang-key='tab_skins_title']":"sect.1","[data-lang-key='tab_stats_title']":"sect.2","[data-lang-key='tab_achievements_title']":"sect.3","[data-lang-key='tab_reverb_title']":"sect.4","[data-lang-key='tab_multipliers_title']":"sect.5","[data-lang-key='tab_settings']":"sect.6","[data-lang-key='tab_tutorial_title']":"sect.7","[data-lang-key='tab_developers_title']":"sect.8",
  "[data-lang-key='skin_shape_title']":"skins.0","[data-lang-key='skin_color_title']":"skins.1","[data-lang-key='skin_hand_title']":"skins.2","[data-lang-key='skin_effect_title']":"skins.3",
  "[data-lang-key='stat_spent']":"stats.0","[data-lang-key='stat_real_time']":"stats.1","[data-lang-key='stat_virtual_time']":"stats.2","[data-lang-key='stat_upgrades_bought']":"stats.3","[data-lang-key='stat_max_click']":"stats.4","[data-lang-key='stat_max_auto']":"stats.5","[data-lang-key='stat_max_combo']":"stats.6","[data-lang-key='stat_total_reverbs']":"stats.7","[data-lang-key='stat_current_mult']":"stats.8","[data-lang-key='stat_achievements']":"stats.9","[data-lang-key='stat_skins_collected']":"stats.10","[data-lang-key='stat_total_skins']":"stats.11",
  "[data-lang-key='reverb_desc_part1']":"rev.desc1","[data-lang-key='reverb_desc_part2']":"rev.desc2","[data-lang-key='reverb_progress']":"rev.prog","[data-lang-key='reverb_next_mult']":"rev.next","[data-lang-key='btn_reverb']":"rev.btn","[data-lang-key='reverb_instruction']":"rev.instr","[data-lang-key='reverb_hint']":"rev.hint",
  "[data-lang-key='settings_volume']":"sett.vol","[data-lang-key='settings_reverse']":"sett.rev","[data-lang-key='settings_anim']":"sett.anim","[data-lang-key='btn_save']":"sett.save","[data-lang-key='btn_export']":"sett.exp","[data-lang-key='btn_import']":"sett.imp","[data-lang-key='btn_reset']":"sett.reset","[data-lang-key='btn_lang']":"sett.lang","[data-lang-key='btn_restart_tutorial']":"sett.tut",
  "[data-lang-key='wiki_how_play']":"wiki.h1","[data-lang-key='wiki_how_play_desc']":"wiki.d1","[data-lang-key='wiki_upgrades']":"wiki.h2","[data-lang-key='wiki_upgrades_desc']":"wiki.d2","[data-lang-key='wiki_multipliers']":"wiki.h3","[data-lang-key='wiki_multipliers_desc']":"wiki.d3","[data-lang-key='wiki_reverb']":"wiki.h4","[data-lang-key='wiki_reverb_desc']":"wiki.d4",
  "[data-lang-key='dev_credits']":"dev.cred","[data-lang-key='btn_support']":"dev.btn",
  "[data-lang-key='score_prefix']":"ui.score","[data-lang-key='music_now']":"ui.now","[data-lang-key='btn_music_on']":"ui.play","[data-lang-key='clicks']":"ui.click",
  "[data-lang-key='unit_sec']":"ui.sec","[data-lang-key='unit_hour']":"ui.hr","[data-lang-key='phone_swipe_hint']":"ui.swipe","[data-lang-key='phone_unlocked']":"ui.unl"
 };
 for(let s in map){const el=q(s);if(el)el.innerHTML=t(map[s]);}
 // –í–∫–ª–∞–¥–∫–∏
 qa('.top-tabs .tab').forEach((el,i)=>{if(D.tabs[i])el.textContent=D.tabs[i];});
 // –†–µ-—Ä–µ–Ω–¥–µ—Ä
 upgradesContainer.innerHTML='';buttons=[];initUpgrades();
 multipliersContainer.innerHTML='';initMultipliers();
 refreshAllSkinGrids();updateAchievements();updateMusicUI();updateScore();updateStats();saveGame();}
function openLanguageModal(){const m=id('languageSelectionOverlay'),l=id('langList'),s=id('langSearch'),b=id('langConfirmBtn');m.style.display='flex';b.style.display='none';
 const render=(f)=>{l.innerHTML='';languages.filter(x=>x.name.toLowerCase().includes(f)||x.native.toLowerCase().includes(f)).forEach(lang=>{const btn=d.createElement('button');btn.className='choose-btn';btn.style.cssText='min-width:auto;padding:15px;font-size:16px;text-align:left;';btn.innerHTML=`<span style="font-size:1.2em">${lang.native}</span><br><span style="font-size:0.8em;opacity:0.7">${lang.name}</span>`;btn.onclick=()=>{changeLanguage(lang.code);qa('#langList .choose-btn').forEach(b=>b.style.border='none');btn.style.border='2px solid white';b.style.display='block';};l.appendChild(btn);});};render('');s.oninput=(e)=>render(e.target.value.toLowerCase());
 b.onclick=()=>{m.style.display='none';if(!gameState.tutorialDone && score<10) showTutorialChoice();};}
// === –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ===
window.startGame=function(v){id('chooser').style.display='none';id('game').classList.remove('game-hidden');if(v==='mobile')d.body.classList.add('mobile-version');else d.body.classList.remove('mobile-version');initGame();}
function initGame(){initializeDOMElements();initializeSystems();let loaded=loadGame();
 if(!loaded){refreshAllSkinGrids();applyAllSkins();saveGame();checkFirstRun();}else{changeLanguage(gameState.lang);if(!gameState.tutorialDone&&score<10)checkFirstRun();}startIntervals();setTimeout(()=>{updateScore();updateStats();updateReverbText();refreshAllSkinGrids();applyAllSkins();updateAchievements();firstAchievementsCheck=false;updateDevLinks();},100);}
function initializeDOMElements(){window.clock=id("clickableClock");window.clockWrapper=id("clockWrapper");window.comboBubble=id("comboBubble");window.comboCount=id("comboCount");window.clickCloudEl=id("clickCloud");window.musicBtn=id("musicBtn");window.prevTrack=id("prevTrack");window.nextTrack=id("nextTrack");window.player=id("player");window.scoreText=id("score");window.upgradesContainer=id("upgrades");window.multipliersContainer=id("multipliers");window.clickGainEl=id("clickGain");window.cloudTotalEl=id("cloudTotal");window.nowPlaying=id("nowPlaying");window.realTimePlayedEl=id("realTimePlayed");window.virtualTimeEl=id("virtualTime");window.totalUpgradesEl=id("totalUpgrades");window.maxPerClickEl=id("maxPerClick");window.prestigeMultEl=id("prestigeMult");window.reverbBtn=id("reverbBtn");window.timeTunnel=id("timeTunnel");window.worldTitle=id("worldTitle");window.toastContainer=id("toastContainer");window.reverbOverlay=id("reverbOverlay");window.reverbClock=id("reverbClock");window.reverbHint=id("reverbHint");window.reverbDesc=id("reverbDesc");window.nextMultiplierEl=id("nextMultiplier");if(window.clock)window.clock.style.borderWidth='10px';if(window.reverbClock)window.reverbClock.style.borderWidth='10px';}
function initializeSystems(){initDate();initMusic();initUpgrades();initMultipliers();initAchievements();initSkins();initReverbSystem();initTabs();initSecretSystem();initClickHandler();initSettings();initConstellationSystem();initNewTabs();}
function initDate(){function updateDate(){id("currentDate").textContent=new Date().toLocaleDateString(gameState.lang==='uk'?'uk-UA':'en-US');}updateDate();setInterval(updateDate,6e4);}
// === –¢–£–¢–û–†–Ü–ê–õ ===
function checkFirstRun(){setTimeout(()=>openLanguageModal(),500);}
function showTutorialChoice(){const d=id('tutorialDialogue'),c=id('tutorialChoiceBtns'),back=id('tutorialBackBtn'),next=id('tutorialNextBtn');id('tutorialOverlay').style.display='block';d.style.display='block';back.style.display='none';next.style.display='none';c.style.display='flex';
 typeText(t("tut.1"));
 id('skipTutorialChoice').onclick=()=>{endTutorial(true);};id('startTutorialChoice').onclick=()=>{startTutorial();};
 id('skipTutorialChoice').textContent=t("tut_btn.skip");id('startTutorialChoice').textContent=t("tut_btn.start");}
const tutorialSteps=[
 {key:"tut.2",action:"next"},
 {key:"tut.3",el:"#clockWrapper",action:"click_clock"},
 {key:"tut.4",el:"#score",action:"next"},
 {key:"tut.5",el:".music-player",action:"next",pos:"top"},
 {key:"tut.6",el:".left-panel",tab:"tab-upgrades",action:"next"},
 {key:"tut.7",el:"button[data-tab='tab-skins']",action:"next"},
 {key:"tut.8",el:".left-panel",tab:"tab-skins",action:"next"},
 {key:"tut.9",el:"#shapeSkins",action:"next"},
 {key:"tut.10",el:"button[data-tab='tab-stats']",action:"next"},
 {key:"tut.11",el:".left-panel",tab:"tab-stats",action:"next"},
 {key:"tut.12",el:"button[data-tab='tab-achievements']",action:"next"},
 {key:"tut.13",el:".left-panel",tab:"tab-achievements",action:"next"},
 {key:"tut.14",el:"button[data-tab='tab-reverb']",action:"next"},
 {key:"tut.15",el:".left-panel",tab:"tab-reverb",action:"next"},
 {key:"tut.16",el:"button[data-tab='tab-multipliers']",action:"next"},
 {key:"tut.17",el:".left-panel",tab:"tab-multipliers",action:"next"},
 {key:"tut.18",el:"button[data-tab='settings']",action:"next"},
 {key:"tut.19",el:".left-panel",tab:"settings",action:"next"},
 {key:"tut.20",el:"button[data-tab='tab-tutorial']",action:"next"},
 {key:"tut.21",el:".left-panel",tab:"tab-tutorial",action:"next"},
 {key:"tut.22",el:"button[data-tab='tab-developers']",action:"next"},
 {key:"tut.23",el:".left-panel",tab:"tab-developers",action:"next"},
 {key:"tut.24",action:"finish"}
];
function startTutorial(){isTutorialActive=true;currentTutorialStep=0;id('tutorialChoiceBtns').style.display='none';id('skipTutorialTopBtn').style.display='block';id('skipTutorialTopBtn').onclick=()=>endTutorial(true);id('tutorialOverlay').style.display='block';id('tutorialDialogue').style.display='block';showTutorialStep(0);}
function typeText(txt,cb){const t=id('tutorialText');t.innerHTML='';fullTextString=txt;isTextTyping=true;let i=0;clearTimeout(typewriterTimeout);
 const cursor=d.createElement('span');cursor.className='typing-cursor';cursor.textContent='|';t.appendChild(cursor);
 function type(){if(i<txt.length){t.innerHTML=txt.substring(0,i+1)+'<span class="typing-cursor">|</span>';i++;typewriterTimeout=setTimeout(type,20);id('tutorialDialogue').onclick=()=>finishTyping();}else{isTextTyping=false;if(cb)cb();id('tutorialDialogue').onclick=null;}}type();}
function finishTyping(){if(!isTextTyping)return;clearTimeout(typewriterTimeout);const t=id('tutorialText');t.innerHTML=fullTextString;isTextTyping=false;onStepTextComplete();}
function showTutorialStep(idx){if(idx>=tutorialSteps.length){endTutorial();return;}const step=tutorialSteps[idx];qa('.highlighted-step').forEach(e=>{e.classList.remove('highlighted-step');e.style.zIndex='';e.style.position='';});
 if(step.tab){const b=document.querySelector(`button[data-tab='${step.tab}']`);if(b)b.click();}
 const dia=id('tutorialDialogue');if(step.pos==='top')dia.classList.add('dialogue-top');else dia.classList.remove('dialogue-top');
 if(step.el){const el=d.querySelector(step.el);if(el){el.classList.add('highlighted-step');el.style.position='relative';el.style.zIndex='15001';el.scrollIntoView({behavior:'smooth',block:'center'});}}
 id('tutorialBackBtn').style.display=idx>0?'inline-block':'none';id('tutorialNextBtn').style.display='none';
 id('tutorialNextBtn').textContent=step.action==='finish'?t("tut_btn.fin"):t("tut_btn.next");id('tutorialBackBtn').textContent=t("tut_btn.back");
 id('tutorialBackBtn').onclick=prevTutorialStep;
 id('skipTutorialTopBtn').textContent=t("tut_btn.skip");
 typeText(t(step.key),()=>onStepTextComplete());}
function onStepTextComplete(){const step=tutorialSteps[currentTutorialStep];id('tutorialNextBtn').style.display='inline-block';
 if(step.action==='click_clock'){id('tutorialNextBtn').style.display='none';const c=id('clickableClock');c.classList.add('click-effect-neon');c.onclick=()=>{c.onclick=null;c.classList.remove('click-effect-neon');nextTutorialStep();};}
 else if(step.action==='finish'){id('tutorialNextBtn').onclick=()=>endTutorial();}
 else{id('tutorialNextBtn').onclick=nextTutorialStep;}}
function nextTutorialStep(){currentTutorialStep++;showTutorialStep(currentTutorialStep);}
function prevTutorialStep(){if(currentTutorialStep>0){currentTutorialStep--;showTutorialStep(currentTutorialStep);}}
function endTutorial(skip=false){isTutorialActive=false;gameState.tutorialDone=true;id('tutorialOverlay').style.display='none';id('tutorialDialogue').style.display='none';id('skipTutorialTopBtn').style.display='none';qa('.highlighted-step').forEach(e=>{e.classList.remove('highlighted-step');e.style.zIndex='';e.style.position='';});if(!skip)showToast(t("tut.24"));saveGame();}
// === –ú–£–ó–ò–ö–ê ===
function updateMusicUI(){const isOwned=ownedTracks.includes(displayedTrackIndex),cost=displayedTrackIndex*3600;nowPlaying.textContent=isOwned?(currentTrack===displayedTrackIndex&&isPlaying?`${t("ui.now")} ${trackNames[displayedTrackIndex]}`:`${t("ui.now")} ${trackNames[displayedTrackIndex]}`):`–ú–∞–≥–∞–∑–∏–Ω: ${trackNames[displayedTrackIndex]}`;if(!isOwned){musicBtn.innerHTML=`üí∞ ${t("ui.buy")} ${formatTime(cost)}`;musicBtn.style.background="linear-gradient(45deg, #f1c40f, #f39c12)";}else{musicBtn.style.background="";if(currentTrack===displayedTrackIndex&&isPlaying)musicBtn.textContent=t("ui.stop");else musicBtn.textContent=t("ui.play");}}
const trackNames=["Phonk #1","Phonk #2","Phonk #3","Phonk #4","Phonk #5","Phonk #6","Phonk #7"];
function initMusic(){const tracks=["asphalt-menace.mp3","digital-overdrive.mp3","drift-phonk-phonk-music-2-434611.mp3","drift-phonk-phonk-music-432222.mp3","phonk-music-409064 (2).mp3","phonk-music-phonk-2025-432208.mp3","pixel-drift.mp3"].map(x=>`musicList/${x}`);displayedTrackIndex=currentTrack;
 function loadTrack(i){player.src=tracks[i];}loadTrack(currentTrack);
 player.addEventListener("ended",()=>{if(ownedTracks.length>1){let next;do{next=(currentTrack+1)%tracks.length;}while(!ownedTracks.includes(next));currentTrack=next;displayedTrackIndex=next;loadTrack(currentTrack);player.play();updateMusicUI();}else{player.currentTime=0;player.play();}});
 musicBtn.addEventListener("click",()=>{if(ownedTracks.includes(displayedTrackIndex)){if(currentTrack!==displayedTrackIndex){currentTrack=displayedTrackIndex;loadTrack(currentTrack);isPlaying=1;player.volume=(gameState.vol||45)/100;player.play().catch(()=>{});}else{if(!isPlaying){isPlaying=1;player.volume=(gameState.vol||45)/100;player.play().catch(()=>{});}else{isPlaying=0;player.pause();}}}else{const cost=displayedTrackIndex*3600;if(score>=cost){score-=cost;ownedTracks.push(displayedTrackIndex);showToast(t("msg.buy")+" üéµ");updateScore();saveGame();}else{showToast(t("msg.no"));}}updateMusicUI();});
 prevTrack.onclick=()=>{displayedTrackIndex=(displayedTrackIndex-1+tracks.length)%tracks.length;updateMusicUI();};nextTrack.onclick=()=>{displayedTrackIndex=(displayedTrackIndex+1)%tracks.length;updateMusicUI();};updateMusicUI();}
// === –Ü–ì–†–û–í–Ü –ú–ï–•–ê–ù–Ü–ö–ò ===
function initClickHandler(){let lastClick=0;clockWrapper.addEventListener("click",evt=>{const now=Date.now();if(now-lastClick<50)return;lastClick=now;if(evt.target.closest("#clickableClock")||evt.target===clockWrapper)addTime();});}
function addTime(){const g=Math.round(clickPower*clickMultiplier*prestigeMultiplier);score+=g;clickCloudTotal+=g;if(g>maxPerClick)maxPerClick=g;clickGainEl.innerHTML=`+${formatTime(g)}`;showFloating(`+${formatTime(g)}`);triggerClickEffect();handleClickCombo();updateScore();updatePrestigeProgress();}
function handleClickCombo(){const n=Date.now();if(n-lastClickTime<MAX_CLICK_INTERVAL)currentCombo++;else currentCombo=1;lastClickTime=n;if(currentCombo>maxComboEver)maxComboEver=currentCombo;if(currentCombo>=COMBO_THRESHOLD){comboCount.textContent=currentCombo;comboBubble.classList.add("show");}clearTimeout(comboTimeout);comboTimeout=setTimeout(()=>{if(currentCombo>=COMBO_THRESHOLD){comboBubble.classList.add("burst");showToast(`${t("msg.com")} √ó${currentCombo}! üî•`);setTimeout(()=>comboBubble.classList.remove("show","burst"),700);}currentCombo=0;},300);}
function triggerClickEffect(){if(!animationsEnabled)return;clock.classList.remove("click-effect-red","click-effect-blue","click-effect-glitch","click-effect-blackhole","click-effect-ripple");void clock.offsetWidth;clock.classList.add("click-effect-"+current.effect);}
function showToast(t){const toastEl=d.createElement("div");toastEl.className="toast";toastEl.textContent=t;toastEl.style.cssText="font-size:18px;padding:22px 48px";toastContainer.appendChild(toastEl);setTimeout(()=>toastEl.remove(),1e4);}
function showFloating(t){if(!animationsEnabled)return;const floatEl=d.createElement("div");floatEl.textContent=t;floatEl.style.cssText="position:absolute;right:20px;top:50px;color:#ffccd1;font-weight:700;opacity:1;transition:all 0.9s ease-out";clockWrapper.appendChild(floatEl);requestAnimationFrame(()=>{floatEl.style.transform="translateX(60px) translateY(-80px)";floatEl.style.opacity="0";});setTimeout(()=>floatEl.remove(),920);}
// === –ê–ü–ì–†–ï–ô–î–ò ===
const upgrades=[{c:1,l:0},{c:8,l:0},{c:40,l:0},{c:200,l:0},{c:1100,l:0},{c:6500,l:0},{c:40000,l:0},{c:250000,l:0},{c:1600000,l:0},{c:10000000,l:0},{c:65000000,l:0},{c:400000000,l:0}];
function fib(n){if(n<=1)return n;let a=0,b=1;for(let i=2;i<=n;i++)[a,b]=[b,a+b];return b;}
function initUpgrades(){upgrades.forEach((u,i)=>{const b=d.createElement("button");b.className="upgrade-btn";if(i>0)b.classList.add("hidden");b.addEventListener("click",()=>buyUpgrade(i));upgradesContainer.appendChild(b);buttons.push(b);u.up=function(){const f=fib(u.l+6),c=Math.floor(u.c*f*(i+1));const D=L(gameState.lang);b.innerHTML=`${D.upg[i]} (Lv.${u.l})<span>${formatTime(c)}</span>`;b.disabled=score<c;};u.getC=function(){return Math.floor(u.c*fib(u.l+6)*(i+1));};u.up();});}
function revealNext(){const c=upgrades.filter(u=>u.l>0).length;if(buttons[c])buttons[c].classList.remove("hidden");}
function revealPurchasedUpgrades(){upgrades.forEach((u,i)=>{if(u.l>0&&buttons[i])buttons[i].classList.remove("hidden");});revealNext();}
function buyUpgrade(i){const u=upgrades[i],c=u.getC();if(score<c)return;score-=c;u.l++;totalUpgradesBought++;autoRate=0;upgrades.forEach((upg,idx)=>{if(upg.l>0){let fibSum=0;for(let lvl=1;lvl<=upg.l;lvl++){fibSum+=fib(lvl+2);}autoRate+=fibSum*(idx+1);}});
 const D=L(gameState.lang);showToast(`${t("msg.buy")} ${D.upg[i]} (Lv.${u.l}) ‚úÖ`);
 if(i===1)setTimeout(()=>showPhoneLockScreen(),500);if(i===2)setTimeout(()=>handleNewsFeedUpgrade(),300);if(i===3)setTimeout(()=>showMeme(),300);if(i===4)setTimeout(()=>showAutoplay(),300);if(i===5)setTimeout(()=>showSubscription(),300);if(i===6)setTimeout(()=>showSeriesMarathon(),300);if(i===7)setTimeout(()=>showDeadlineWork(),300);if(i===8)setTimeout(()=>showCringe(),300);if(i===9)setTimeout(()=>showDiscord(),300);if(i===10)setTimeout(()=>showReels(),300);if(i===11)setTimeout(()=>showPhilosophy(),300);
 requestAnimationFrame(()=>{revealNext();u.up();updateAllButtons();updateScore();updateStats();updateAchievements();updatePrestigeProgress();});if(i===0){d.body.classList.remove("eye-blink");void d.body.offsetWidth;d.body.classList.add("eye-blink");setTimeout(()=>d.body.classList.remove("eye-blink"),1000);}saveGame();}
function updateAllButtons(){upgrades.forEach(u=>u.up());multipliers.forEach(m=>m.up&&m.up());}
// === –ú–ù–û–ñ–ù–ò–ö–ò ===
const multipliers=[{c:5000,m:2,b:0},{c:50000,m:3,b:0},{c:1000000,m:10,b:0},{c:20000000,m:50,b:0},{c:100000000,m:100,b:0}];
function initMultipliers(){multipliers.forEach((m,idx)=>{const b=d.createElement("button");b.className="upgrade-btn multiplier-btn";function upB(){if(m.b){b.remove();return;}const a=score>=m.c;const D=L(gameState.lang);b.innerHTML=`${D.mult[idx]}<span>${formatTime(m.c)}</span>`;b.disabled=!a;b.style.background=a?"":"#334155";b.style.opacity=a?"1":"0.5";}b.addEventListener("click",()=>{if(score<m.c||m.b)return;requestAnimationFrame(()=>{score-=m.c;m.b=1;clickMultiplier=m.m;const D=L(gameState.lang);showToast(`${t("msg.buy")} ${D.mult[idx]}!`);upB();updateScore();updateStats();saveGame();});},{passive:true});multipliersContainer.appendChild(b);m.up=upB;upB();});}
// === UI –¢–ê –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø ===
function updateScore(){scoreText.innerHTML=`${t("ui.score")} ${formatTime(score)}`;cloudTotalEl.innerHTML=`${formatTime(clickCloudTotal)}`;updateAllButtons();if(window.musicBtn)musicBtn.dispatchEvent(new Event('check'));}
function updateStats(){realTimePlayedEl.textContent=formatTime((Date.now()-sessionStart)/1000);virtualTimeEl.textContent=formatTime(score);totalUpgradesEl.textContent=totalUpgradesBought;maxPerClickEl.textContent=formatTime(maxPerClick);prestigeMultEl.textContent=prestigeMultiplier.toFixed(2);id("maxAutoRate").textContent=formatTime(autoRate);id("maxCombo").textContent=maxComboEver;id("totalReverbs").textContent=totalReverbs;const a=achievementsList.filter(x=>x.done).length;id("achievedCount").textContent=a;id("totalAchievements").textContent=achievementsList.length;id("shapeSkinsCount").textContent=ownedSkins.shapes.length;id("clockSkinsCount").textContent=ownedSkins.clockSkins.length;id("handSkinsCount").textContent=ownedSkins.handSkins.length;id("effectSkinsCount").textContent=ownedSkins.effects.length;id("totalSkins").textContent=ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length;updateReverbText();updatePrestigeProgress();}
function formatTime(s){s=Math.floor(s);const D=L(gameState.lang);const u=[{n:D.ui.yr,v:31536e6},{n:D.ui.mo,v:2592e3},{n:D.ui.day,v:86400},{n:D.ui.hr,v:3600},{n:D.ui.min,v:60},{n:D.ui.sec,v:1}];let r=s,p=[];for(const x of u){const a=Math.floor(r/x.v);if(a>0){p.push(`${a} ${x.n}`);r%=x.v;}}return p.length?p.join(" "):`${s} ${D.ui.sec}`;}
// === –î–û–°–Ø–ì–ù–ï–ù–ù–Ø ===
let achievementsList=[];
function initAchievements(){const D=L(gameState.lang);achievementsList=[{t:D.ach[0],tg:1,g:()=>clickCloudTotal,done:false},{t:D.ach[1],tg:100,g:()=>score,done:false},{t:D.ach[2],tg:1,g:()=>totalUpgradesBought,done:false},{t:D.ach[3],tg:1,g:()=>autoRate>0?1:0,done:false},{t:D.ach[4],tg:50,g:()=>maxComboEver,done:false},{t:D.ach[5],tg:3,g:()=>ownedSkins.shapes.length,done:false},{t:D.ach[6],tg:3,g:()=>ownedSkins.clockSkins.length,done:false},{t:D.ach[7],tg:3,g:()=>ownedSkins.handSkins.length,done:false},{t:D.ach[8],tg:3,g:()=>ownedSkins.effects.length,done:false},{t:D.ach[9],tg:1,g:()=>(current.shape!=="round"||current.clock!=="neon-blue")?1:0,done:false}];const achRoot=id("achievements");achRoot.innerHTML='';achievementsList.forEach(a=>{const achEl=d.createElement("div");achEl.className="achievement";achEl.innerHTML=`<strong>${a.t}</strong><div class="ach-progress"></div><div class="ach-state">0%</div>`;achRoot.appendChild(achEl);a.p=achEl.querySelector(".ach-progress");a.s=achEl.querySelector(".ach-state");});}
const updateAchievements=()=>(achievementsList.forEach(a=>{const v=a.g(),p=Math.min(100,(v/a.tg)*100);a.p&&(a.p.style.width=p+"%");if(p>=100&&!a.done)a.done=true,a.s&&(a.s.textContent="‚úÖ",a.s.style.color="#8df299"),!firstAchievementsCheck&&showToast(`${t("stats.9")} ${a.t} ‚úÖ`);else if(p<100&&a.s)a.s.textContent=Math.floor(p)+"%";}),firstAchievementsCheck&&(firstAchievementsCheck=false));
// === –°–ö–Ü–ù–ò ===
const clockSkins=[{id:"neon-blue",p:0},{id:"purple",p:64800},{id:"pink",p:129600},{id:"black",p:259200}],
shapes=[{id:"round",p:0},{id:"square",p:28800},{id:"diamond",p:86400},{id:"oval",p:172800}],
handSkins=[{id:"darkblue",p:0},{id:"pixel",p:900},{id:"neon",p:9000},{id:"chrome",p:43200}],
effects=[{id:"red",p:0},{id:"blue",p:21600},{id:"glitch",p:108000},{id:"blackhole",p:360000},{id:"ripple",p:720000}];
let ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]},current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};
function buySkin(t,i,p,n){if(ownedSkins[t].includes(i)){current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]=i;applyAllSkins();refreshAllSkinGrids();return showToast(t("msg.sav"))}if(score<p)return showToast(t("msg.no"));score-=p;ownedSkins[t].push(i);current[t==="shapes"?"shape":t==="clockSkins"?"clock":t==="handSkins"?"hand":"effect"]=i;applyAllSkins();updateScore();updateStats();updateAchievements();updatePrestigeProgress();showToast(`${t("msg.buy")} ${n} ‚úÖ`);refreshAllSkinGrids();saveGame();}
function applyAllSkins(){qa('.clock').forEach(c=>c.className="clock "+current.shape);
 // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ (—Å–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É)
 const c=current.clock;const cl=c==="neon-blue"?"#0ea5e9":c==="purple"?"#8b5cf6":c==="pink"?"#ec4899":"#111";
 qa('.clock').forEach(el=>{el.style.borderColor=cl;el.style.boxShadow=`0 0 50px ${cl}, 0 0 100px ${cl}`;});
}
function createSkinGrid(ct,ls,type,nameKey){const r=id(ct);r.innerHTML="";const D=L(gameState.lang);ls.forEach((s,idx)=>{const skinEl=d.createElement("div");skinEl.className="skin";const n=D.skin_names[nameKey][idx];skinEl.textContent=n;const o=ownedSkins[type].includes(s.id);const a=current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]===s.id;if(o){skinEl.classList.add("owned");if(a)skinEl.classList.add("active");skinEl.onclick=()=>{current[type==="shapes"?"shape":type==="clockSkins"?"clock":type==="handSkins"?"hand":"effect"]=s.id;applyAllSkins();refreshAllSkinGrids();showToast("OK!");}}else{skinEl.style.opacity="0.4";if(score>=s.p){skinEl.style.opacity="1";skinEl.style.boxShadow="0 0 15px #0ff"}skinEl.innerHTML+=`<br><small style="color:#ff00ff">${formatTime(s.p)}</small>`;skinEl.onclick=()=>buySkin(type,s.id,s.p,n)}r.appendChild(skinEl)})}
function refreshAllSkinGrids(){createSkinGrid("shapeSkins",shapes,"shapes","sh");createSkinGrid("clockSkins",clockSkins,"clockSkins","cl");createSkinGrid("handSkins",handSkins,"handSkins","ha");createSkinGrid("effectSkins",effects,"effects","ef")}
function updateSkinHighlights(){/* –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ (—Å–ø—Ä–æ—â–µ–Ω–æ) */}
function initSkins(){refreshAllSkinGrids();applyAllSkins();}
// === –ì–û–î–ò–ù–ù–ò–ö –¢–ê –†–ï–í–ï–†–ë ===
function updateClockHands(){const n=new Date();let s=n.getSeconds()+n.getMilliseconds()/1000,m=n.getMinutes()+s/60,h=(n.getHours()%12||12)+m/60;if(reverseClockHands){s=60-s;m=60-m;h=12-h;if(h<=0)h+=12;}qa("#clickableClock .second").forEach(x=>x.style.transform=`translateX(-50%) rotate(${s*6}deg)`);qa("#clickableClock .minute").forEach(x=>x.style.transform=`translateX(-50%) rotate(${m*6}deg)`);qa("#clickableClock .hour").forEach(x=>x.style.transform=`translateX(-50%) rotate(${h*30}deg)`);}
function updatePrestigeProgress(){currentPrestigeProgress=score;const pB=id('prestigeProgressBar'),pT=id('prestigeProgressText'),pP=Math.min(100,(currentPrestigeProgress/prestigeThreshold)*100);if(pB){pB.style.width=pP+'%';pB.style.background=pP>=100?'linear-gradient(90deg, #10b981, #34d399)':pP>=50?'linear-gradient(90deg, #f59e0b, #fbbf24)':'linear-gradient(90deg, #ef4444, #f87171)';}if(pT)pT.innerHTML=`${formatTime(currentPrestigeProgress)} / ${formatTime(prestigeThreshold)}`;updateReverbButtonState();}
function updateReverbButtonState(){const c=currentPrestigeProgress>=prestigeThreshold;reverbBtn.disabled=!c;reverbBtn.style.opacity=c?'1':'0.6';reverbBtn.style.cursor=c?'pointer':'not-allowed';reverbBtn.style.background=c?'linear-gradient(90deg, #10b981, #34d399)':'linear-gradient(90deg, #6b7280, #9ca3af)';}
const updateReverbText=()=>(qa("#nextMultiplier").forEach(el=>el.textContent=(prestigeMultiplier*1.2).toFixed(2)),qa('#nextMultiplierFooter').forEach(el=>el.textContent=(prestigeMultiplier*1.2).toFixed(2)));
const restartEffect={active:!1,clocksInt:null,bubblesInt:null,init(){const effectOverlay=d.createElement("div");effectOverlay.id="restartEffectOverlay";effectOverlay.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;display:none;pointer-events:none;background:transparent;";d.body.appendChild(effectOverlay);this.clocksContainer=d.createElement("div");this.clocksContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";this.bubblesContainer=d.createElement("div");this.bubblesContainer.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;";effectOverlay.appendChild(this.clocksContainer);effectOverlay.appendChild(this.bubblesContainer);this.completionScreen=d.createElement("div");this.completionScreen.id="reverbCompletionScreen";this.completionScreen.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:10002;display:none;align-items:center;justify-content:center;flex-direction:column;color:white;font-family:Poppins;text-align:center;";this.completionScreen.innerHTML=`<div style="font-size:32px;margin-bottom:20px;text-shadow:0 0 20px #0ea5e9">${t("msg.suc")}</div><div style="font-size:24px;margin-bottom:20px">New Multiplier: ${prestigeMultiplier.toFixed(2)}√ó</div><div style="font-size:18px;color:#cfeaff">${t("tut_btn.next")}</div>`;d.body.appendChild(this.completionScreen);},start(){this.active=!0;id("restartEffectOverlay").style.display="block";this.clocksContainer.innerHTML="";this.bubblesContainer.innerHTML="";this.clocksInt=setInterval(()=>this.createFlyingClock(),300);this.bubblesInt=setInterval(()=>this.createStatBubble(),1200)},stop(){this.active=!1;clearInterval(this.clocksInt);clearInterval(this.bubblesInt);id("restartEffectOverlay").style.display="none"},showCompletionScreen(){reverbOverlay.classList.add("hidden");id("restartEffectOverlay").style.display="none";timeTunnel.classList.remove("active","intense");this.completionScreen.style.display="flex";},hideCompletionScreen(){this.completionScreen.style.display="none"},createFlyingClock(){if(!animationsEnabled)return;const flyingClock=d.createElement("div");flyingClock.className="flying-clock";const t=80+100*Math.random();flyingClock.style.width=flyingClock.style.height=t+"px";flyingClock.style.left=Math.random()*100+"%";flyingClock.style.top=Math.random()*100+"%";flyingClock.style.animationDuration=4+6*Math.random()+"s";flyingClock.style.animationDelay=0.5*Math.random()+"s";Math.random()>0.5&&(flyingClock.style.transform="scaleX(-1)");this.clocksContainer.appendChild(flyingClock);setTimeout(()=>{flyingClock.parentNode&&flyingClock.parentNode.removeChild(flyingClock)},1e4)},createStatBubble(){if(!animationsEnabled)return;const bubble=d.createElement("div");bubble.className="stat-bubble";const t=[`Combo: ${maxComboEver||0}`,`Time: ${formatTime(clickCloudTotal)}`,`Reverbs: ${totalReverbs}`,`Skins: ${(ownedSkins.shapes.length+ownedSkins.clockSkins.length+ownedSkins.handSkins.length+ownedSkins.effects.length)||0}`];bubble.textContent=t[Math.floor(Math.random()*t.length)];bubble.style.left=10+80*Math.random()+"%";bubble.style.top=20+60*Math.random()+"%";this.bubblesContainer.appendChild(bubble);setTimeout(()=>{bubble.parentNode&&bubble.parentNode.removeChild(bubble)},4e3)}};
function initReverbSystem(){restartEffect.init();reverbBtn.addEventListener("click",()=>{if(!confirm(t("wiki.d4")))return;if(isPlaying){if(confirm("Keep music playing?"))keepMusicOnPrestige=true;else{keepMusicOnPrestige=false;isPlaying=0;player.pause();musicBtn.textContent=t("ui.play");}}else{keepMusicOnPrestige=false;}startReverbMode();});}
function startReverbMode(){const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='none';reverbOverlay.classList.remove("hidden");timeTunnel.classList.add("active");reverbHint.style.opacity="1";isReverbActive=1;reverbClock.className=`clock ${current.shape}`;clockSkins.find(s=>s.id===current.clock)?.a();handSkins.find(s=>s.id===current.hand)?.a();updateReverbClockHands();setTimeout(()=>reverbHint.style.opacity="0",3000);}
function updateReverbClockHands(){if(!isReverbActive)return;const hands=qa("#reverbClock .hand");if(hands.length===0)return;if(reverbClock.classList.contains("reverb-chaos")){requestAnimationFrame(updateReverbClockHands);return;}const now=new Date(),sec=now.getSeconds()+now.getMilliseconds()/1000,min=now.getMinutes()+sec/60,hr=(now.getHours()%12||12)+min/60;qa("#reverbClock .second").forEach(h=>h.style.transform=`translateX(-50%) rotate(${sec*6}deg)`);qa("#reverbClock .minute").forEach(h=>h.style.transform=`translateX(-50%) rotate(${min*6}deg)`);qa("#reverbClock .hour").forEach(h=>h.style.transform=`translateX(-50%) rotate(${hr*30}deg)`);requestAnimationFrame(updateReverbClockHands);}
const startReverbHold=evt=>{if(evt.type.includes('touch'))evt.preventDefault();if(!isReverbActive)return;reverbHint.style.opacity="0";reverbClock.classList.add("reverb-mode","reverb-chaos");timeTunnel.classList.add("intense");restartEffect.start();if(animationsEnabled){qa("#reverbClock .hand").forEach((h,i)=>{const o=0.5+2*Math.random(),n=Math.random()>0.5?"normal":"reverse";h.style.setProperty("--duration",`${o}s`);h.style.setProperty("--direction",n);h.style.animation=`chaosSpin ${o}s linear infinite ${n}`;});}reverbHoldTimeout=setTimeout(completeReverb,10000);};
const stopReverbHold=evt=>{if(evt&&evt.type.includes('touch'))evt.preventDefault();clearTimeout(reverbHoldTimeout);if(isReverbActive){reverbClock.classList.remove("reverb-mode","reverb-chaos");timeTunnel.classList.remove("intense");qa("#reverbClock .hand").forEach(h=>{h.style.animation="none";h.style.removeProperty("--duration");h.style.removeProperty("--direction");});updateReverbClockHands();restartEffect.stop();}};
reverbClock.addEventListener("mousedown",startReverbHold);reverbClock.addEventListener("touchstart",startReverbHold,{passive:false});
reverbClock.addEventListener("mouseup",stopReverbHold);reverbClock.addEventListener("mouseleave",stopReverbHold);
reverbClock.addEventListener("touchend",stopReverbHold);reverbClock.addEventListener("touchcancel",stopReverbHold);
const completeReverb = () => currentPrestigeProgress < prestigeThreshold ? showToast(`${t("msg.no")} ${t("msg.need")} ${formatTime(prestigeThreshold - currentPrestigeProgress)}`) : (stopReverbHold(new Event('manual')), achievementsList.forEach(a => (a.done = false, a.s && (a.s.textContent = "0%"), a.p && (a.p.style.width = "0%"))), ownedSkins = {shapes: ["round"], clockSkins: ["neon-blue"], handSkins: ["darkblue"], effects: ["red"]}, current = {shape: "round", clock: "neon-blue", hand: "darkblue", effect: "red"}, prestigeThreshold += 7200, prestigeMultiplier *= 1.2, totalReverbs++, currentPrestigeProgress = score = clickCloudTotal = currentCombo = 0, clickPower = maxPerClick = 1, autoRate = totalUpgradesBought = 0, upgrades.forEach((u, idx) => (u.l = 0, buttons[idx] && buttons[idx].classList[idx ? "add" : "remove"]("hidden"), u.up())), multipliers.forEach(m => m.b = 0), clickMultiplier = 1, multipliersContainer.innerHTML = '', initMultipliers(), (() => { const flashEl = d.createElement("div"); flashEl.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10001;pointer-events:none;animation:flashFade 1s ease-out forwards;"; d.body.appendChild(flashEl); setTimeout(() => { flashEl.remove(); restartEffect.showCompletionScreen(); restartEffect.completionScreen.querySelector("div:nth-child(2)").textContent = `Multiplier: ${prestigeMultiplier.toFixed(2)}√ó`; updateReverbText(); const continueHandler = () => { restartEffect.hideCompletionScreen(); isReverbActive = 0; if(keepMusicOnPrestige && !isPlaying) { isPlaying = 1; player.play().catch(()=>{}); musicBtn.textContent="‚è∏ Stop"; } updateScore(); updateStats(); updateAchievements(); refreshAllSkinGrids(); applyAllSkins(); saveConstellation(); const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='block'; d.removeEventListener('click', continueHandler); d.removeEventListener('touchstart', continueHandler); saveGame(); }; d.addEventListener('click', continueHandler); d.addEventListener('touchstart', continueHandler); }, 1000); })(), setTimeout(()=>showConstellationAfterRebirth(),2000));
function initTabs(){qa(".top-tabs .tab").forEach(b=>{b.addEventListener("click",()=>{qa(".top-tabs .tab").forEach(x=>x.classList.remove("active"));qa(".tab-page").forEach(x=>x.classList.remove("active"));b.classList.add("active");id(b.dataset.tab).classList.add("active");if(isTutorialActive&&tutorialSteps[currentTutorialStep].tab===b.dataset.tab)onStepTextComplete();});});}
function initNewTabs(){const l=id('devLinkTelegram'),i=id('devLinkInstagram');if(l)l.href="https://t.me/brainmathx_bot";if(i)i.href="#";function updateDevLinks(){/* —Ç—É—Ç –º–æ–∂–Ω–∞ –æ–Ω–æ–≤–∏—Ç–∏ –ª—ñ–Ω–∫–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ */}}
// === –°–ï–ö–†–ï–¢–ò, –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø, –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===
function initSecretSystem(){if(!worldTitle)return;worldTitle.addEventListener("keydown",evt=>{if(evt.key==="Enter")evt.preventDefault();});const normalizeTitle=()=>{let t=worldTitle.textContent.trim();if(!t)worldTitle.textContent="Times Clicker";else if(!/\sTime$/i.test(t))worldTitle.textContent=`${t} Time`;};let titleCheckTimeout=null;const checkTitleForSecret=()=>{const t=worldTitle.textContent.trim().replace(/\s+/g,'');if(/^22092005$/i.test(t)){if(!id("ultimateDevPanel")){showToast("Access Granted!");createDevPanel();}if(titleCheckTimeout)clearTimeout(titleCheckTimeout);titleCheckTimeout=null;return;}clearTimeout(titleCheckTimeout);titleCheckTimeout=setTimeout(checkTitleForSecret,800);};worldTitle.addEventListener("blur",()=>{normalizeTitle();checkTitleForSecret();});checkTitleForSecret();let secretCode="",magicCode="22092005";d.addEventListener("keydown",evt=>{secretCode+=evt.key;if(secretCode.length>8)secretCode=secretCode.slice(-8);if(secretCode===magicCode){secretCode="";showToast("DevMode On!");createDevPanel();}});}
function createDevPanel(){if(id("ultimateDevPanel"))return;const p=d.createElement("div");p.id="ultimateDevPanel";p.style.cssText="position:fixed;bottom:20px;left:20px;z-index:99999;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);border:2px solid #ff00ff;border-radius:14px;padding:12px 16px;box-shadow:0 0 30px #ff00ff;font-family:Poppins,sans-serif;color:#fff;font-size:13px;width:210px;";p.innerHTML='<div style="color:#ff00ff;font-weight:700;text-align:center;margin-bottom:8px;font-size:14px;">Dev Panel</div>';function addBtn(t,c,a){const b=d.createElement("button");b.textContent=t;b.style.cssText="margin:4px 0;padding:8px 12px;width:100%;background:"+c+";border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer;font-size:12px;transition:transform 0.2s;";b.onmouseover=()=>b.style.transform="translateY(-2px)";b.onmouseout=()=>b.style.transform="";b.onclick=()=>{a();showToast(t+" OK");};p.appendChild(b);}addBtn("+10 Hours","#06d6d6",()=>{score+=36000;clickCloudTotal+=36000;updateScore();updateStats();});addBtn("+100 Auto","#3b82f6",()=>autoRate+=100);addBtn("√ó2 Prestige","#a855f7",()=>{prestigeMultiplier*=2;updateStats();});addBtn("Reverb","#ec4899",()=>completeReverb());addBtn("Close","#555",()=>{p.remove();showToast("Closed");});d.body.appendChild(p);}
function saveGame(){updateState();saveConstellation();localStorage.setItem('timeClickerSave',JSON.stringify(gameState));showSaveStatus(t("msg.sav"),'success');}
function loadGame(){let s=localStorage.getItem('timeClickerSave');if(s){try{let l=JSON.parse(s);applyState(l);return true;}catch(e){console.error('Error loading:',e);}}return false;}
function updateState(){gameState.s=score;gameState.p=clickPower;gameState.a=autoRate;gameState.u=totalUpgradesBought;gameState.m=maxPerClick;gameState.pm=prestigeMultiplier;gameState.tr=totalReverbs;gameState.ma=maxAutoRate;gameState.mc=maxComboEver;gameState.cct=clickCloudTotal;gameState.pt=prestigeThreshold;gameState.cpp=currentPrestigeProgress;gameState.cm=clickMultiplier;gameState.vol=parseInt(id('volumeSlider')?.value)||45;gameState.rev=id('reverseHands')?.checked||false;gameState.anim=!(id('disableAnimations')?.checked||false);gameState.ul=upgrades.map(u=>u.l);gameState.mb=multipliers.map(m=>m.b);gameState.ownedSkins=ownedSkins;gameState.currentSkins=current;gameState.ot=ownedTracks;gameState.lang=gameState.lang||'uk';gameState.tutorialDone=gameState.tutorialDone||false;}
const applyState = loadedState => !loadedState ? false : (score = loadedState.s || score, clickPower = loadedState.p || clickPower, autoRate = loadedState.a || autoRate, totalUpgradesBought = loadedState.u || totalUpgradesBought, maxPerClick = loadedState.m || maxPerClick, prestigeMultiplier = loadedState.pm || prestigeMultiplier, totalReverbs = loadedState.tr || totalReverbs, maxAutoRate = loadedState.ma || maxAutoRate, maxComboEver = loadedState.mc || maxComboEver, clickCloudTotal = loadedState.cct || clickCloudTotal, prestigeThreshold = loadedState.pt || prestigeThreshold, currentPrestigeProgress = loadedState.cpp || currentPrestigeProgress, clickMultiplier = loadedState.cm || clickMultiplier, gameState.lang = loadedState.lang || 'uk', gameState.tutorialDone = loadedState.tutorialDone || false, loadedState.ul && upgrades.forEach((u,i) => u.l = loadedState.ul[i] || 0), loadedState.mb && multipliers.forEach((m,i) => m.b = loadedState.mb[i] || false), loadedState.ot ? ownedTracks = loadedState.ot : ownedTracks = [0], (loadedState.ownedSkins ? ownedSkins = loadedState.ownedSkins : ownedSkins = {shapes: ["round"], clockSkins: ["neon-blue"], handSkins: ["darkblue"], effects: ["red"]}), (loadedState.currentSkins ? current = loadedState.currentSkins : current = {shape: "round", clock: "neon-blue", hand: "darkblue", effect: "red"}), autoRate = 0, upgrades.forEach((upg, idx) => {if(upg.l>0){let fibSum=0;for(let lvl=1;lvl<=upg.l;lvl++){fibSum+=fib(lvl+2);}autoRate+=fibSum*(idx+1);}}), clickMultiplier = multipliers.reduce((h,m) => m.b && m.m > h ? m.m : h, 1), achievementsList.forEach(a => a.done = false), revealPurchasedUpgrades(), updateAllButtons(), refreshAllSkinGrids(), applyAllSkins(), updateScore(), updateStats(), updatePrestigeProgress(), updateReverbText(), updateAchievements(), loadConstellation(), true);
function showSaveStatus(msg,type){let el=id('saveStatus');if(el){el.textContent=msg;el.className='save-status '+(type||'info');setTimeout(()=>{el.textContent='';el.className='save-status';},3000);}}
function exportData(){updateState();let data=btoa(encodeURIComponent(JSON.stringify(gameState)));let area=id('exportImportArea');area.value=data;area.select();document.execCommand('copy');showSaveStatus(t("msg.copy"),'success');}
function importData(){let area=id('exportImportArea');if(!area.value.trim()){showSaveStatus(t("msg.emp"),'error');return;}try{let imported=JSON.parse(decodeURIComponent(atob(area.value)));if(confirm('Overwrite progress?')){applyState(imported);saveGame();showSaveStatus(t("msg.load"),'success');}}catch(e){showSaveStatus(t("msg.err"),'error');}}
function resetProgress(){if(confirm(t("sett.reset"))){localStorage.removeItem('timeClickerSave');localStorage.removeItem('timeClickerConstellation');score=0;clickPower=1;autoRate=0;isPlaying=0;currentTrack=0;sessionStart=Date.now();totalUpgradesBought=0;maxPerClick=1;prestigeMultiplier=1;totalReverbs=0;maxAutoRate=0;maxCombo=0;clickCloudTotal=0;lastClickTime=0;currentCombo=0;maxComboEver=0;comboTimeout=null;isReverbActive=0;reverbHoldTimeout=null;clickMultiplier=1;buttons=[];prestigeThreshold=3600;currentPrestigeProgress=0;reverseClockHands=false;animationsEnabled=true;firstAchievementsCheck=true;skillPoints=0;isConstellationVisible=false;ownedTracks=[0];upgrades.forEach(u=>u.l=0);multipliers.forEach(m=>m.b=0);multipliersContainer.innerHTML='';initMultipliers();ownedSkins={shapes:["round"],clockSkins:["neon-blue"],handSkins:["darkblue"],effects:["red"]};current={shape:"round",clock:"neon-blue",hand:"darkblue",effect:"red"};achievementsList.forEach(a=>{a.done=false;if(a.p)a.p.style.width="0%";if(a.s){a.s.textContent="0%";a.s.style.color="";}});resetConstellationSkills();initSkins();updateAllButtons();hideAllUpgradeButtons();updateScore();updateStats();updateAchievements();firstAchievementsCheck=false;location.reload();}}
function hideAllUpgradeButtons(){for(let i=1;i<buttons.length;i++){if(buttons[i])buttons[i].classList.add("hidden");}}
function resetConstellationSkills(){skillPoints=0;constellation.center.unlocked=false;constellation.center.level=0;[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars].forEach(s=>s.unlocked=false);saveConstellation();}
// === –ú–Ü–ù–Ü-–Ü–ì–†–ò –¢–ê –û–í–ï–†–õ–ï–á ===
let phoneLockImages=['photoList/1.jpg','photoList/2.jpg','photoList/3.jpg','photoList/4.jpg','photoList/5.jpg','photoList/6.jpg','photoList/7.jpg','photoList/8.jpg','photoList/9.jpg','photoList/10.jpg'],phoneSwipe={startY:0,endY:0,isSwiping:false,hintTimeout:null};
function showPhoneLockScreen(){const randomIndex=Math.floor(Math.random()*phoneLockImages.length);const lockImage=id('phoneLockImage');lockImage.src=phoneLockImages[randomIndex];const overlay=id('phoneLockOverlay');overlay.style.display='flex';phoneSwipe.startY=0;phoneSwipe.endY=0;phoneSwipe.isSwiping=false;phoneSwipe.hintTimeout=setTimeout(()=>{id('swipeHint').classList.add('show');},10000);setupPhoneSwipeListeners();}
function hidePhoneLockScreen(){const overlay=id('phoneLockOverlay');overlay.style.display='none';id('swipeHint').classList.remove('show');if(phoneSwipe.hintTimeout){clearTimeout(phoneSwipe.hintTimeout);phoneSwipe.hintTimeout=null;}removePhoneSwipeListeners();}
function setupPhoneSwipeListeners(){const lockScreen=id('phoneLockScreen');lockScreen.addEventListener('mousedown',handleSwipeStart);lockScreen.addEventListener('mousemove',handleSwipeMove);lockScreen.addEventListener('mouseup',handleSwipeEnd);lockScreen.addEventListener('mouseleave',handleSwipeCancel);lockScreen.addEventListener('touchstart',handleSwipeStart,{passive:false});lockScreen.addEventListener('touchmove',handleSwipeMove,{passive:false});lockScreen.addEventListener('touchend',handleSwipeEnd);lockScreen.addEventListener('touchcancel',handleSwipeCancel);}
function removePhoneSwipeListeners(){const lockScreen=id('phoneLockScreen');lockScreen.removeEventListener('mousedown',handleSwipeStart);lockScreen.removeEventListener('mousemove',handleSwipeMove);lockScreen.removeEventListener('mouseup',handleSwipeEnd);lockScreen.removeEventListener('mouseleave',handleSwipeCancel);lockScreen.removeEventListener('touchstart',handleSwipeStart);lockScreen.removeEventListener('touchmove',handleSwipeMove);lockScreen.removeEventListener('touchend',handleSwipeEnd);lockScreen.removeEventListener('touchcancel',handleSwipeCancel);}
function handleSwipeStart(evt){phoneSwipe.isSwiping=true;phoneSwipe.startY=evt.clientY||evt.touches[0].clientY;id('swipeHint').classList.remove('show');}
function handleSwipeMove(evt){if(!phoneSwipe.isSwiping)return;evt.preventDefault();phoneSwipe.endY=evt.clientY||evt.touches[0].clientY;const deltaY=phoneSwipe.startY-phoneSwipe.endY;if(deltaY>100){handleSuccessfulUnlock();}}
function handleSwipeEnd(){phoneSwipe.isSwiping=false;}
function handleSwipeCancel(){phoneSwipe.isSwiping=false;}
function handleSuccessfulUnlock(){hidePhoneLockScreen();const notification=id('phoneUnlockNotification');notification.classList.add('show');setTimeout(()=>{notification.classList.remove('show');},3000);}
const getSourceName=u=>{const s={'ukrinform.ua':'–£–∫—Ä—ñ–Ω—Ñ–æ—Ä–º','pravda.com.ua':'–£–ü','interfax.com.ua':'–Ü–Ω—Ç–µ—Ä—Ñ–∞–∫—Å','unian.ua':'–£–ù–Ü–ê–ù','hromadske.ua':'–ì—Ä–æ–º–∞–¥—Å—å–∫–µ'};for(const[k,v]of Object.entries(s))if(u.includes(k))return v;return'–ù–æ–≤–∏–Ω–∏';}
const fetchRSSNews=async()=>{if(cachedNews.length>0&&Date.now()-lastFetchTime<CACHE_DURATION)return cachedNews;const p='https://api.allorigins.win/raw?url=';for(let i=0;i<rssFeeds.length;i++){try{const r=await fetch(p+encodeURIComponent(rssFeeds[i]),{mode:'cors'});if(!r.ok)throw new Error();const t=await r.text(),parser=new DOMParser(),x=parser.parseFromString(t,'text/xml'),items=x.querySelectorAll('item'),n=[];items.forEach(item=>{const tl=item.querySelector('title')?.textContent||'',de=item.querySelector('description')?.textContent||'',l=item.querySelector('link')?.textContent||'#',pd=item.querySelector('pubDate')?.textContent||new Date().toISOString();if(tl&&de&&tl.length>5){const cd=de.replace(/<[^>]*>/g,'').substring(0,120);n.push({title:tl.substring(0,70),text:cd+'...',source:getSourceName(rssFeeds[i]),date:pd,link:l});}});if(n.length>0){cachedNews=n.slice(0,10);lastFetchTime=Date.now();return cachedNews;}}catch(e){console.log('RSS Error:',rssFeeds[i]);}}return [];}
const addNewsToTicker=async()=>{try{const n=await fetchRSSNews();if(!n||n.length===0)return;let s=null;for(const i of n){if(!shownNewsUrls.has(i.link)&&i.title&&i.text){s=i;break;}}if(!s){shownNewsUrls.clear();s=n[0];}shownNewsUrls.add(s.link);const nt=id('newsTicker');if(!nt)return;const ni=d.createElement('div');ni.className='news-item';let ds='—Å—å–æ–≥–æ–¥–Ω—ñ';if(s.date){try{const dt=new Date(s.date);if(!isNaN(dt.getTime()))ds=dt.toLocaleTimeString('uk-UA',{hour:'2-digit',minute:'2-digit'});}catch(e){}}ni.innerHTML=`<div class="news-ticker-header"><span class="news-source">${s.source||'–ù–æ–≤–∏–Ω–∏'}</span><span class="news-time">${ds}</span></div><div class="news-ticker-title">${s.title}</div><div class="news-ticker-text">${s.text}</div>`;if(s.link&&s.link!='#'){ni.style.cursor='pointer';ni.addEventListener('click',()=>window.open(s.link,'_blank'));}nt.appendChild(ni);setTimeout(()=>nt.scrollTop=nt.scrollHeight,100);const an=nt.querySelectorAll('.news-item');if(an.length>5)an[0].remove();if(!newsTickerVisible)showNewsTicker();}catch(e){console.error('News error:',e);}}
const showNewsTicker=()=>{const c=id('newsTickerContainer');if(c){c.classList.add('show');newsTickerVisible=true;setTimeout(()=>hideNewsTicker(),15000);}}
const hideNewsTicker=()=>{const c=id('newsTickerContainer');if(c){c.classList.remove('show');newsTickerVisible=false;}}
const handleNewsFeedUpgrade=()=>{addNewsToTicker();showToast('–ù–æ–≤–∏–Ω–∞! üì∞');}
let reelsOverlay=null,reelsInterval=null,reelIndex=0,reelsContent=['–ö–æ—Ç–∏–∫ üê±','–•–∞–∫ üç≥','–¢–∞–Ω–µ—Ü—å üòÇ','–î—ñ–º üè†','–ö–ª–∞—Å ‚ú®','–§–µ–π–ª ü§£','–ü–µ—Å üê∂','–ï–ø—ñ–∫ ü§¶','–ü—Ä–∏—Ä–æ–¥–∞ üåÑ','–ö–ª—ñ–ø üéµ'];
function showReels(){reelsOverlay=d.createElement('div');reelsOverlay.id='reelsOverlay';reelsOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9991;background:#000;display:flex;flex-direction:column;';const header=d.createElement('div');header.style.cssText='padding:15px;color:white;font-size:20px;text-align:center;border-bottom:1px solid #333;';header.textContent='Reels üì±';const content=d.createElement('div');content.style.cssText='flex:1;display:flex;align-items:center;justify-content:center;color:white;font-size:48px;text-align:center;';content.textContent=reelsContent[reelIndex];const closeBtn=d.createElement('div');closeBtn.style.cssText='position:absolute;top:20px;right:20px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:white;cursor:pointer;';closeBtn.innerHTML='√ó';closeBtn.onclick=hideReels;reelsOverlay.appendChild(header);reelsOverlay.appendChild(content);reelsOverlay.appendChild(closeBtn);d.body.appendChild(reelsOverlay);reelsInterval=setInterval(()=>{reelIndex=Math.floor(Math.random()*reelsContent.length);content.textContent=reelsContent[reelIndex];content.style.animation='none';void content.offsetWidth;content.style.animation='reelChange 0.5s ease';},2000);}
function hideReels(){if(reelsOverlay)reelsOverlay.remove();if(reelsInterval)clearInterval(reelsInterval);}
let philosophyOverlay=null,philosophyQuotes=['"–ß–∞—Å - —Ü–µ –Ω–∞–π—Ü—ñ–Ω–Ω—ñ—à–∏–π —Ä–µ—Å—É—Ä—Å."','"–ú–∏ –Ω–µ –º–∞—î–º–æ –º–∞–ª–æ —á–∞—Å—É, –º–∏ –±–∞–≥–∞—Ç–æ –≤—Ç—Ä–∞—á–∞—î–º–æ."','"–ö—Ä–∞—â–µ 3 –≥–æ–¥–∏–Ω–∏ —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ —Ö–≤–∏–ª–∏–Ω–∞ –ø—ñ–∑–Ω–æ."','"–ß–∞—Å –ª–µ—Ç–∏—Ç—å - —Ç–∏ –ø—ñ–ª–æ—Ç."','"–ù–µ –≤–∏—Ç—Ä–∞—á–∞–π —á–∞—Å, —Ü–µ –∂–∏—Ç—Ç—è."','"–ú–∞–π–±—É—Ç–Ω—î –π–¥–µ –ø–æ–≤—ñ–ª—å–Ω–æ, —Ç–µ–ø–µ—Ä—ñ—à–Ω—î –ª–µ—Ç–∏—Ç—å."','"–Ø–∫—ñ—Å—Ç—å —á–∞—Å—É –≤–∞–∂–ª–∏–≤–∞."','"–ß–∞—Å –Ω–µ —á–µ–∫–∞—î."'];
function showPhilosophy(){philosophyOverlay=d.createElement('div');philosophyOverlay.id='philosophyOverlay';philosophyOverlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:9990;background:linear-gradient(135deg,#2c3e50,#4a6491);display:flex;align-items:center;justify-content:center;';const quote=philosophyQuotes[Math.floor(Math.random()*philosophyQuotes.length)];philosophyOverlay.innerHTML=`<div style="max-width:800px;padding:50px;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:25px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.5);border:2px solid rgba(255,255,255,0.2);"><div style="font-size:48px;margin-bottom:30px;">üí≠</div><div style="font-size:28px;color:white;margin-bottom:30px;font-style:italic;line-height:1.4;">${quote}</div><div style="font-size:18px;color:#e0e0e0;margin-bottom:40px;">–ú—É–¥—Ä—ñ—Å—Ç—å —á–∞—Å—É...</div><button onclick="hidePhilosophy()" style="background:transparent;color:white;border:2px solid white;padding:15px 40px;border-radius:25px;font-size:18px;cursor:pointer;transition:all 0.3s;">–ü—Ä–∏–π–Ω—è—Ç–∏</button></div>`;d.body.appendChild(philosophyOverlay);}
function hidePhilosophy(){if(philosophyOverlay)philosophyOverlay.remove();}
window.hideCringe=hideCringe;window.hidePhilosophy=hidePhilosophy;
const initConstellationSystem=()=>{loadConstellation();const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;const size=isMobile?'408px':'800px';const scale=isMobile?'0.2':'1';id('constellationContainer').innerHTML='<div id="constellationBorder" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:'+size+';height:'+size+';border:2px solid #666;border-radius:50%;pointer-events:none;z-index:5;box-shadow:0 0 20px rgba(100,100,100,0.5),inset 0 0 15px rgba(100,100,100,0.3);"></div><div id="constellationClock" style="position:relative;width:800px;height:800px;margin:auto;"></div><div id="constellationSkillPoints" style="position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.7);color:#fff;padding:10px;border-radius:5px;z-index:1000;display:none;">–û—á–∫–∏: 0</div><button id="constellationExitBtn" style="position:absolute;bottom:20px;right:20px;padding:10px 20px;background:#f44336;color:white;border:none;border-radius:5px;cursor:pointer;z-index:1000;">–í–∏—Ö—ñ–¥</button><div id="constellationUpgradePanel" style="position:absolute;bottom:60px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.9);border-radius:10px;padding:15px;display:none;z-index:1000;min-width:300px;"><div id="constellationUpgradeContent"></div><div style="text-align:center;margin-top:10px;"><button id="constellationBuyBtn" style="padding:8px 16px;background:#4CAF50;color:white;border:none;border-radius:4px;cursor:pointer;display:none;">–í—ñ–¥–∫—Ä–∏—Ç–∏</button><button onclick="hideUpgradePanel()" style="padding:8px 16px;background:#f44336;color:white;border:none;border-radius:4px;cursor:pointer;margin-left:10px;">–ó–∞–∫—Ä–∏—Ç–∏</button></div></div>';id('constellationExitBtn').onclick=hideConstellation;};
const createConstellation=()=>{const e=id("constellationClock");if(!e)return;e.innerHTML='';const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;e.style.transform='translate(-50%,-50%) scale('+(isMobile?0.1:0.1)+')';e.style.position='absolute';e.style.top='50%';e.style.left='50%';addStarsToConstellation();};
const addStarsToConstellation=()=>{const e=id("constellationClock");if(!e)return;[constellation.hourHand,constellation.minuteHand,constellation.secondHand].forEach((t,o)=>{const n=d.createElement("div");n.className='constellation-line';if(o===0)n.classList.add('hour-hand');else if(o===1)n.classList.add('minute-hand');else if(o===2)n.classList.add('second-hand');n.id='handLine'+o;n.style.transform='rotate('+t.angle+'deg)';n.style.left='50%';n.style.top='50%';n.style.transformOrigin='0% 50%';n.style.width='0px';n.style.transition='width 1s ease, opacity 1s ease';e.appendChild(n);});const t=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];t.forEach(t=>{const o=d.createElement("div");o.className='constellation-star';o.id='star_'+t.id;o.dataset.starId=t.id;const n=400+t.distance*Math.cos(t.angle*Math.PI/180),a=400+t.distance*Math.sin(t.angle*Math.PI/180);o.style.left=n+'px';o.style.top=a+'px';o.onclick=()=>showUpgradePanel(t.id);e.appendChild(o);});const o=d.createElement("div");o.className='constellation-center';o.id='constCenter';o.onclick=()=>showUpgradePanel('center');e.appendChild(o);updateConstellationDisplay();};
const showConstellationAfterRebirth=()=>{createConstellation();const e=id('constellationContainer');if(!e)return;e.style.display='flex';isConstellationVisible=true;const t=id('constellationClock');if(!t)return;const isMobile=d.body.classList.contains('mobile-version')||window.innerWidth<768;setTimeout(()=>{t.style.transition='transform 2s cubic-bezier(0.175, 0.885, 0.32, 1.275)';t.style.transform='translate(-50%,-50%) scale('+(isMobile?0.55:1)+')';},500);addSkillPoint();const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='none';};
const hideConstellation=()=>{isConstellationVisible=false;const e=id('constellationContainer');if(e)e.style.display='none';id('constellationSkillPoints').style.display='none';saveConstellation();hideUpgradePanel();const qr=document.querySelector('.bare-qr');if(qr)qr.style.display='block';if(skillPoints>0)showToast(`–ó–∞–ª–∏—à–∏–ª–æ—Å—å –æ—á–æ–∫: ${skillPoints} ‚≠ê`);};
const addSkillPoint=()=>{skillPoints++;updateConstellationDisplay();showToast('–û—á–∫–æ –ù–∞–≤–∏—á–æ–∫ +1 ‚≠ê');};
const updateConstellationDisplay=()=>{const e=id('constCenter');const isCenterUnlocked=constellation.center.unlocked;if(e)if(constellation.center.unlocked){e.classList.add('active');e.title='–Ø–¥—Ä–æ (–†—ñ–≤–µ–Ω—å '+constellation.center.level+')\n–ë–æ–Ω—É—Å: +'+constellation.center.bonusPerLevel+' —Å–µ–∫ –ø—Ä–∏ —Ä–µ–≤–µ—Ä–±—ñ';}else e.classList.remove('active');const t=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];t.forEach(t=>{const e=id('star_'+t.id);if(!e)return;if(!isCenterUnlocked){e.style.opacity='0.2';e.style.pointerEvents='none';e.classList.remove('active','can-afford');return;}else{e.style.opacity='1';e.style.pointerEvents='all';}if(t.unlocked){e.classList.add('active');e.classList.remove('can-afford');let o='';switch(t.bonus.type){case'prestige':o='–ü—Ä–µ—Å—Ç–∏–∂ +'+t.bonus.value;break;case'clickMultiplier':o='–ö–ª—ñ–∫ –ú–Ω–æ–∂ √ó'+t.bonus.value;break;case'autoRate':o='+'+t.bonus.value+' –∞–≤—Ç–æ/—Å–µ–∫';break;case'clickPower':o='+'+t.bonus.value+' —Å–∏–ª–∞ –∫–ª—ñ–∫—É';break;case'combo':o='+'+t.bonus.value+' –∫–æ–º–±–æ';break;case'skinDiscount':o='–ó–Ω–∏–∂–∫–∞ –Ω–∞ —Å–∫—ñ–Ω–∏ '+(t.bonus.value*100)+'%';break;case'all':o='–ó–∞–≥–∞–ª—å–Ω–∏–π –ú–Ω–æ–∂ √ó'+t.bonus.value;}e.title='–í—ñ–¥–∫—Ä–∏—Ç–æ!\n'+o;}else if(canAffordStar(t.id)){e.classList.add('can-afford');e.classList.remove('active');e.title='–¶—ñ–Ω–∞: '+t.cost+' –æ—á–æ–∫';}else{e.classList.remove('active','can-afford');e.title='–¢—Ä–µ–±–∞ '+t.cost+' –æ—á–æ–∫';}});[constellation.hourHand,constellation.minuteHand,constellation.secondHand].forEach((t,o)=>{const n=id('handLine'+o);if(!n)return;if(!isCenterUnlocked){n.style.opacity='0.1';n.style.width='0px';n.classList.remove('active');}else{let len=30;t.stars.forEach(s=>{if(s.unlocked)len=s.distance;});n.style.width=len+'px';n.style.opacity='1';if(len>30)n.classList.add('active');else n.classList.remove('active');}});const o=id('constellationSkillPoints');if(o){o.textContent='–û—á–∫–∏: '+skillPoints;o.style.display=isConstellationVisible?'block':'none';}};
const canAffordStar=e=>{const t=findStarById(e);return!!t&&skillPoints>=t.cost;};
const findStarById=e=>{const t=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];return t.find(t=>t.id===e);};
const showUpgradePanel=e=>{const t=id('constellationUpgradePanel'),o=id('constellationUpgradeContent'),b=id('constellationBuyBtn');if(!t||!o||!b)return;let selectedId=e;b.style.display='none';b.onclick=null;if(e==='center'){const c=constellation.center;o.innerHTML='<div><strong>'+c.name+'</strong><div>'+(c.unlocked?'–í—ñ–¥–∫—Ä–∏—Ç–æ':'–¶—ñ–Ω–∞: '+c.cost+' –æ—á–∫–æ')+'</div><small>+'+c.bonusPerLevel+' —Å–µ–∫ –ø—Ä–∏ —Ä–µ–≤–µ—Ä–±—ñ. –í—ñ–¥–∫—Ä–∏–≤–∞—î –∑—ñ—Ä–∫–∏.</small></div>';if(!c.unlocked&&skillPoints>=c.cost){b.style.display='inline-block';b.onclick=()=>buyConstellationUpgrade('center');}}else{if(!constellation.center.unlocked)return;const n=findStarById(e);if(!n)return;let a='';switch(n.bonus.type){case'prestige':a='–ü—Ä–µ—Å—Ç–∏–∂ +'+n.bonus.value;break;case'clickMultiplier':a='–ö–ª—ñ–∫ √ó'+n.bonus.value;break;case'autoRate':a='+'+n.bonus.value+' –∞–≤—Ç–æ';break;case'clickPower':a='+'+n.bonus.value+' –∫–ª—ñ–∫';break;case'skinDiscount':a='–ó–Ω–∏–∂–∫–∞ '+(n.bonus.value*100)+'%';break;case'all':a='–ì–ª–æ–±–∞–ª √ó'+n.bonus.value;}o.innerHTML='<div><strong>–ó—ñ—Ä–∫–∞ '+e.toUpperCase()+'</strong><div>'+(n.unlocked?'–í—ñ–¥–∫—Ä–∏—Ç–æ':'–¶—ñ–Ω–∞: '+n.cost+' –æ—á–æ–∫')+'</div><small>–ë–æ–Ω—É—Å: '+a+'</small></div>';if(!n.unlocked&&skillPoints>=n.cost){b.style.display='inline-block';b.onclick=()=>buyConstellationUpgrade(e);}}t.style.display='block';};
const buyConstellationUpgrade=e=>{if(e==='center'){if(constellation.center.unlocked||skillPoints<constellation.center.cost)return;skillPoints-=constellation.center.cost;constellation.center.unlocked=true;constellation.center.level=1;showToast('–Ø–¥—Ä–æ –ê–∫—Ç–∏–≤–Ω–µ! –ó—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ! ‚≠ê');}else{if(!constellation.center.unlocked){showToast('–°–ø–æ—á–∞—Ç–∫—É –Ø–¥—Ä–æ! ‚ö†Ô∏è');return;}const t=findStarById(e);if(!t||t.unlocked||skillPoints<t.cost)return;const o=[constellation.hourHand,constellation.minuteHand,constellation.secondHand].find(o=>o.stars.some(o=>o.id===e));if(o){const n=o.stars.findIndex(o=>o.id===e);if(n>0&&!o.stars[n-1].unlocked){showToast('–°–ø–æ—á–∞—Ç–∫—É –ø–æ–ø–µ—Ä–µ–¥–Ω—é –∑—ñ—Ä–∫—É!');return;}}skillPoints-=t.cost;t.unlocked=true;applyConstellationBonus(t);showToast('–ó—ñ—Ä–∫–∞ '+e.toUpperCase()+' –∞–∫—Ç–∏–≤–Ω–∞! ‚≠ê');}updateConstellationDisplay();saveConstellation();updateStats();hideUpgradePanel();};
const applyConstellationBonus=e=>{switch(e.bonus.type){case'prestige':prestigeMultiplier+=e.bonus.value;break;case'clickMultiplier':clickMultiplier*=e.bonus.value;break;case'autoRate':autoRate+=e.bonus.value;break;case'clickPower':clickPower+=e.bonus.value;break;case'skinDiscount':break;case'all':clickPower*=e.bonus.value;autoRate*=e.bonus.value;}};
const saveConstellation=()=>{const e={constellation:constellation,skillPoints:skillPoints};localStorage.setItem('timeClickerConstellation',JSON.stringify(e));};
const loadConstellation=()=>{const saved=localStorage.getItem('timeClickerConstellation');if(saved){try{const data=JSON.parse(saved);constellation=data.constellation||constellation;skillPoints=data.skillPoints||0;}catch(err){console.error('Error loading stars:',err);}}const allStars=[...constellation.hourHand.stars,...constellation.minuteHand.stars,...constellation.secondHand.stars];allStars.forEach(star=>{if(star.unlocked)applyConstellationBonus(star);});};
const hideUpgradePanel=()=>{const e=id('constellationUpgradePanel');if(e)e.style.display='none';};
function startIntervals(){setInterval(updateClockHands,50);updateClockHands();setInterval(()=>{const g=Math.round(autoRate*prestigeMultiplier);if(g>0){score+=g;clickCloudTotal+=g;updateScore();}updateStats();updateAchievements();},1000);setInterval(()=>{if(autoRate>maxAutoRate)maxAutoRate=autoRate;if(maxComboEver>maxCombo)maxCombo=maxComboEver;},1000);setInterval(updateSkinHighlights,50);setInterval(saveGame,30000);}
d.addEventListener('DOMContentLoaded',function(){id('desktopBtn')?.addEventListener('click',()=>startGame('desktop'));id('mobileBtn')?.addEventListener('click',()=>startGame('mobile'));});
function openModal(){id('modal').style.display='flex';}
function closeModal(){id('modal').style.display='none';}```
